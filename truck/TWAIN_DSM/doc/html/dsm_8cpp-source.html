<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Twain_DSM: dsm.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.6-NO -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>dsm.cpp</h1><a href="dsm_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright © 2006 TWAIN Working Group:  Adobe Systems Incorporated,</span>
<a name="l00003"></a>00003 <span class="comment"> * AnyDoc Software Inc., Eastman Kodak Company, </span>
<a name="l00004"></a>00004 <span class="comment"> * Fujitsu Computer Products of America, JFL Peripheral Solutions Inc., </span>
<a name="l00005"></a>00005 <span class="comment"> * Ricoh Corporation, and Xerox Corporation.</span>
<a name="l00006"></a>00006 <span class="comment"> * All rights reserved.</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> ***************************************************************************/</span>
<a name="l00009"></a>00009 
<a name="l00042"></a>00042 <span class="preprocessor">#if defined(_WIN32)</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">  #include "stdafx.h"</span>
<a name="l00044"></a>00044 <span class="preprocessor">  #include &lt;direct.h&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#else</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span><span class="preprocessor"> #include &lt;dirent.h&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor"> #include &lt;dlfcn.h&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor"> #include &lt;unistd.h&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#endif // _WIN32</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#include "twain/twain.h"</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include "<a class="code" href="dsmdefs_8h.html">dsmdefs.h</a>"</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include "<a class="code" href="dsm_8h.html">dsm.h</a>"</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="preprocessor">#include "resource.h"</span> 
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="keyword">using namespace </span>std;
<a name="l00067"></a>00067 
<a name="l00072"></a><a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">00072</a> ofstream* <a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a> = 0;
<a name="l00073"></a>00073 
<a name="l00079"></a>00079 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00080"></a><a class="code" href="dsm_8cpp.html#05d5448e7ae3f9f6ff48b76c39825715">00080</a> <span class="preprocessor"></span>DWORD <a class="code" href="dsm_8cpp.html#05d5448e7ae3f9f6ff48b76c39825715">gOurPid</a>;
<a name="l00081"></a>00081 <span class="keyword">extern</span> HINSTANCE <a class="code" href="dsm_8cpp.html#2f84f2f9ae2be8128aa873506eadafbe">g_hinstDLL</a>;
<a name="l00082"></a>00082 <span class="preprocessor">#else</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span>pid_t <a class="code" href="dsm_8cpp.html#05d5448e7ae3f9f6ff48b76c39825715">gOurPid</a>;
<a name="l00084"></a>00084 <span class="preprocessor">#endif // _WIN32</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span>
<a name="l00090"></a><a class="code" href="dsm_8cpp.html#a72b5d2715fa48220edcbb894df6b463">00090</a> <span class="preprocessor">#define kLOG if(0 != gpLogFile &amp;&amp; gpLogFile-&gt;is_open()) *gpLogFile &lt;&lt; "DSM [" &lt;&lt; gOurPid &lt;&lt; "]: "</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span>
<a name="l00096"></a><a class="code" href="dsm_8cpp.html#4af57f29119205f8a40cd631d3a7e032">00096</a> <span class="preprocessor">#define kLOGERR if(0 != gpLogFile &amp;&amp; gpLogFile-&gt;is_open()) *gpLogFile &lt;&lt; "DSM [" &lt;&lt; gOurPid &lt;&lt; "]: Error - "</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span>
<a name="l00102"></a><a class="code" href="dsm_8cpp.html#e62b35eda4fad54b1928fa578b3aa9c2">00102</a> <span class="preprocessor">#define kLOGENV "TWAIN_LOG"</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span>
<a name="l00104"></a>00104 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00105"></a><a class="code" href="dsm_8cpp.html#5e8dfed95a684750d27343381d9f8c12">00105</a> <span class="preprocessor"></span><span class="preprocessor">#define kTWAIN_DS_DIR "c:\\windows\\twain_32"</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span><span class="comment">// In non-windows, kTWAIN_DS_DIR is set on the compiler command line</span>
<a name="l00107"></a>00107 <span class="preprocessor">#endif</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span>
<a name="l00118"></a>00118 TW_INT16 <a class="code" href="dsm_8cpp.html#bbdef667ceb3cb5424c14fd07efb21dd">DSM_Null</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pOrigin, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pDest, TW_UINT16 _MSG);
<a name="l00119"></a>00119 
<a name="l00130"></a>00130 <span class="keywordtype">int</span> <a class="code" href="dsm_8cpp.html#108aa28bfe9128ab27d8e5e3fc3aebaf">scanDSDir</a>(<span class="keywordtype">char</span>* _szAbsPath, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structDS__LIST.html">pDS_LIST</a> _pList);
<a name="l00131"></a>00131 
<a name="l00139"></a>00139 TW_INT16 <a class="code" href="dsm_8cpp.html#798fef7de803d0a7e9c8c615fdbf1eea">DSM_Status</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, TW_UINT16 _MSG, <a class="code" href="structTW__STATUS.html">pTW_STATUS</a> _pStatus);
<a name="l00140"></a>00140 
<a name="l00147"></a>00147 TW_INT16 <a class="code" href="dsm_8cpp.html#a44ab2e81853c2a7352a91e3f542f5c6">DSM_Parent</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, TW_UINT16 _MSG);
<a name="l00148"></a>00148 
<a name="l00156"></a>00156 TW_INT16 <a class="code" href="dsm_8cpp.html#f9713025040f399ad28a4e280d9a5bb7">DSM_Identity</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, TW_UINT16 _MSG, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity);
<a name="l00157"></a>00157 
<a name="l00165"></a>00165 TW_INT16 <a class="code" href="dsm_8cpp.html#c4824709a89ce0f31f9f15603bdaa48d">DSM_Callback</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, TW_UINT16 _MSG, <a class="code" href="structTW__CALLBACK.html">pTW_CALLBACK</a> _pData);
<a name="l00166"></a>00166 
<a name="l00172"></a>00172 TW_INT16 <a class="code" href="dsm_8cpp.html#50d2da44e016d1a1ececa8357c3d4f29">DSM_InitializeDSM</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity);
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 
<a name="l00184"></a>00184 TW_INT16 <a class="code" href="dsm_8cpp.html#eb01f399d5aef68a5231229cc80829b4">OpenDS</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity);
<a name="l00185"></a>00185 
<a name="l00192"></a>00192 TW_INT16 <a class="code" href="dsm_8cpp.html#5b2529dc6844449eb5560b0f68a39937">CloseDS</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity);
<a name="l00193"></a>00193 
<a name="l00200"></a>00200 TW_INT16 <a class="code" href="dsm_8cpp.html#8cb3b3faec177a1cc902def63f892b79">DSM_SelectDS</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity);
<a name="l00201"></a>00201 
<a name="l00212"></a>00212 TW_INT16 <a class="code" href="dsm_8cpp.html#afdc094c70146d2988ddc67ee08298b2">EntryDS</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity,
<a name="l00213"></a>00213                  <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity,
<a name="l00214"></a>00214                  TW_UINT32 _DG,
<a name="l00215"></a>00215                  TW_UINT16 _DAT,
<a name="l00216"></a>00216                  TW_UINT16 _MSG,
<a name="l00217"></a>00217                  TW_MEMREF _pData);
<a name="l00218"></a>00218 
<a name="l00227"></a>00227 TW_INT16 <a class="code" href="dsm_8cpp.html#738bd71a11e38de25094584b8d2c243c">LoadDS</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity,
<a name="l00228"></a>00228                 <span class="keywordtype">char</span>* _pPath,
<a name="l00229"></a>00229                 TW_INT16 _index,
<a name="l00230"></a>00230                 <a class="code" href="structDS__LIST.html">pDS_LIST</a> _pList);
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 
<a name="l00238"></a>00238 TW_INT16 <a class="code" href="dsm_8cpp.html#7c841b1d9a57e77b22a2aaf5a78815f2">UnLoadAllDS</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity);
<a name="l00239"></a>00239 
<a name="l00248"></a>00248 TW_INT16 <a class="code" href="dsm_8cpp.html#fd2d9abc3115143298ecd88c5974da42">GetDSFromProductName</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity);
<a name="l00249"></a>00249 
<a name="l00256"></a>00256 TW_INT16 <a class="code" href="dsm_8cpp.html#c7c1874a18c61e4d88e020cedcc3aa94">LoadAllDataSources</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structDS__LIST.html">pDS_LIST</a> _pList);
<a name="l00257"></a>00257 
<a name="l00264"></a>00264 TW_BOOL <a class="code" href="dsm_8cpp.html#25fb28d12b903479535515387adde5d0">SupportedMatch</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity);
<a name="l00265"></a>00265 
<a name="l00272"></a>00272 TW_INT16 <a class="code" href="dsm_8cpp.html#ce8cced59081aa02e57e6d3c969f94d5">DSM_GetFirst</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity);
<a name="l00273"></a>00273 
<a name="l00281"></a>00281 TW_INT16 <a class="code" href="dsm_8cpp.html#aed56229345c051c1500eee8c9f55305">DSM_GetNext</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 
<a name="l00293"></a>00293 TW_INT16 <a class="code" href="dsm_8cpp.html#cf4a1fd18d2caafb1a7de88ecba2afab">GetMatchingDefault</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 
<a name="l00304"></a>00304 TW_INT16 <a class="code" href="dsm_8cpp.html#f803eab9bf60870b52a44127de24ec91">AddApplication</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity);
<a name="l00305"></a>00305 
<a name="l00311"></a>00311 <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> <a class="code" href="dsm_8cpp.html#536a09bd6c21c5878a1f9b7313a3eca7">findApplicationByName</a>(pTW_STR32 _pName);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 
<a name="l00321"></a>00321 TW_UINT16 <a class="code" href="dsm_8cpp.html#e77f69cd5a9efa7683e07bb81e424ad0">getConditionCode</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity);
<a name="l00322"></a>00322 
<a name="l00330"></a>00330 TW_BOOL <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, TW_UINT16 _ConditionCode);
<a name="l00331"></a>00331 
<a name="l00332"></a>00332 
<a name="l00341"></a>00341 <span class="keywordtype">bool</span> <a class="code" href="dsm_8cpp.html#868b0320392455cc6766e14d2c7bab12">printTripletsInfo</a>(<span class="keyword">const</span> TW_UINT32    _DG,
<a name="l00342"></a>00342                        <span class="keyword">const</span> TW_UINT16    _DAT,
<a name="l00343"></a>00343                        <span class="keyword">const</span> TW_UINT16    _MSG,
<a name="l00344"></a>00344                        <span class="keyword">const</span> TW_MEMREF    _pData);
<a name="l00345"></a>00345 
<a name="l00350"></a>00350 <span class="keywordtype">void</span> <a class="code" href="dsm_8cpp.html#92959e187d12b1470d7899c6498c8fc9">printReturnCode</a>( <span class="keyword">const</span> TW_UINT16 rc );
<a name="l00351"></a>00351 
<a name="l00357"></a>00357 string <a class="code" href="dsm_8cpp.html#64a0f7db2839cdeaff166583d31b7996">StringFromMsg</a>(<span class="keyword">const</span> TW_UINT16 _MSG);
<a name="l00358"></a>00358 
<a name="l00364"></a>00364 string <a class="code" href="dsm_8cpp.html#0f66379c704db754860b72a7a8df5e81">StringFromDat</a>(<span class="keyword">const</span> TW_UINT16 _DAT);
<a name="l00365"></a>00365 
<a name="l00371"></a>00371 string <a class="code" href="dsm_8cpp.html#620e15d5ff1c8c596e563ef4d2c7de6a">StringFromDG</a>(<span class="keyword">const</span> TW_UINT32 _DG);
<a name="l00372"></a>00372 
<a name="l00378"></a>00378 string <a class="code" href="dsm_8cpp.html#9e58b44743cbac1b1fecb7f264eb91d5">StringFromCap</a>(<span class="keyword">const</span> TW_UINT16 _Cap);
<a name="l00379"></a>00379 
<a name="l00385"></a>00385 string <a class="code" href="dsm_8cpp.html#84fe3ba26a0fc001597b1ae82769de97">StringFromRC</a>(<span class="keyword">const</span> TW_UINT16 rc);
<a name="l00386"></a>00386 
<a name="l00392"></a>00392 string <a class="code" href="dsm_8cpp.html#893e676872a5110b8ecbff84fa6e99a2">StringFromCC</a>(<span class="keyword">const</span> TW_UINT16 cc);
<a name="l00393"></a>00393 
<a name="l00398"></a><a class="code" href="dsm_8cpp.html#d7b7de190f95ab3def7bbb0286eb13e5">00398</a> TW_INT16 <a class="code" href="dsm_8cpp.html#d7b7de190f95ab3def7bbb0286eb13e5">_gConditionCode</a> = TWCC_SUCCESS;
<a name="l00399"></a>00399 
<a name="l00404"></a><a class="code" href="dsm_8cpp.html#9d5668b97fc31481bdac668eecb545d6">00404</a> TW_BOOL <a class="code" href="dsm_8cpp.html#9d5668b97fc31481bdac668eecb545d6">_gFrameworkInitialized</a> = <a class="code" href="dsmdefs_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00405"></a>00405 
<a name="l00414"></a><a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">00414</a> <a class="code" href="structAPP__LIST.html">APP_LIST</a> <a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>;
<a name="l00415"></a>00415 
<a name="l00420"></a><a class="code" href="dsm_8cpp.html#6bc385ca03d3f2a27e1376c1d67a7aaa">00420</a> <span class="keywordtype">char</span> <a class="code" href="dsm_8cpp.html#6bc385ca03d3f2a27e1376c1d67a7aaa">_gDefaultDSPath</a>[MAX_PATH];
<a name="l00421"></a>00421 
<a name="l00426"></a><a class="code" href="dsm_8cpp.html#60f4da5c3d0621d10645495de11c2f1f">00426</a> TW_STR32 <a class="code" href="dsm_8cpp.html#60f4da5c3d0621d10645495de11c2f1f">_gDefaultDSName</a>;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 <span class="preprocessor">#ifndef _WIN32</span>
<a name="l00429"></a>00429 <span class="preprocessor"></span>
<a name="l00430"></a>00430 TW_HANDLE DSM_Alloc(size_t _size)
<a name="l00431"></a>00431 {
<a name="l00432"></a>00432   <span class="keywordflow">return</span> malloc(_size);
<a name="l00433"></a>00433 }
<a name="l00434"></a>00434 
<a name="l00436"></a>00436 <span class="keywordtype">void</span> DSM_Free(TW_HANDLE _pPtr)
<a name="l00437"></a>00437 {
<a name="l00438"></a>00438   free(_pPtr);
<a name="l00439"></a>00439 }
<a name="l00440"></a>00440 
<a name="l00442"></a>00442 TW_MEMREF DSM_LockMemory(TW_HANDLE _pMemory)
<a name="l00443"></a>00443 {
<a name="l00444"></a>00444   <span class="keywordflow">return</span> (TW_MEMREF)_pMemory;
<a name="l00445"></a>00445 }
<a name="l00446"></a>00446 
<a name="l00448"></a>00448 <span class="keywordtype">void</span> DSM_UnlockMemory(TW_MEMREF _pMemory)
<a name="l00449"></a>00449 {
<a name="l00450"></a>00450   <span class="keywordflow">return</span>;
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 <span class="preprocessor">#endif // _WIN32</span>
<a name="l00453"></a>00453 <span class="preprocessor"></span>
<a name="l00455"></a>00455 
<a name="l00485"></a>00485 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00486"></a>00486 <span class="preprocessor"></span>TW_UINT16 FAR PASCAL
<a name="l00487"></a>00487 <span class="preprocessor">#else</span>
<a name="l00488"></a>00488 <span class="preprocessor"></span>FAR PASCAL TW_UINT16 
<a name="l00489"></a>00489 <span class="preprocessor">#endif</span>
<a name="l00490"></a><a class="code" href="dsm_8cpp.html#464117d3336928ea88050ad58e480ae4">00490</a> <span class="preprocessor"></span><a class="code" href="dsm_8cpp.html#464117d3336928ea88050ad58e480ae4">DSM_Entry</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pOrigin,
<a name="l00491"></a>00491           <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pDest,
<a name="l00492"></a>00492           TW_UINT32    _DG,
<a name="l00493"></a>00493           TW_UINT16    _DAT,
<a name="l00494"></a>00494           TW_UINT16    _MSG,
<a name="l00495"></a>00495           TW_MEMREF    _pData)
<a name="l00496"></a>00496 {
<a name="l00497"></a>00497   TW_UINT16 rcDSM = TWRC_SUCCESS;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499   <span class="comment">// If the _pOrigin is a null pointer, there is nothing we can do, so return</span>
<a name="l00500"></a>00500   <span class="comment">// an error.</span>
<a name="l00501"></a>00501   <span class="keywordflow">if</span>(0 == _pOrigin)
<a name="l00502"></a>00502   {
<a name="l00503"></a>00503     <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pOrigin, TWCC_BUMMER);
<a name="l00504"></a>00504     <span class="keywordflow">return</span> TWRC_FAILURE;
<a name="l00505"></a>00505   }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507   <span class="keywordflow">if</span>(!<a class="code" href="dsm_8cpp.html#9d5668b97fc31481bdac668eecb545d6">_gFrameworkInitialized</a>)
<a name="l00508"></a>00508   {
<a name="l00509"></a>00509     rcDSM = <a class="code" href="dsm_8cpp.html#50d2da44e016d1a1ececa8357c3d4f29">DSM_InitializeDSM</a>(_pOrigin);
<a name="l00510"></a>00510 
<a name="l00511"></a>00511     <span class="keywordflow">if</span>(TWRC_SUCCESS != rcDSM)
<a name="l00512"></a>00512     {
<a name="l00513"></a>00513       <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pOrigin, TWCC_BUMMER);
<a name="l00514"></a>00514       <span class="keywordflow">return</span> rcDSM;
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516   }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518   <span class="comment">// Print the triplets to stdout for information purposes</span>
<a name="l00519"></a>00519   <span class="keywordtype">bool</span> bPrinted = <a class="code" href="dsm_8cpp.html#868b0320392455cc6766e14d2c7bab12">printTripletsInfo</a>(_DG, _DAT, _MSG, _pData);
<a name="l00520"></a>00520 
<a name="l00521"></a>00521   <span class="comment">// first, see if this message is a DAT_NULL msg. This has to be watched for</span>
<a name="l00522"></a>00522   <span class="comment">// because its a special message.</span>
<a name="l00523"></a>00523   <span class="keywordflow">if</span>(DAT_NULL == _DAT)
<a name="l00524"></a>00524   {
<a name="l00525"></a>00525     rcDSM = <a class="code" href="dsm_8cpp.html#bbdef667ceb3cb5424c14fd07efb21dd">DSM_Null</a>(_pOrigin, _pDest, _MSG);
<a name="l00526"></a>00526     <span class="keywordflow">if</span>( bPrinted )
<a name="l00527"></a>00527     {
<a name="l00528"></a>00528       <a class="code" href="dsm_8cpp.html#92959e187d12b1470d7899c6498c8fc9">printReturnCode</a>( rcDSM );
<a name="l00529"></a>00529     }
<a name="l00530"></a>00530     <span class="keywordflow">return</span> rcDSM;
<a name="l00531"></a>00531   }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533   <span class="comment">// second, sniff for the application forwarding an event to the DS. It may be</span>
<a name="l00534"></a>00534   <span class="comment">// possible that the app has a message waiting for it because it didn't</span>
<a name="l00535"></a>00535   <span class="comment">// register a callback.</span>
<a name="l00536"></a>00536   <span class="keywordflow">if</span>( DAT_EVENT == _DAT &amp;&amp; MSG_PROCESSEVENT == _MSG)
<a name="l00537"></a>00537   {
<a name="l00538"></a>00538     <span class="keywordflow">if</span>(_pOrigin-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &gt; 0 &amp;&amp; _pOrigin-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>)
<a name="l00539"></a>00539     {
<a name="l00540"></a>00540       <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;(<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pOrigin-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)]);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542       <span class="keywordflow">if</span>(<a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> == pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#a00cb746097e2d305fa92ee6d231092d">Callback</a>.<a class="code" href="structCallBackInfo.html#ea4c1a10bab38efa22ccfc451f1f6942">bCallbackPending</a>)
<a name="l00543"></a>00543       {
<a name="l00544"></a>00544         ((<a class="code" href="structTW__EVENT.html">pTW_EVENT</a>)(_pData))-&gt;TWMessage = pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#a00cb746097e2d305fa92ee6d231092d">Callback</a>.<a class="code" href="structCallBackInfo.html#58b10afd686c9ff1e32249a2ce235855">callback</a>.<a class="code" href="structTW__CALLBACK.html#a14c95fe8038ce849ea5440e9aa01eaa">Message</a>;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546         pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#a00cb746097e2d305fa92ee6d231092d">Callback</a>.<a class="code" href="structCallBackInfo.html#ea4c1a10bab38efa22ccfc451f1f6942">bCallbackPending</a> = <a class="code" href="dsmdefs_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00547"></a>00547         pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#a00cb746097e2d305fa92ee6d231092d">Callback</a>.<a class="code" href="structCallBackInfo.html#58b10afd686c9ff1e32249a2ce235855">callback</a>.<a class="code" href="structTW__CALLBACK.html#a14c95fe8038ce849ea5440e9aa01eaa">Message</a> = NULL;
<a name="l00548"></a>00548         <span class="keywordflow">return</span> TWRC_DSEVENT;
<a name="l00549"></a>00549       }
<a name="l00550"></a>00550     }
<a name="l00551"></a>00551     <span class="keywordflow">else</span>
<a name="l00552"></a>00552     {
<a name="l00553"></a>00553       <span class="comment">// Getting here means the app has not been registered yet.</span>
<a name="l00554"></a>00554       <span class="comment">// What is a non-registered app doing calling MSG_PROCESSEVENT?</span>
<a name="l00555"></a>00555       <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pOrigin, TWCC_BADPROTOCOL);
<a name="l00556"></a>00556       <span class="keywordflow">if</span>( bPrinted )
<a name="l00557"></a>00557       {
<a name="l00558"></a>00558         <a class="code" href="dsm_8cpp.html#92959e187d12b1470d7899c6498c8fc9">printReturnCode</a>( TWRC_FAILURE );
<a name="l00559"></a>00559       }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561       <span class="keywordflow">return</span> TWRC_FAILURE;
<a name="l00562"></a>00562     }
<a name="l00563"></a>00563   }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565   <span class="comment">// Is this msg for us?</span>
<a name="l00566"></a>00566   <span class="keywordflow">if</span>(0 == _pDest)
<a name="l00567"></a>00567   {
<a name="l00568"></a>00568     <span class="keywordflow">switch</span> (_DAT)
<a name="l00569"></a>00569     {
<a name="l00570"></a>00570       <span class="keywordflow">case</span> DAT_PARENT:
<a name="l00571"></a>00571         rcDSM = <a class="code" href="dsm_8cpp.html#a44ab2e81853c2a7352a91e3f542f5c6">DSM_Parent</a>(_pOrigin, _MSG);
<a name="l00572"></a>00572         <span class="keywordflow">break</span>;
<a name="l00573"></a>00573 
<a name="l00574"></a>00574       <span class="keywordflow">case</span> DAT_IDENTITY:
<a name="l00575"></a>00575         rcDSM = <a class="code" href="dsm_8cpp.html#f9713025040f399ad28a4e280d9a5bb7">DSM_Identity</a>(_pOrigin, _MSG, (<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a>)_pData);
<a name="l00576"></a>00576         <span class="keywordflow">break</span>;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578       <span class="keywordflow">case</span> DAT_STATUS:
<a name="l00579"></a>00579         rcDSM = <a class="code" href="dsm_8cpp.html#798fef7de803d0a7e9c8c615fdbf1eea">DSM_Status</a>(_pOrigin, _MSG, (<a class="code" href="structTW__STATUS.html">pTW_STATUS</a>)_pData);
<a name="l00580"></a>00580         <span class="keywordflow">break</span>;
<a name="l00581"></a>00581 
<a name="l00582"></a>00582       <span class="keywordflow">case</span> DAT_CALLBACK:
<a name="l00583"></a>00583         rcDSM = <a class="code" href="dsm_8cpp.html#c4824709a89ce0f31f9f15603bdaa48d">DSM_Callback</a>(_pOrigin, _MSG, (<a class="code" href="structTW__CALLBACK.html">pTW_CALLBACK</a>)_pData);
<a name="l00584"></a>00584         <span class="keywordflow">break</span>;
<a name="l00585"></a>00585 
<a name="l00586"></a>00586       <span class="keywordflow">default</span>:
<a name="l00587"></a>00587         <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pOrigin, TWCC_BADPROTOCOL);
<a name="l00588"></a>00588         rcDSM = TWRC_FAILURE;
<a name="l00589"></a>00589         <span class="keywordflow">break</span>;
<a name="l00590"></a>00590     }
<a name="l00591"></a>00591   }
<a name="l00592"></a>00592   <span class="keywordflow">else</span> <span class="comment">// Not for us, send to appropriate source</span>
<a name="l00593"></a>00593   {
<a name="l00594"></a>00594     <span class="comment">// check if the application is open or not.  If it isn't, we have a bad sequence</span>
<a name="l00595"></a>00595     <span class="keywordflow">if</span>( _pOrigin-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &gt; 0 &amp;&amp; _pOrigin-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a> &amp;&amp;
<a name="l00596"></a>00596         <a class="code" href="dsmdefs_8h.html#513232ae32b4d545c93a45ccae4694622fcd5137c8fd3109f28e2153090b4a43">dsmState_Open</a> == <a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pOrigin-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)].CurrentState )
<a name="l00597"></a>00597     {
<a name="l00598"></a>00598       rcDSM = <a class="code" href="dsm_8cpp.html#afdc094c70146d2988ddc67ee08298b2">EntryDS</a>(_pOrigin, _pDest, _DG, _DAT, _MSG, _pData);
<a name="l00599"></a>00599     }
<a name="l00600"></a>00600     <span class="keywordflow">else</span>
<a name="l00601"></a>00601     {
<a name="l00602"></a>00602       <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pOrigin, TWCC_SEQERROR);
<a name="l00603"></a>00603       rcDSM = TWRC_FAILURE;
<a name="l00604"></a>00604     }
<a name="l00605"></a>00605   }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607   <span class="keywordflow">if</span>( bPrinted )
<a name="l00608"></a>00608   {
<a name="l00609"></a>00609     <a class="code" href="dsm_8cpp.html#92959e187d12b1470d7899c6498c8fc9">printReturnCode</a>( rcDSM );
<a name="l00610"></a>00610   }
<a name="l00611"></a>00611 
<a name="l00612"></a>00612   <span class="keywordflow">return</span> rcDSM;
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 
<a name="l00616"></a><a class="code" href="dsm_8cpp.html#798fef7de803d0a7e9c8c615fdbf1eea">00616</a> TW_INT16 <a class="code" href="dsm_8cpp.html#798fef7de803d0a7e9c8c615fdbf1eea">DSM_Status</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, TW_UINT16 _MSG, <a class="code" href="structTW__STATUS.html">pTW_STATUS</a> _pStatus)
<a name="l00617"></a>00617 {
<a name="l00618"></a>00618   TW_INT16 result = TWRC_SUCCESS;
<a name="l00619"></a>00619 
<a name="l00620"></a>00620   <span class="keywordflow">switch</span> (_MSG)
<a name="l00621"></a>00621   {
<a name="l00622"></a>00622     <span class="keywordflow">case</span> MSG_GET:
<a name="l00623"></a>00623       {
<a name="l00624"></a>00624         <span class="comment">// If the application has not registered with the DSM yet, then act on the</span>
<a name="l00625"></a>00625         <span class="comment">// global condition code instead of the application specific one.</span>
<a name="l00626"></a>00626         <span class="comment">// This will only happen on very rare occasions where the condition code</span>
<a name="l00627"></a>00627         <span class="comment">// could not be set because the calling application was ambiguous.</span>
<a name="l00628"></a>00628         _pStatus-&gt;<a class="code" href="structTW__STATUS.html#7fca01721d88d8038218f460f5c24a87">ConditionCode</a> = <a class="code" href="dsm_8cpp.html#e77f69cd5a9efa7683e07bb81e424ad0">getConditionCode</a>(_pAppIdentity);
<a name="l00629"></a>00629         _pStatus-&gt;<a class="code" href="structTW__STATUS.html#5a1ee032c96b15fa56d3cd3b94f906ad">Reserved</a> = 0;
<a name="l00630"></a>00630       }
<a name="l00631"></a>00631       <span class="keywordflow">break</span>;
<a name="l00632"></a>00632 
<a name="l00633"></a>00633     <span class="keywordflow">default</span>:
<a name="l00634"></a>00634       result = TWRC_FAILURE;
<a name="l00635"></a>00635       <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_BADPROTOCOL);
<a name="l00636"></a>00636       <span class="keywordflow">break</span>;
<a name="l00637"></a>00637   }
<a name="l00638"></a>00638 
<a name="l00639"></a>00639   <span class="keywordflow">return</span> result;
<a name="l00640"></a>00640 }
<a name="l00641"></a>00641 
<a name="l00643"></a><a class="code" href="dsm_8cpp.html#a44ab2e81853c2a7352a91e3f542f5c6">00643</a> TW_INT16 <a class="code" href="dsm_8cpp.html#a44ab2e81853c2a7352a91e3f542f5c6">DSM_Parent</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, TW_UINT16 _MSG)
<a name="l00644"></a>00644 {
<a name="l00645"></a>00645   TW_INT16 result = TWRC_SUCCESS;
<a name="l00646"></a>00646   assert(_pAppIdentity);
<a name="l00647"></a>00647 
<a name="l00648"></a>00648   <span class="keywordflow">switch</span> (_MSG)
<a name="l00649"></a>00649   {
<a name="l00650"></a>00650     <span class="keywordflow">case</span> MSG_OPENDSM:
<a name="l00651"></a>00651       <span class="comment">// see if we have reached our limit of maximum applications</span>
<a name="l00652"></a>00652       <span class="keywordflow">if</span>(<a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a> == <a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#21e47849a385b5bb080e8266e76102c4">NumApps</a>)
<a name="l00653"></a>00653       {
<a name="l00654"></a>00654         <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_MAXCONNECTIONS);
<a name="l00655"></a>00655         <span class="keywordflow">return</span> TWRC_FAILURE;
<a name="l00656"></a>00656       }
<a name="l00657"></a>00657 
<a name="l00658"></a>00658       <span class="keywordflow">if</span>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#4e3c2507fbbdaff9472c8316b38fd8d9">ProductName</a>[0] == 0)
<a name="l00659"></a>00659       {
<a name="l00660"></a>00660         <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_BADVALUE);
<a name="l00661"></a>00661         <span class="keywordflow">return</span> TWRC_FAILURE;
<a name="l00662"></a>00662       }
<a name="l00663"></a>00663 
<a name="l00664"></a>00664       <span class="comment">// Only add apps that have not already been added...</span>
<a name="l00665"></a>00665       <span class="keywordflow">if</span>(0 == <a class="code" href="dsm_8cpp.html#536a09bd6c21c5878a1f9b7313a3eca7">findApplicationByName</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#4e3c2507fbbdaff9472c8316b38fd8d9">ProductName</a>))
<a name="l00666"></a>00666       {
<a name="l00667"></a>00667         <span class="comment">// new application, add it to the list and get assigned an ID</span>
<a name="l00668"></a>00668         result = <a class="code" href="dsm_8cpp.html#f803eab9bf60870b52a44127de24ec91">AddApplication</a>(_pAppIdentity);
<a name="l00669"></a>00669       }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671       <span class="keywordflow">if</span>(result == TWRC_SUCCESS)
<a name="l00672"></a>00672       {
<a name="l00673"></a>00673         assert(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l00674"></a>00674         <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l00675"></a>00675 
<a name="l00676"></a>00676         <span class="comment">// move DSM to state 3 for this app</span>
<a name="l00677"></a>00677         pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#5c67c400e02c59c04872917d7d379a26">CurrentState</a> = <a class="code" href="dsmdefs_8h.html#513232ae32b4d545c93a45ccae4694622fcd5137c8fd3109f28e2153090b4a43">dsmState_Open</a>;
<a name="l00678"></a>00678 
<a name="l00679"></a>00679         result = <a class="code" href="dsm_8cpp.html#c7c1874a18c61e4d88e020cedcc3aa94">LoadAllDataSources</a>(_pAppIdentity, pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>);
<a name="l00680"></a>00680       }
<a name="l00681"></a>00681       <span class="keywordflow">break</span>;
<a name="l00682"></a>00682 
<a name="l00683"></a>00683     <span class="keywordflow">case</span> MSG_CLOSEDSM:
<a name="l00684"></a>00684       {
<a name="l00685"></a>00685         assert(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &gt; 0 &amp;&amp; _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l00686"></a>00686         <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l00687"></a>00687         <span class="comment">// To close the DSM we must be open ... </span>
<a name="l00688"></a>00688         <span class="keywordflow">if</span>(<a class="code" href="dsmdefs_8h.html#513232ae32b4d545c93a45ccae4694622fcd5137c8fd3109f28e2153090b4a43">dsmState_Open</a> != pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#5c67c400e02c59c04872917d7d379a26">CurrentState</a>)
<a name="l00689"></a>00689         {
<a name="l00690"></a>00690           <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_SEQERROR);
<a name="l00691"></a>00691           <span class="keywordflow">return</span>(TWRC_FAILURE);
<a name="l00692"></a>00692         }
<a name="l00693"></a>00693         <span class="comment">// ...but no DS can be open</span>
<a name="l00694"></a>00694         <span class="keywordflow">if</span>( -1 != pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#dee54707e2685067ec6a66ed1374a261">OpenSource</a> )
<a name="l00695"></a>00695         {
<a name="l00696"></a>00696           <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_SEQERROR);
<a name="l00697"></a>00697           <span class="keywordflow">return</span>(TWRC_FAILURE);
<a name="l00698"></a>00698         }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700         <span class="comment">//unload all DS for this App</span>
<a name="l00701"></a>00701         <a class="code" href="dsm_8cpp.html#7c841b1d9a57e77b22a2aaf5a78815f2">UnLoadAllDS</a>(_pAppIdentity);
<a name="l00702"></a>00702 
<a name="l00703"></a>00703         <span class="keyword">delete</span> pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>;
<a name="l00704"></a>00704         pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a> = NULL;
<a name="l00705"></a>00705         pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#2ca72dc24f8e4965e473c9f14ea106e4">pOrigin</a> = NULL;
<a name="l00706"></a>00706 
<a name="l00707"></a>00707         <a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#21e47849a385b5bb080e8266e76102c4">NumApps</a>--;
<a name="l00708"></a>00708 
<a name="l00709"></a>00709         <span class="comment">// switch applications DSM state to state 2</span>
<a name="l00710"></a>00710         pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#5c67c400e02c59c04872917d7d379a26">CurrentState</a> = <a class="code" href="dsmdefs_8h.html#513232ae32b4d545c93a45ccae469462aad64de0004a318b7671bebd6aaba09b">dsmState_Loaded</a>;
<a name="l00711"></a>00711 
<a name="l00712"></a>00712         <span class="comment">// If this is the last application to close the DSM then we need to </span>
<a name="l00713"></a>00713         <span class="comment">// prepair to exit.</span>
<a name="l00714"></a>00714         <span class="keywordtype">bool</span> bAllAppsClosed = <span class="keyword">true</span>;
<a name="l00715"></a>00715         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i &lt; <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>;  i++)
<a name="l00716"></a>00716         {
<a name="l00717"></a>00717           <span class="keywordflow">if</span>( <a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[i].<a class="code" href="structAPP__INFO.html#2ca72dc24f8e4965e473c9f14ea106e4">pOrigin</a> != NULL &amp;&amp;
<a name="l00718"></a>00718               <a class="code" href="dsmdefs_8h.html#513232ae32b4d545c93a45ccae4694622fcd5137c8fd3109f28e2153090b4a43">dsmState_Open</a> &lt;= <a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[i].<a class="code" href="structAPP__INFO.html#5c67c400e02c59c04872917d7d379a26">CurrentState</a> )
<a name="l00719"></a>00719           {
<a name="l00720"></a>00720             bAllAppsClosed = <span class="keyword">false</span>;
<a name="l00721"></a>00721             <span class="keywordflow">break</span>;
<a name="l00722"></a>00722           }
<a name="l00723"></a>00723         }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725         <span class="keywordflow">if</span>( bAllAppsClosed )
<a name="l00726"></a>00726         {
<a name="l00727"></a>00727           <span class="comment">//if all are closed then there should not be any left</span>
<a name="l00728"></a>00728           assert(<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#21e47849a385b5bb080e8266e76102c4">NumApps</a> == 0);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730           <a class="code" href="dsm_8cpp.html#9d5668b97fc31481bdac668eecb545d6">_gFrameworkInitialized</a> = <a class="code" href="dsmdefs_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00731"></a>00731           <span class="keywordflow">if</span>(<a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a>)
<a name="l00732"></a>00732           {
<a name="l00733"></a>00733             <span class="keywordflow">if</span>(gpLogFile-&gt;is_open())
<a name="l00734"></a>00734             {
<a name="l00735"></a>00735               *gpLogFile &lt;&lt; endl;
<a name="l00736"></a>00736               gpLogFile-&gt;close();
<a name="l00737"></a>00737             }
<a name="l00738"></a>00738             <span class="keyword">delete</span> <a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a>;
<a name="l00739"></a>00739             <a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a> = 0;
<a name="l00740"></a>00740           }
<a name="l00741"></a>00741         }
<a name="l00742"></a>00742       }
<a name="l00743"></a>00743       <span class="keywordflow">break</span>;
<a name="l00744"></a>00744 
<a name="l00745"></a>00745     <span class="keywordflow">default</span>:
<a name="l00746"></a>00746       result = TWRC_FAILURE;
<a name="l00747"></a>00747       <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_BADPROTOCOL);
<a name="l00748"></a>00748       <span class="keywordflow">break</span>;
<a name="l00749"></a>00749   }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751   <span class="keywordflow">return</span> result;
<a name="l00752"></a>00752 }
<a name="l00753"></a>00753 
<a name="l00755"></a><a class="code" href="dsm_8cpp.html#f9713025040f399ad28a4e280d9a5bb7">00755</a> TW_INT16 <a class="code" href="dsm_8cpp.html#f9713025040f399ad28a4e280d9a5bb7">DSM_Identity</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, TW_UINT16 _MSG, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity)
<a name="l00756"></a>00756 {
<a name="l00757"></a>00757   TW_INT16 result = TWRC_SUCCESS;
<a name="l00758"></a>00758   assert(_pAppIdentity &amp;&amp; _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l00759"></a>00759   <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l00760"></a>00760 
<a name="l00761"></a>00761   <span class="keywordflow">if</span>(<a class="code" href="dsmdefs_8h.html#513232ae32b4d545c93a45ccae4694622fcd5137c8fd3109f28e2153090b4a43">dsmState_Open</a> == pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#5c67c400e02c59c04872917d7d379a26">CurrentState</a>)
<a name="l00762"></a>00762   {
<a name="l00763"></a>00763     <span class="keywordflow">switch</span> (_MSG)
<a name="l00764"></a>00764     {
<a name="l00765"></a>00765       <span class="keywordflow">case</span> MSG_OPENDS:
<a name="l00766"></a>00766         result = <a class="code" href="dsm_8cpp.html#eb01f399d5aef68a5231229cc80829b4">OpenDS</a>(_pAppIdentity, _pSourceIdentity);
<a name="l00767"></a>00767         <span class="keywordflow">break</span>;
<a name="l00768"></a>00768 
<a name="l00769"></a>00769       <span class="keywordflow">case</span> MSG_CLOSEDS:
<a name="l00770"></a>00770         result = <a class="code" href="dsm_8cpp.html#5b2529dc6844449eb5560b0f68a39937">CloseDS</a>(_pAppIdentity, _pSourceIdentity);
<a name="l00771"></a>00771         <span class="keywordflow">break</span>;
<a name="l00772"></a>00772 
<a name="l00773"></a>00773       <span class="keywordflow">case</span> MSG_USERSELECT:
<a name="l00774"></a>00774         result = <a class="code" href="dsm_8cpp.html#8cb3b3faec177a1cc902def63f892b79">DSM_SelectDS</a>(_pAppIdentity, _pSourceIdentity);
<a name="l00775"></a>00775         <span class="keywordflow">break</span>;
<a name="l00776"></a>00776 
<a name="l00777"></a>00777       <span class="keywordflow">case</span> MSG_GETFIRST:
<a name="l00778"></a>00778         result = <a class="code" href="dsm_8cpp.html#ce8cced59081aa02e57e6d3c969f94d5">DSM_GetFirst</a>(_pAppIdentity, _pSourceIdentity);
<a name="l00779"></a>00779         <span class="keywordflow">break</span>;
<a name="l00780"></a>00780 
<a name="l00781"></a>00781       <span class="keywordflow">case</span> MSG_GETNEXT:
<a name="l00782"></a>00782         result = <a class="code" href="dsm_8cpp.html#aed56229345c051c1500eee8c9f55305">DSM_GetNext</a>(_pAppIdentity, _pSourceIdentity);
<a name="l00783"></a>00783         <span class="keywordflow">break</span>;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785       <span class="keywordflow">case</span> MSG_GETDEFAULT:
<a name="l00786"></a>00786         result = <a class="code" href="dsm_8cpp.html#cf4a1fd18d2caafb1a7de88ecba2afab">GetMatchingDefault</a>(_pAppIdentity, _pSourceIdentity);
<a name="l00787"></a>00787         <span class="keywordflow">break</span>;
<a name="l00788"></a>00788 
<a name="l00789"></a>00789       <span class="keywordflow">default</span>:
<a name="l00790"></a>00790         result = TWRC_FAILURE;
<a name="l00791"></a>00791         <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_BADPROTOCOL);
<a name="l00792"></a>00792         <span class="keywordflow">break</span>;
<a name="l00793"></a>00793     }
<a name="l00794"></a>00794   }
<a name="l00795"></a>00795   <span class="keywordflow">else</span>
<a name="l00796"></a>00796   {
<a name="l00797"></a>00797     result = TWRC_FAILURE;
<a name="l00798"></a>00798     <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_SEQERROR);
<a name="l00799"></a>00799   }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801   <span class="keywordflow">return</span> result;
<a name="l00802"></a>00802 }
<a name="l00803"></a>00803 
<a name="l00805"></a><a class="code" href="dsm_8cpp.html#c4824709a89ce0f31f9f15603bdaa48d">00805</a> TW_INT16 <a class="code" href="dsm_8cpp.html#c4824709a89ce0f31f9f15603bdaa48d">DSM_Callback</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity,
<a name="l00806"></a>00806                       TW_UINT16    _MSG,
<a name="l00807"></a>00807                       <a class="code" href="structTW__CALLBACK.html">pTW_CALLBACK</a> _pData)
<a name="l00808"></a>00808 {
<a name="l00809"></a>00809   TW_INT16 result = TWRC_SUCCESS;
<a name="l00810"></a>00810   assert(_pAppIdentity &amp;&amp; _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l00811"></a>00811   <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l00812"></a>00812 
<a name="l00813"></a>00813   <span class="keywordflow">switch</span>(_MSG)
<a name="l00814"></a>00814   {
<a name="l00815"></a>00815     <span class="keywordflow">case</span> MSG_REGISTER_CALLBACK:
<a name="l00816"></a>00816       {
<a name="l00817"></a>00817         memset(&amp;(pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#a00cb746097e2d305fa92ee6d231092d">Callback</a>), 0, <span class="keyword">sizeof</span>(<a class="code" href="structCallBackInfo.html">CallBackInfo</a>));
<a name="l00818"></a>00818         pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#a00cb746097e2d305fa92ee6d231092d">Callback</a>.<a class="code" href="structCallBackInfo.html#58b10afd686c9ff1e32249a2ce235855">callback</a>.<a class="code" href="structTW__CALLBACK.html#b15caaafceed7c1a0934fba9463855e2">CallBackProc</a> = _pData-&gt;<a class="code" href="structTW__CALLBACK.html#b15caaafceed7c1a0934fba9463855e2">CallBackProc</a>;
<a name="l00819"></a>00819         pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#a00cb746097e2d305fa92ee6d231092d">Callback</a>.<a class="code" href="structCallBackInfo.html#58b10afd686c9ff1e32249a2ce235855">callback</a>.<a class="code" href="structTW__CALLBACK.html#360d358dbe1ba472eb5b519c8ab2f22e">RefCon</a> = _pData-&gt;<a class="code" href="structTW__CALLBACK.html#360d358dbe1ba472eb5b519c8ab2f22e">RefCon</a>;
<a name="l00820"></a>00820       }
<a name="l00821"></a>00821       <span class="keywordflow">break</span>;
<a name="l00822"></a>00822 
<a name="l00823"></a>00823     <span class="keywordflow">default</span>:
<a name="l00824"></a>00824       result = TWRC_FAILURE;
<a name="l00825"></a>00825       <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_BADPROTOCOL);
<a name="l00826"></a>00826       <span class="keywordflow">break</span>;
<a name="l00827"></a>00827   }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829   <span class="keywordflow">return</span> result;
<a name="l00830"></a>00830 }
<a name="l00831"></a>00831 
<a name="l00833"></a><a class="code" href="dsm_8cpp.html#50d2da44e016d1a1ececa8357c3d4f29">00833</a> TW_INT16 <a class="code" href="dsm_8cpp.html#50d2da44e016d1a1ececa8357c3d4f29">DSM_InitializeDSM</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity)
<a name="l00834"></a>00834 {
<a name="l00835"></a>00835   TW_INT16 ret = TWRC_SUCCESS;
<a name="l00836"></a>00836 
<a name="l00837"></a>00837   <span class="comment">// store our pid for convenience.</span>
<a name="l00838"></a>00838 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00839"></a>00839 <span class="preprocessor"></span>  <a class="code" href="dsm_8cpp.html#05d5448e7ae3f9f6ff48b76c39825715">gOurPid</a> = GetCurrentThreadId();
<a name="l00840"></a>00840 <span class="preprocessor">#else</span>
<a name="l00841"></a>00841 <span class="preprocessor"></span>  <a class="code" href="dsm_8cpp.html#05d5448e7ae3f9f6ff48b76c39825715">gOurPid</a> = getpid();
<a name="l00842"></a>00842 <span class="preprocessor">#endif // _WIN32</span>
<a name="l00843"></a>00843 <span class="preprocessor"></span>
<a name="l00844"></a>00844   <span class="comment">// see if a logfile is to be used</span>
<a name="l00845"></a>00845   <span class="keywordtype">char</span>* logpath = getenv(<a class="code" href="dsm_8cpp.html#e62b35eda4fad54b1928fa578b3aa9c2">kLOGENV</a>);
<a name="l00846"></a>00846   <span class="keywordflow">if</span>(0 != logpath &amp;&amp; 0 == <a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a>)
<a name="l00847"></a>00847   {
<a name="l00848"></a>00848     <a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a> = <span class="keyword">new</span> ofstream(logpath, ios::app);
<a name="l00849"></a>00849 
<a name="l00850"></a>00850     <span class="keywordflow">if</span>(!<a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a>-&gt;is_open())
<a name="l00851"></a>00851     {
<a name="l00852"></a>00852       cerr &lt;&lt; <span class="stringliteral">"DSM: Error - logging has been disabled because logfile could not be opened: "</span> &lt;&lt; logpath &lt;&lt; endl;
<a name="l00853"></a>00853       <span class="keyword">delete</span> <a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a>;
<a name="l00854"></a>00854       <a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a> = 0;
<a name="l00855"></a>00855     }
<a name="l00856"></a>00856   }
<a name="l00857"></a>00857 
<a name="l00858"></a>00858   memset(&amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>));
<a name="l00859"></a>00859   memset(<a class="code" href="dsm_8cpp.html#6bc385ca03d3f2a27e1376c1d67a7aaa">_gDefaultDSPath</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="dsm_8cpp.html#6bc385ca03d3f2a27e1376c1d67a7aaa">_gDefaultDSPath</a>));
<a name="l00860"></a>00860   memset(<a class="code" href="dsm_8cpp.html#60f4da5c3d0621d10645495de11c2f1f">_gDefaultDSName</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="dsm_8cpp.html#60f4da5c3d0621d10645495de11c2f1f">_gDefaultDSName</a>));
<a name="l00861"></a>00861 
<a name="l00862"></a>00862   <a class="code" href="dsm_8cpp.html#9d5668b97fc31481bdac668eecb545d6">_gFrameworkInitialized</a> = <a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00863"></a>00863 
<a name="l00864"></a>00864   <span class="keywordflow">return</span> ret;
<a name="l00865"></a>00865 }
<a name="l00866"></a>00866 
<a name="l00868"></a><a class="code" href="dsm_8cpp.html#eb01f399d5aef68a5231229cc80829b4">00868</a> TW_INT16 <a class="code" href="dsm_8cpp.html#eb01f399d5aef68a5231229cc80829b4">OpenDS</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity)
<a name="l00869"></a>00869 {
<a name="l00870"></a>00870   TW_INT16 result = TWRC_FAILURE;
<a name="l00871"></a>00871   assert(_pAppIdentity &amp;&amp; _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l00872"></a>00872   <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l00873"></a>00873 
<a name="l00874"></a>00874   <span class="comment">// check that we are in the proper state</span>
<a name="l00875"></a>00875   <span class="keywordflow">if</span>(<a class="code" href="dsmdefs_8h.html#513232ae32b4d545c93a45ccae4694622fcd5137c8fd3109f28e2153090b4a43">dsmState_Open</a> != pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#5c67c400e02c59c04872917d7d379a26">CurrentState</a>)
<a name="l00876"></a>00876   {
<a name="l00877"></a>00877     <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_SEQERROR);
<a name="l00878"></a>00878     <span class="keywordflow">return</span>(TWRC_FAILURE);
<a name="l00879"></a>00879   }
<a name="l00880"></a>00880 
<a name="l00881"></a>00881   <span class="comment">// Do we need to find a source to open</span>
<a name="l00882"></a>00882   <span class="keywordflow">if</span>(0 == _pSourceIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)
<a name="l00883"></a>00883   {
<a name="l00884"></a>00884     <span class="comment">// Does the app know the name of the source it wants to open</span>
<a name="l00885"></a>00885     <span class="keywordflow">if</span>(0 != _pSourceIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#4e3c2507fbbdaff9472c8316b38fd8d9">ProductName</a>[0])
<a name="l00886"></a>00886     {
<a name="l00887"></a>00887       <span class="comment">// The application is passing me a TW_IDENTITY structure that contains</span>
<a name="l00888"></a>00888       <span class="comment">// the name of the source to select.</span>
<a name="l00889"></a>00889       result = <a class="code" href="dsm_8cpp.html#fd2d9abc3115143298ecd88c5974da42">GetDSFromProductName</a>(_pAppIdentity, _pSourceIdentity);
<a name="l00890"></a>00890 
<a name="l00891"></a>00891       <span class="comment">// was the id found or specified by the app?</span>
<a name="l00892"></a>00892       <span class="keywordflow">if</span>(TWRC_SUCCESS != result)
<a name="l00893"></a>00893       {
<a name="l00894"></a>00894         <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_NODS);
<a name="l00895"></a>00895         <span class="keywordflow">return</span>(result);
<a name="l00896"></a>00896       }
<a name="l00897"></a>00897     }
<a name="l00898"></a>00898 
<a name="l00899"></a>00899     <span class="comment">// Does the application want me to choose the default?</span>
<a name="l00900"></a>00900     <span class="comment">// Or no Source located by name</span>
<a name="l00901"></a>00901     <span class="keywordflow">if</span>(0 == _pSourceIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#4e3c2507fbbdaff9472c8316b38fd8d9">ProductName</a>[0]) 
<a name="l00902"></a>00902     {
<a name="l00903"></a>00903       <span class="comment">// -if the name of the source is NULL, and the id is 0, the application is</span>
<a name="l00904"></a>00904       <span class="comment">//  telling me to select the default source.</span>
<a name="l00905"></a>00905       result = <a class="code" href="dsm_8cpp.html#cf4a1fd18d2caafb1a7de88ecba2afab">GetMatchingDefault</a>(_pAppIdentity, _pSourceIdentity);
<a name="l00906"></a>00906 
<a name="l00907"></a>00907       <span class="comment">// was the id found or specified by the app?</span>
<a name="l00908"></a>00908       <span class="keywordflow">if</span>(TWRC_SUCCESS != result)
<a name="l00909"></a>00909       {
<a name="l00910"></a>00910         <span class="keywordflow">return</span>(result);
<a name="l00911"></a>00911       }
<a name="l00912"></a>00912     }
<a name="l00913"></a>00913   }
<a name="l00914"></a>00914 
<a name="l00915"></a>00915   <span class="comment">// Do a quick check that the id of the DS given is not out of range</span>
<a name="l00916"></a>00916   <span class="keywordflow">if</span>(_pSourceIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &gt; pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#07dd92469632391cc5ec7a6b428936b9">NumFiles</a>)
<a name="l00917"></a>00917   {
<a name="l00918"></a>00918     <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_NODS);
<a name="l00919"></a>00919     <span class="keywordflow">return</span>(TWRC_FAILURE);
<a name="l00920"></a>00920   }
<a name="l00921"></a>00921 
<a name="l00922"></a>00922   <span class="comment">// open the ds</span>
<a name="l00923"></a>00923   <a class="code" href="structDS__INFO.html">pDS_INFO</a> pDSInfo = &amp;pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pSourceIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l00924"></a>00924   <span class="keywordflow">if</span>(0 != pDSInfo-&gt;<a class="code" href="structDS__INFO.html#ae706672ae20aeef21240935e94876bd">DS_Entry</a>)
<a name="l00925"></a>00925   {
<a name="l00926"></a>00926     result = pDSInfo-&gt;<a class="code" href="structDS__INFO.html#ae706672ae20aeef21240935e94876bd">DS_Entry</a>(_pAppIdentity,
<a name="l00927"></a>00927              DG_CONTROL,
<a name="l00928"></a>00928              DAT_IDENTITY,
<a name="l00929"></a>00929              MSG_OPENDS,
<a name="l00930"></a>00930              (TW_MEMREF) _pSourceIdentity);
<a name="l00931"></a>00931 
<a name="l00932"></a>00932     <span class="keywordflow">if</span>(TWRC_SUCCESS == result)
<a name="l00933"></a>00933     {
<a name="l00934"></a>00934       <span class="comment">// update the applications datastruct with the successfully opened source.</span>
<a name="l00935"></a>00935       pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#dee54707e2685067ec6a66ed1374a261">OpenSource</a> = TW_INT16(<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pSourceIdentity-&gt;Id));
<a name="l00936"></a>00936       pDSInfo-&gt;<a class="code" href="structDS__INFO.html#f43907e80523836bd08c206d23bbf692">bOpen</a> = <a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00937"></a>00937     }
<a name="l00938"></a>00938     <span class="keywordflow">else</span>
<a name="l00939"></a>00939     {
<a name="l00940"></a>00940       <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_OPERATIONERROR);
<a name="l00941"></a>00941     }
<a name="l00942"></a>00942   }
<a name="l00943"></a>00943 
<a name="l00944"></a>00944   <span class="keywordflow">return</span> result;
<a name="l00945"></a>00945 }
<a name="l00946"></a>00946 
<a name="l00948"></a><a class="code" href="dsm_8cpp.html#5b2529dc6844449eb5560b0f68a39937">00948</a> TW_INT16 <a class="code" href="dsm_8cpp.html#5b2529dc6844449eb5560b0f68a39937">CloseDS</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity)
<a name="l00949"></a>00949 {
<a name="l00950"></a>00950   TW_INT16 result = TWRC_SUCCESS;
<a name="l00951"></a>00951   assert(_pAppIdentity &amp;&amp; _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l00952"></a>00952   <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l00953"></a>00953 
<a name="l00954"></a>00954   <span class="comment">// check that we are in the proper state</span>
<a name="l00955"></a>00955   <span class="keywordflow">if</span>(<a class="code" href="dsmdefs_8h.html#513232ae32b4d545c93a45ccae4694622fcd5137c8fd3109f28e2153090b4a43">dsmState_Open</a> != pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#5c67c400e02c59c04872917d7d379a26">CurrentState</a>)
<a name="l00956"></a>00956   {
<a name="l00957"></a>00957     <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_SEQERROR);
<a name="l00958"></a>00958     <span class="keywordflow">return</span>(TWRC_FAILURE);
<a name="l00959"></a>00959   }
<a name="l00960"></a>00960 
<a name="l00961"></a>00961   <span class="comment">// close the ds</span>
<a name="l00962"></a>00962   <a class="code" href="structDS__INFO.html">pDS_INFO</a> pDSInfo = &amp;pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pSourceIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l00963"></a>00963   <span class="keywordflow">if</span>(0 != pDSInfo-&gt;<a class="code" href="structDS__INFO.html#ae706672ae20aeef21240935e94876bd">DS_Entry</a>)
<a name="l00964"></a>00964   {
<a name="l00965"></a>00965     result = pDSInfo-&gt;<a class="code" href="structDS__INFO.html#ae706672ae20aeef21240935e94876bd">DS_Entry</a>(_pAppIdentity,
<a name="l00966"></a>00966              DG_CONTROL,
<a name="l00967"></a>00967              DAT_IDENTITY,
<a name="l00968"></a>00968              MSG_CLOSEDS,
<a name="l00969"></a>00969              (TW_MEMREF) _pSourceIdentity);
<a name="l00970"></a>00970 
<a name="l00971"></a>00971     <span class="keywordflow">if</span>(TWRC_SUCCESS == result)
<a name="l00972"></a>00972     {
<a name="l00973"></a>00973       pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#dee54707e2685067ec6a66ed1374a261">OpenSource</a> = -1;
<a name="l00974"></a>00974       pDSInfo-&gt;<a class="code" href="structDS__INFO.html#f43907e80523836bd08c206d23bbf692">bOpen</a> = <a class="code" href="dsmdefs_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00975"></a>00975     }
<a name="l00976"></a>00976     <span class="keywordflow">else</span>
<a name="l00977"></a>00977     {
<a name="l00978"></a>00978       <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_OPERATIONERROR);
<a name="l00979"></a>00979     }
<a name="l00980"></a>00980   }
<a name="l00981"></a>00981 
<a name="l00982"></a>00982   <span class="keywordflow">return</span> result;
<a name="l00983"></a>00983 }
<a name="l00984"></a>00984 
<a name="l00985"></a>00985 
<a name="l00986"></a>00986 <span class="comment">/*</span>
<a name="l00987"></a>00987 <span class="comment">* data to pass in and out of select Dialog funtion SelectDlgProc</span>
<a name="l00988"></a>00988 <span class="comment">*/</span>
<a name="l00989"></a><a class="code" href="dsm_8cpp.html#3d2dcae4d0d8e6e3f09a2248b643cce8">00989</a> <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a>  <a class="code" href="dsm_8cpp.html#3d2dcae4d0d8e6e3f09a2248b643cce8">g_pSelectDlgSourceID</a>; 
<a name="l00990"></a><a class="code" href="dsm_8cpp.html#d862616a9d73ac0c177071dffa299d8b">00990</a> <a class="code" href="structDS__LIST.html">pDS_LIST</a>      <a class="code" href="dsm_8cpp.html#d862616a9d73ac0c177071dffa299d8b">g_pSelectDlgDSList</a>;   
<a name="l01000"></a><a class="code" href="dsm_8cpp.html#bd3b2b927edd91b7596dadebeece0129">01000</a> BOOL CALLBACK <a class="code" href="dsm_8cpp.html#bd3b2b927edd91b7596dadebeece0129">SelectDlgProc</a>(HWND hWnd, UINT Message, WPARAM wParam, LPARAM lParam)
<a name="l01001"></a>01001 {
<a name="l01002"></a>01002   <span class="keywordflow">switch</span>(Message)
<a name="l01003"></a>01003   {
<a name="l01004"></a>01004     <span class="keywordflow">case</span> WM_INITDIALOG:
<a name="l01005"></a>01005     {
<a name="l01006"></a>01006       HWND hListBox = ::GetDlgItem(hWnd, ID_LST_SOURCES); 
<a name="l01007"></a>01007       <span class="keywordflow">if</span> ( hListBox ) 
<a name="l01008"></a>01008       {
<a name="l01009"></a>01009         assert(<a class="code" href="dsm_8cpp.html#d862616a9d73ac0c177071dffa299d8b">g_pSelectDlgDSList</a>);
<a name="l01010"></a>01010         <span class="keywordtype">int</span>       nIndex;
<a name="l01011"></a>01011 
<a name="l01012"></a>01012         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x = 0; x &lt; g_pSelectDlgDSList-&gt;NumFiles; ++x)
<a name="l01013"></a>01013         {
<a name="l01014"></a>01014           <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> ptmpIdent = &amp;g_pSelectDlgDSList-&gt;DSInfo[x].Identity;
<a name="l01015"></a>01015 
<a name="l01016"></a>01016           nIndex = (<span class="keywordtype">int</span>)SendMessage( hListBox, LB_ADDSTRING, (WPARAM)NULL, (LPARAM)ptmpIdent-&gt;ProductName);
<a name="l01017"></a>01017           <span class="keywordflow">if</span>(LB_ERR == nIndex)
<a name="l01018"></a>01018           {
<a name="l01019"></a>01019             <span class="keywordflow">break</span>;
<a name="l01020"></a>01020           }
<a name="l01021"></a>01021           nIndex = (int)SendMessage( hListBox, LB_SETITEMDATA, (WPARAM)nIndex, (LPARAM)ptmpIdent-&gt;Id);
<a name="l01022"></a>01022           <span class="keywordflow">if</span>(LB_ERR == nIndex)
<a name="l01023"></a>01023           {
<a name="l01024"></a>01024             <span class="keywordflow">break</span>;
<a name="l01025"></a>01025           }
<a name="l01026"></a>01026         }
<a name="l01027"></a>01027         <span class="keywordflow">if</span>(<a class="code" href="dsm_8cpp.html#d862616a9d73ac0c177071dffa299d8b">g_pSelectDlgDSList</a>-&gt;<a class="code" href="structDS__LIST.html#07dd92469632391cc5ec7a6b428936b9">NumFiles</a> == 0)
<a name="l01028"></a>01028         {
<a name="l01029"></a>01029           HWND hOK= ::GetDlgItem(hWnd, IDOK);
<a name="l01030"></a>01030           EnableWindow(hOK, <a class="code" href="dsmdefs_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01031"></a>01031         }
<a name="l01032"></a>01032         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="dsm_8cpp.html#3d2dcae4d0d8e6e3f09a2248b643cce8">g_pSelectDlgSourceID</a>)
<a name="l01033"></a>01033         {
<a name="l01034"></a>01034           nIndex = (int)SendMessage( hListBox, LB_FINDSTRINGEXACT, (WPARAM)-1, (LPARAM)<a class="code" href="dsm_8cpp.html#3d2dcae4d0d8e6e3f09a2248b643cce8">g_pSelectDlgSourceID</a>-&gt;<a class="code" href="structTW__IDENTITY.html#4e3c2507fbbdaff9472c8316b38fd8d9">ProductName</a>);
<a name="l01035"></a>01035           <span class="keywordflow">if</span>(LB_ERR == nIndex)
<a name="l01036"></a>01036           {
<a name="l01037"></a>01037             nIndex = 0;
<a name="l01038"></a>01038           }
<a name="l01039"></a>01039           nIndex = (int)SendMessage( hListBox, LB_SETCURSEL, (WPARAM)nIndex, (LPARAM)NULL);
<a name="l01040"></a>01040         }
<a name="l01041"></a>01041       }
<a name="l01042"></a>01042       <span class="keywordflow">return</span> <a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01043"></a>01043     }
<a name="l01044"></a>01044     <span class="keywordflow">case</span> WM_COMMAND:
<a name="l01045"></a>01045       <span class="keywordflow">switch</span>(LOWORD(wParam))
<a name="l01046"></a>01046       {
<a name="l01047"></a>01047         <span class="keywordflow">case</span> IDOK:
<a name="l01048"></a>01048           {
<a name="l01049"></a>01049             HWND hListBox = ::GetDlgItem(hWnd, ID_LST_SOURCES); 
<a name="l01050"></a>01050             <span class="keywordtype">int</span>  nIndex   = 0;
<a name="l01051"></a>01051             <span class="keywordflow">if</span> ( hListBox ) 
<a name="l01052"></a>01052             {
<a name="l01053"></a>01053               nIndex = (int)SendMessage( hListBox, LB_GETCURSEL, (WPARAM)0, (LPARAM)0);
<a name="l01054"></a>01054               <span class="keywordflow">if</span>(LB_ERR == nIndex)
<a name="l01055"></a>01055               {
<a name="l01056"></a>01056                 <span class="comment">// if there is no selection should not have OK available to press in the first place.</span>
<a name="l01057"></a>01057                 <span class="keywordflow">return</span> <a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01058"></a>01058               }
<a name="l01059"></a>01059               nIndex = (int)SendMessage( hListBox, LB_GETITEMDATA, (WPARAM)nIndex, (LPARAM)0);
<a name="l01060"></a>01060               <span class="keywordflow">if</span>(LB_ERR != nIndex)
<a name="l01061"></a>01061               {
<a name="l01062"></a>01062                 assert(nIndex &lt;= g_pSelectDlgDSList-&gt;NumFiles);
<a name="l01063"></a>01063                 <a class="code" href="dsm_8cpp.html#3d2dcae4d0d8e6e3f09a2248b643cce8">g_pSelectDlgSourceID</a> = &amp;<a class="code" href="dsm_8cpp.html#d862616a9d73ac0c177071dffa299d8b">g_pSelectDlgDSList</a>-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(nIndex)].<a class="code" href="structDS__INFO.html#cd03f5b816161fedab7741c0f917373c">Identity</a>;
<a name="l01064"></a>01064               }
<a name="l01065"></a>01065             }
<a name="l01066"></a>01066             EndDialog(hWnd, IDOK);
<a name="l01067"></a>01067             <span class="keywordflow">return</span> <a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01068"></a>01068           }
<a name="l01069"></a>01069         <span class="keywordflow">case</span> IDCANCEL:
<a name="l01070"></a>01070           EndDialog(hWnd, IDCANCEL);
<a name="l01071"></a>01071           <span class="keywordflow">return</span> <a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01072"></a>01072       }
<a name="l01073"></a>01073       <span class="keywordflow">break</span>;
<a name="l01074"></a>01074   }
<a name="l01075"></a>01075   <span class="keywordflow">return</span> <a class="code" href="dsmdefs_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01076"></a>01076 }
<a name="l01077"></a>01077 
<a name="l01079"></a><a class="code" href="dsm_8cpp.html#8cb3b3faec177a1cc902def63f892b79">01079</a> TW_INT16 <a class="code" href="dsm_8cpp.html#8cb3b3faec177a1cc902def63f892b79">DSM_SelectDS</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity)
<a name="l01080"></a>01080 {
<a name="l01081"></a>01081   TW_INT16    result = TWRC_SUCCESS;
<a name="l01082"></a>01082   <a class="code" href="structTW__IDENTITY.html">TW_IDENTITY</a> SourceIdentity;
<a name="l01083"></a>01083 
<a name="l01084"></a>01084   SourceIdentity = *_pSourceIdentity;
<a name="l01085"></a>01085   <span class="keywordflow">if</span>(SourceIdentity.<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> != 0)
<a name="l01086"></a>01086   {
<a name="l01087"></a>01087     <span class="comment">// Even Twacker fails to set Id to 0 if it wants to set a particular DS</span>
<a name="l01088"></a>01088     <a class="code" href="dsm_8cpp.html#4af57f29119205f8a40cd631d3a7e032">kLOGERR</a> &lt;&lt; <span class="stringliteral">"MSG_USERSELECT failed to set Identity Id to 0"</span> &lt;&lt; endl;
<a name="l01089"></a>01089     SourceIdentity.<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> = 0;
<a name="l01090"></a>01090     <span class="comment">//setConditionCode(_pAppIdentity, TWCC_BUMMER);</span>
<a name="l01091"></a>01091     <span class="comment">//result = TWRC_FAILURE;</span>
<a name="l01092"></a>01092     <span class="comment">//return result;</span>
<a name="l01093"></a>01093   }
<a name="l01094"></a>01094 
<a name="l01095"></a>01095   assert(_pAppIdentity &amp;&amp; _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l01096"></a>01096   <a class="code" href="structAPP__INFO.html">pAPP_INFO</a>   pAppInfo        = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l01097"></a>01097     
<a name="l01098"></a>01098   <span class="comment">// If passed in a DS name we want to select it</span>
<a name="l01099"></a>01099   <span class="keywordflow">if</span>(SourceIdentity.<a class="code" href="structTW__IDENTITY.html#4e3c2507fbbdaff9472c8316b38fd8d9">ProductName</a>[0] != 0)
<a name="l01100"></a>01100   {
<a name="l01101"></a>01101     result = <a class="code" href="dsm_8cpp.html#fd2d9abc3115143298ecd88c5974da42">GetDSFromProductName</a>(_pAppIdentity, &amp;SourceIdentity);
<a name="l01102"></a>01102     <span class="comment">// If no match continue anyway.</span>
<a name="l01103"></a>01103   }
<a name="l01104"></a>01104 
<a name="l01105"></a>01105   <span class="comment">// If not passed a DS or the name was not currently found</span>
<a name="l01106"></a>01106   <span class="comment">// then selete the default</span>
<a name="l01107"></a>01107   <span class="keywordflow">if</span>(SourceIdentity.<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> == 0)
<a name="l01108"></a>01108   {
<a name="l01109"></a>01109     result = <a class="code" href="dsm_8cpp.html#cf4a1fd18d2caafb1a7de88ecba2afab">GetMatchingDefault</a>(_pAppIdentity, &amp;SourceIdentity);
<a name="l01110"></a>01110     <span class="comment">// If no match continue anyway.</span>
<a name="l01111"></a>01111   }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113   <span class="comment">// create the dialog window </span>
<a name="l01114"></a>01114   <a class="code" href="dsm_8cpp.html#3d2dcae4d0d8e6e3f09a2248b643cce8">g_pSelectDlgSourceID</a>  = &amp;SourceIdentity;
<a name="l01115"></a>01115   <a class="code" href="dsm_8cpp.html#d862616a9d73ac0c177071dffa299d8b">g_pSelectDlgDSList</a>    = pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>;
<a name="l01116"></a>01116   <span class="keywordtype">int</span> ret = DialogBox(<a class="code" href="dsm_8cpp.html#2f84f2f9ae2be8128aa873506eadafbe">g_hinstDLL</a>, (LPCTSTR)IDD_DLG_SOURCE, (HWND)NULL, <a class="code" href="dsm_8cpp.html#bd3b2b927edd91b7596dadebeece0129">SelectDlgProc</a>);
<a name="l01117"></a>01117   <span class="keywordflow">if</span>(ret == IDOK)
<a name="l01118"></a>01118   {
<a name="l01119"></a>01119     assert(<a class="code" href="dsm_8cpp.html#3d2dcae4d0d8e6e3f09a2248b643cce8">g_pSelectDlgSourceID</a>);
<a name="l01120"></a>01120     *_pSourceIdentity   = *g_pSelectDlgSourceID;
<a name="l01121"></a>01121 
<a name="l01122"></a>01122     <span class="comment">// save default source to Registry  </span>
<a name="l01123"></a>01123 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l01124"></a>01124 <span class="preprocessor"></span>  HKEY hKey;
<a name="l01125"></a>01125   <span class="keywordtype">long</span> status = ERROR_SUCCESS;
<a name="l01126"></a>01126   <span class="keywordtype">char</span> *szPath = pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(g_pSelectDlgSourceID-&gt;Id)].<a class="code" href="structDS__INFO.html#37760d1e360918e9cd37b4c4fe691505">szPath</a>;
<a name="l01127"></a>01127 
<a name="l01128"></a>01128   <span class="comment">// Open the key, creating it if it doesn't exist.</span>
<a name="l01129"></a>01129   <span class="keywordflow">if</span>( RegCreateKeyEx(HKEY_CURRENT_USER, <span class="stringliteral">"Software\\Microsoft\\Windows NT\\CurrentVersion\\Twain"</span>,
<a name="l01130"></a>01130            NULL, NULL, NULL, KEY_READ | KEY_WRITE, NULL, &amp;hKey, NULL) == ERROR_SUCCESS )
<a name="l01131"></a>01131   {
<a name="l01132"></a>01132     status = RegSetValueEx( hKey, <span class="stringliteral">"Default Source"</span>, 0, REG_SZ, (LPBYTE)szPath, (DWORD)strlen((<span class="keywordtype">char</span>*)szPath)+1 );
<a name="l01133"></a>01133     <span class="keywordflow">if</span>( status != ERROR_SUCCESS )
<a name="l01134"></a>01134     {
<a name="l01135"></a>01135       <span class="comment">// Failed to save default DS to registry</span>
<a name="l01136"></a>01136       <a class="code" href="dsm_8cpp.html#4af57f29119205f8a40cd631d3a7e032">kLOGERR</a> &lt;&lt; <span class="stringliteral">"Failed to save default DS to registry"</span> &lt;&lt; endl;
<a name="l01137"></a>01137       <span class="comment">// Nothing preventing us from using the default right now</span>
<a name="l01138"></a>01138       <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_BUMMER);
<a name="l01139"></a>01139     }
<a name="l01140"></a>01140   }
<a name="l01141"></a>01141   <span class="comment">// Close the key.</span>
<a name="l01142"></a>01142   RegCloseKey(hKey);
<a name="l01143"></a>01143 <span class="preprocessor">#else</span>
<a name="l01144"></a>01144 <span class="preprocessor"></span>  <span class="comment">// TODO: other OS save the default Source from stored location</span>
<a name="l01145"></a>01145   assert(0);
<a name="l01146"></a>01146 <span class="preprocessor">#endif</span>
<a name="l01147"></a>01147 <span class="preprocessor"></span>
<a name="l01148"></a>01148   assert(_pSourceIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#07dd92469632391cc5ec7a6b428936b9">NumFiles</a>);
<a name="l01149"></a>01149     <span class="comment">//pAppInfo-&gt;DefaultSource = (TW_INT16)_pSourceIdentity-&gt;Id;</span>
<a name="l01150"></a>01150   }
<a name="l01151"></a>01151   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ret == IDCANCEL)
<a name="l01152"></a>01152   {
<a name="l01153"></a>01153     result = TWRC_CANCEL;
<a name="l01154"></a>01154   }
<a name="l01155"></a>01155   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ret == -1)
<a name="l01156"></a>01156   {
<a name="l01157"></a>01157     DWORD dwError = GetLastError();
<a name="l01158"></a>01158     MessageBox(NULL, <span class="stringliteral">"Dialog failed!"</span>, <span class="stringliteral">"Error"</span>, MB_OK | MB_ICONINFORMATION);
<a name="l01159"></a>01159     <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_BUMMER);
<a name="l01160"></a>01160     result = TWRC_FAILURE;
<a name="l01161"></a>01161   }
<a name="l01162"></a>01162 
<a name="l01163"></a>01163   <span class="keywordflow">return</span> result;
<a name="l01164"></a>01164 }
<a name="l01165"></a>01165 
<a name="l01166"></a>01166 
<a name="l01168"></a><a class="code" href="dsm_8cpp.html#afdc094c70146d2988ddc67ee08298b2">01168</a> TW_INT16 <a class="code" href="dsm_8cpp.html#afdc094c70146d2988ddc67ee08298b2">EntryDS</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity,
<a name="l01169"></a>01169                  <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity,
<a name="l01170"></a>01170                  TW_UINT32 _DG,
<a name="l01171"></a>01171                  TW_UINT16 _DAT,
<a name="l01172"></a>01172                  TW_UINT16 _MSG,
<a name="l01173"></a>01173                  TW_MEMREF _pData)
<a name="l01174"></a>01174 {
<a name="l01175"></a>01175   TW_UINT16 result = TWRC_SUCCESS;
<a name="l01176"></a>01176   assert(_pAppIdentity &amp;&amp; _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l01177"></a>01177   <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l01178"></a>01178   assert(_pSourceIdentity &amp;&amp; _pSourceIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#56789afad5629716adeabe67227d51b4">MAX_NUM_DS</a>);
<a name="l01179"></a>01179   <a class="code" href="structDS__INFO.html">pDS_INFO</a>  pDSInfo  = &amp;pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pSourceIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l01180"></a>01180 
<a name="l01181"></a>01181   <span class="keywordflow">if</span>(0 != pDSInfo-&gt;<a class="code" href="structDS__INFO.html#ae706672ae20aeef21240935e94876bd">DS_Entry</a>)
<a name="l01182"></a>01182   {
<a name="l01183"></a>01183     result = (pDSInfo-&gt;<a class="code" href="structDS__INFO.html#ae706672ae20aeef21240935e94876bd">DS_Entry</a>)(_pAppIdentity, _DG, _DAT, _MSG, _pData);
<a name="l01184"></a>01184   }
<a name="l01185"></a>01185   <span class="keywordflow">else</span>
<a name="l01186"></a>01186   {
<a name="l01187"></a>01187     <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_OPERATIONERROR);
<a name="l01188"></a>01188     result = TWRC_FAILURE;
<a name="l01189"></a>01189   }
<a name="l01190"></a>01190 
<a name="l01191"></a>01191   <span class="keywordflow">return</span> result;
<a name="l01192"></a>01192 }
<a name="l01193"></a>01193 
<a name="l01195"></a><a class="code" href="dsm_8cpp.html#fd2d9abc3115143298ecd88c5974da42">01195</a> TW_INT16 <a class="code" href="dsm_8cpp.html#fd2d9abc3115143298ecd88c5974da42">GetDSFromProductName</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity)
<a name="l01196"></a>01196 {
<a name="l01197"></a>01197   TW_INT16 ret = TWRC_FAILURE;
<a name="l01198"></a>01198 
<a name="l01199"></a>01199   <span class="keywordflow">if</span>(0 == _pAppIdentity || 0 == _pSourceIdentity)
<a name="l01200"></a>01200   {
<a name="l01201"></a>01201     <span class="keywordflow">return</span> ret;
<a name="l01202"></a>01202   }
<a name="l01203"></a>01203 
<a name="l01204"></a>01204   <span class="keywordflow">if</span>(0 == _pSourceIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#4e3c2507fbbdaff9472c8316b38fd8d9">ProductName</a>[0])
<a name="l01205"></a>01205   {
<a name="l01206"></a>01206     <span class="keywordflow">return</span> ret;
<a name="l01207"></a>01207   }
<a name="l01208"></a>01208   assert(_pAppIdentity &amp;&amp; _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l01209"></a>01209   <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;(<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)]);
<a name="l01210"></a>01210 
<a name="l01211"></a>01211   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x = 0; x &lt; pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#07dd92469632391cc5ec7a6b428936b9">NumFiles</a>; ++x)
<a name="l01212"></a>01212   {
<a name="l01213"></a>01213     <span class="keywordflow">if</span>(0 == strncmp(_pSourceIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#4e3c2507fbbdaff9472c8316b38fd8d9">ProductName</a>, pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[x].<a class="code" href="structDS__INFO.html#cd03f5b816161fedab7741c0f917373c">Identity</a>.<a class="code" href="structTW__IDENTITY.html#4e3c2507fbbdaff9472c8316b38fd8d9">ProductName</a>, <span class="keyword">sizeof</span>(TW_STR32)))
<a name="l01214"></a>01214     {
<a name="l01215"></a>01215       <span class="comment">// match found, set index</span>
<a name="l01216"></a>01216       *_pSourceIdentity = pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[x].<a class="code" href="structDS__INFO.html#cd03f5b816161fedab7741c0f917373c">Identity</a>;
<a name="l01217"></a>01217       ret = TWRC_SUCCESS;
<a name="l01218"></a>01218       <span class="keywordflow">break</span>;
<a name="l01219"></a>01219     }
<a name="l01220"></a>01220   }
<a name="l01221"></a>01221 
<a name="l01222"></a>01222   <span class="keywordflow">return</span> ret;
<a name="l01223"></a>01223 }
<a name="l01224"></a>01224 
<a name="l01226"></a><a class="code" href="dsm_8cpp.html#c7c1874a18c61e4d88e020cedcc3aa94">01226</a> TW_INT16 <a class="code" href="dsm_8cpp.html#c7c1874a18c61e4d88e020cedcc3aa94">LoadAllDataSources</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structDS__LIST.html">pDS_LIST</a> _pList)
<a name="l01227"></a>01227 {
<a name="l01228"></a>01228   TW_INT16 ret = TWRC_SUCCESS;
<a name="l01229"></a>01229 
<a name="l01230"></a>01230   <span class="comment">// recursively navigate the TWAIN datasource dir looking for data sources.</span>
<a name="l01231"></a>01231   <span class="keywordflow">if</span>(<a class="code" href="dsm_8cpp.html#108aa28bfe9128ab27d8e5e3fc3aebaf">scanDSDir</a>(<a class="code" href="dsm_8cpp.html#5e8dfed95a684750d27343381d9f8c12">kTWAIN_DS_DIR</a>, _pAppIdentity, _pList) == EXIT_FAILURE)
<a name="l01232"></a>01232   {
<a name="l01233"></a>01233     ret = TWRC_FAILURE;
<a name="l01234"></a>01234   }
<a name="l01235"></a>01235   <span class="keywordflow">else</span>
<a name="l01236"></a>01236   {
<a name="l01237"></a>01237     <span class="comment">// mark the list as initialized now</span>
<a name="l01238"></a>01238     _pList-&gt;<a class="code" href="structDS__LIST.html#fbfe27f97a70a1611f715ffa26dc2a6c">Initialized</a> = <a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01239"></a>01239   }
<a name="l01240"></a>01240 
<a name="l01241"></a>01241   <span class="keywordflow">return</span> ret;
<a name="l01242"></a>01242 }
<a name="l01243"></a>01243 
<a name="l01245"></a><a class="code" href="dsm_8cpp.html#108aa28bfe9128ab27d8e5e3fc3aebaf">01245</a> <span class="keywordtype">int</span> <a class="code" href="dsm_8cpp.html#108aa28bfe9128ab27d8e5e3fc3aebaf">scanDSDir</a>(<span class="keywordtype">char</span>* _szAbsPath, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structDS__LIST.html">pDS_LIST</a> _pList)
<a name="l01246"></a>01246 {
<a name="l01247"></a>01247 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l01248"></a>01248 <span class="preprocessor"></span>  WIN32_FIND_DATA   FileData;             <span class="comment">// Data structure describes the file found</span>
<a name="l01249"></a>01249   HANDLE            hSearch;              <span class="comment">// Search handle returned by FindFirstFile</span>
<a name="l01250"></a>01250   <span class="keywordtype">char</span>              szABSFilename[PATH_MAX];
<a name="l01251"></a>01251   BOOL              bFinished = <a class="code" href="dsmdefs_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01252"></a>01252   <span class="keywordtype">char</span>              szPrevWorkDir[PATH_MAX];
<a name="l01253"></a>01253 
<a name="l01254"></a>01254   <span class="comment">// Start searching for .ds files in the root directory.</span>
<a name="l01255"></a>01255   strcpy(szABSFilename, _szAbsPath);
<a name="l01256"></a>01256   strcat(szABSFilename, <span class="stringliteral">"\\*.ds"</span>);
<a name="l01257"></a>01257   hSearch = FindFirstFile(szABSFilename, &amp;FileData);
<a name="l01258"></a>01258   <span class="keywordflow">if</span> (hSearch == INVALID_HANDLE_VALUE)
<a name="l01259"></a>01259   {
<a name="l01260"></a>01260     <span class="keywordflow">return</span> EXIT_FAILURE;
<a name="l01261"></a>01261   }
<a name="l01262"></a>01262 
<a name="l01263"></a>01263   <span class="comment">/* Save the current working directory: */</span>
<a name="l01264"></a>01264   _getcwd( szPrevWorkDir, PATH_MAX );
<a name="l01265"></a>01265   _chdir( _szAbsPath );
<a name="l01266"></a>01266 
<a name="l01267"></a>01267   <span class="keywordflow">while</span> (!bFinished)
<a name="l01268"></a>01268   {
<a name="l01269"></a>01269     <span class="keywordflow">if</span>(<a class="code" href="dsm_8h.html#770571e12ff9370899184528f4b4626d">SNPRINTF</a>(szABSFilename, PATH_MAX, <span class="stringliteral">"%s\\%s"</span>, _szAbsPath, FileData.cFileName) &gt; 0)
<a name="l01270"></a>01270     {
<a name="l01271"></a>01271       <span class="keywordflow">if</span>(TWRC_SUCCESS == <a class="code" href="dsm_8cpp.html#738bd71a11e38de25094584b8d2c243c">LoadDS</a>(_pAppIdentity, szABSFilename, <a class="code" href="dsmdefs_8h.html#760595fa4202d2be9c3d3d778f812354">kOUT</a>(_pList-&gt;<a class="code" href="structDS__LIST.html#07dd92469632391cc5ec7a6b428936b9">NumFiles</a>), _pList))
<a name="l01272"></a>01272       {
<a name="l01273"></a>01273         _pList-&gt;<a class="code" href="structDS__LIST.html#07dd92469632391cc5ec7a6b428936b9">NumFiles</a>++;
<a name="l01274"></a>01274       }
<a name="l01275"></a>01275     }
<a name="l01276"></a>01276   
<a name="l01277"></a>01277     <span class="keywordflow">if</span> (!FindNextFile(hSearch, &amp;FileData))
<a name="l01278"></a>01278     {
<a name="l01279"></a>01279       bFinished = <a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01280"></a>01280     }
<a name="l01281"></a>01281   }
<a name="l01282"></a>01282   
<a name="l01283"></a>01283   <span class="keywordflow">if</span> (!FindClose (hSearch))
<a name="l01284"></a>01284   {
<a name="l01285"></a>01285     _chdir( szPrevWorkDir );
<a name="l01286"></a>01286     <span class="keywordflow">return</span> EXIT_FAILURE;
<a name="l01287"></a>01287   }
<a name="l01288"></a>01288 
<a name="l01289"></a>01289   <span class="comment">// Start searching sub directories.</span>
<a name="l01290"></a>01290   strcpy(szABSFilename, _szAbsPath);
<a name="l01291"></a>01291   strcat(szABSFilename, <span class="stringliteral">"\\*.*"</span>);
<a name="l01292"></a>01292   hSearch = FindFirstFile(szABSFilename, &amp;FileData);
<a name="l01293"></a>01293   bFinished = <a class="code" href="dsmdefs_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01294"></a>01294   <span class="keywordflow">if</span> (hSearch == INVALID_HANDLE_VALUE)
<a name="l01295"></a>01295   {
<a name="l01296"></a>01296     _chdir( szPrevWorkDir );
<a name="l01297"></a>01297     <span class="keywordflow">return</span> EXIT_FAILURE;
<a name="l01298"></a>01298   }
<a name="l01299"></a>01299   <span class="keywordflow">while</span> (!bFinished)
<a name="l01300"></a>01300   {
<a name="l01301"></a>01301     <span class="keywordflow">if</span>((strcmp(<span class="stringliteral">"."</span>, FileData.cFileName) != 0) &amp;&amp;
<a name="l01302"></a>01302        (strcmp(<span class="stringliteral">".."</span>, FileData.cFileName) != 0) &amp;&amp; 
<a name="l01303"></a>01303        FileData.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY)
<a name="l01304"></a>01304     {
<a name="l01305"></a>01305       <span class="keywordflow">if</span>(<a class="code" href="dsm_8h.html#770571e12ff9370899184528f4b4626d">SNPRINTF</a>(szABSFilename, PATH_MAX, <span class="stringliteral">"%s\\%s"</span>, _szAbsPath, FileData.cFileName) &gt; 0)
<a name="l01306"></a>01306       {
<a name="l01307"></a>01307         <a class="code" href="dsm_8cpp.html#108aa28bfe9128ab27d8e5e3fc3aebaf">scanDSDir</a>(szABSFilename, _pAppIdentity, _pList);
<a name="l01308"></a>01308       }
<a name="l01309"></a>01309     }
<a name="l01310"></a>01310   
<a name="l01311"></a>01311     <span class="keywordflow">if</span> (!FindNextFile(hSearch, &amp;FileData))
<a name="l01312"></a>01312     {
<a name="l01313"></a>01313       bFinished = <a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01314"></a>01314     }
<a name="l01315"></a>01315   }
<a name="l01316"></a>01316   
<a name="l01317"></a>01317   _chdir( szPrevWorkDir );
<a name="l01318"></a>01318 
<a name="l01319"></a>01319   <span class="keywordflow">if</span> (!FindClose (hSearch))
<a name="l01320"></a>01320   {
<a name="l01321"></a>01321     <span class="keywordflow">return</span> EXIT_FAILURE;
<a name="l01322"></a>01322   }
<a name="l01323"></a>01323 
<a name="l01324"></a>01324   <span class="keywordflow">return</span> EXIT_SUCCESS;
<a name="l01325"></a>01325 
<a name="l01326"></a>01326 <span class="preprocessor">#else</span>
<a name="l01327"></a>01327 <span class="preprocessor"></span>  <span class="keywordtype">char</span> szABSFilename[PATH_MAX];
<a name="l01328"></a>01328 
<a name="l01329"></a>01329   DIR *pdir; 
<a name="l01330"></a>01330   <span class="keywordflow">if</span> ((pdir=opendir(_szAbsPath)) == 0)
<a name="l01331"></a>01331   {
<a name="l01332"></a>01332     perror(<span class="stringliteral">"opendir"</span>);
<a name="l01333"></a>01333     <span class="keywordflow">return</span> EXIT_FAILURE;
<a name="l01334"></a>01334   }
<a name="l01335"></a>01335 
<a name="l01336"></a>01336   <span class="keyword">struct </span>dirent *pfile; 
<a name="l01337"></a>01337   <span class="keywordflow">while</span>(errno=0, ((pfile=readdir(pdir)) != 0))
<a name="l01338"></a>01338   { 
<a name="l01339"></a>01339     <span class="keywordflow">if</span>((strcmp(<span class="stringliteral">"."</span>, pfile-&gt;d_name) == 0) ||
<a name="l01340"></a>01340        (strcmp(<span class="stringliteral">".."</span>, pfile-&gt;d_name) == 0))
<a name="l01341"></a>01341     {
<a name="l01342"></a>01342       <span class="keywordflow">continue</span>;
<a name="l01343"></a>01343     }
<a name="l01344"></a>01344 
<a name="l01345"></a>01345     <span class="keywordflow">if</span>(<a class="code" href="dsm_8h.html#770571e12ff9370899184528f4b4626d">SNPRINTF</a>(szABSFilename, PATH_MAX, <span class="stringliteral">"%s/%s"</span>, _szAbsPath, pfile-&gt;d_name) &lt; 0)
<a name="l01346"></a>01346     {
<a name="l01347"></a>01347       <span class="keywordflow">continue</span>;
<a name="l01348"></a>01348     }
<a name="l01349"></a>01349 
<a name="l01350"></a>01350     <span class="keyword">struct </span>stat st;
<a name="l01351"></a>01351     <span class="keywordflow">if</span>(lstat(szABSFilename, &amp;st) &lt; 0)
<a name="l01352"></a>01352     {
<a name="l01353"></a>01353       perror(<span class="stringliteral">"lstat"</span>);
<a name="l01354"></a>01354       <span class="keywordflow">continue</span>;
<a name="l01355"></a>01355     }
<a name="l01356"></a>01356 
<a name="l01357"></a>01357     <span class="keywordflow">if</span>(S_ISDIR(st.st_mode))
<a name="l01358"></a>01358     {
<a name="l01359"></a>01359       <a class="code" href="dsm_8cpp.html#108aa28bfe9128ab27d8e5e3fc3aebaf">scanDSDir</a>(szABSFilename, _pAppIdentity, _pList);
<a name="l01360"></a>01360     }
<a name="l01361"></a>01361     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(S_ISREG(st.st_mode) &amp;&amp; (0 != strstr(pfile-&gt;d_name, <span class="stringliteral">".ds"</span>)))
<a name="l01362"></a>01362     {
<a name="l01363"></a>01363       <span class="keywordflow">if</span>(TWRC_SUCCESS == <a class="code" href="dsm_8cpp.html#738bd71a11e38de25094584b8d2c243c">LoadDS</a>(_pAppIdentity, szABSFilename, <a class="code" href="dsmdefs_8h.html#760595fa4202d2be9c3d3d778f812354">kOUT</a>(_pList-&gt;<a class="code" href="structDS__LIST.html#07dd92469632391cc5ec7a6b428936b9">NumFiles</a>), _pList))
<a name="l01364"></a>01364       {
<a name="l01365"></a>01365         _pList-&gt;<a class="code" href="structDS__LIST.html#07dd92469632391cc5ec7a6b428936b9">NumFiles</a>++;
<a name="l01366"></a>01366       }
<a name="l01367"></a>01367     }
<a name="l01368"></a>01368   } 
<a name="l01369"></a>01369   
<a name="l01370"></a>01370   <span class="keywordflow">if</span>(0 != errno)
<a name="l01371"></a>01371   {
<a name="l01372"></a>01372     perror(<span class="stringliteral">"readdir"</span>);
<a name="l01373"></a>01373   }
<a name="l01374"></a>01374 
<a name="l01375"></a>01375   closedir(pdir); 
<a name="l01376"></a>01376   <span class="keywordflow">return</span> EXIT_SUCCESS;
<a name="l01377"></a>01377 <span class="preprocessor">#endif</span>
<a name="l01378"></a>01378 <span class="preprocessor"></span>  <span class="keywordflow">return</span> 0;
<a name="l01379"></a>01379 }
<a name="l01380"></a>01380 
<a name="l01381"></a>01381 
<a name="l01383"></a><a class="code" href="dsm_8cpp.html#738bd71a11e38de25094584b8d2c243c">01383</a> TW_INT16 <a class="code" href="dsm_8cpp.html#738bd71a11e38de25094584b8d2c243c">LoadDS</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity,
<a name="l01384"></a>01384                 <span class="keywordtype">char</span>* _pPath,
<a name="l01385"></a>01385                 TW_INT16 _index,
<a name="l01386"></a>01386                 <a class="code" href="structDS__LIST.html">pDS_LIST</a> _pList)
<a name="l01387"></a>01387 {
<a name="l01388"></a>01388   TW_INT16 result = TWRC_SUCCESS;
<a name="l01389"></a>01389 
<a name="l01390"></a>01390   <span class="keywordflow">if</span>(0 != _pPath &amp;&amp; _index &lt; <a class="code" href="dsmdefs_8h.html#56789afad5629716adeabe67227d51b4">MAX_NUM_DS</a>)
<a name="l01391"></a>01391   {
<a name="l01392"></a>01392     <span class="keywordflow">if</span>((_pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].pHandle = <a class="code" href="dsm_8h.html#1b5232db1586420ee660df7fefbdf5e1">LOADLIBRARY</a>(_pPath)) == 0)
<a name="l01393"></a>01393     {
<a name="l01394"></a>01394 <span class="preprocessor">#ifndef _WIN32</span>
<a name="l01395"></a>01395 <span class="preprocessor"></span>      <a class="code" href="dsm_8cpp.html#4af57f29119205f8a40cd631d3a7e032">kLOGERR</a> &lt;&lt; <span class="stringliteral">"dlopen: "</span> &lt;&lt; dlerror() &lt;&lt; endl;
<a name="l01396"></a>01396 <span class="preprocessor">#else</span>
<a name="l01397"></a>01397 <span class="preprocessor"></span>      <a class="code" href="dsm_8cpp.html#4af57f29119205f8a40cd631d3a7e032">kLOGERR</a> &lt;&lt; <span class="stringliteral">"Could not load library: "</span> &lt;&lt; _pPath &lt;&lt; endl;
<a name="l01398"></a>01398 <span class="preprocessor">#endif //_WIN32</span>
<a name="l01399"></a>01399 <span class="preprocessor"></span>      result = TWRC_FAILURE;
<a name="l01400"></a>01400     }
<a name="l01401"></a>01401     <span class="keywordflow">else</span>
<a name="l01402"></a>01402     {
<a name="l01403"></a>01403       <span class="keywordflow">if</span>((_pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].DS_Entry = (DSENTRYPROC)<a class="code" href="dsm_8h.html#629851564d4c2b08168c72b9b4bf3002">LOADFUNCTION</a>(_pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].pHandle, <span class="stringliteral">"DS_Entry"</span>)) == 0)
<a name="l01404"></a>01404       {
<a name="l01405"></a>01405 <span class="preprocessor">#ifdef _WIN32 // dlsym returning NULL is not an error on Unix</span>
<a name="l01406"></a>01406 <span class="preprocessor"></span>        <a class="code" href="dsm_8cpp.html#4af57f29119205f8a40cd631d3a7e032">kLOGERR</a> &lt;&lt; <span class="stringliteral">"Could not find DSM_Entry function in DS: "</span> &lt;&lt; _pPath &lt;&lt; endl;
<a name="l01407"></a>01407         <a class="code" href="dsm_8h.html#1c2903f6e95c10bda24df61b562a4160">UNLOADLIBRARY</a>(_pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].pHandle);
<a name="l01408"></a>01408         _pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].<a class="code" href="structDS__INFO.html#ec3891d325f05bf891e6cf9e43125ffe">pHandle</a> = NULL;
<a name="l01409"></a>01409         <span class="keywordflow">return</span> TWRC_FAILURE; 
<a name="l01410"></a>01410 <span class="preprocessor">#endif //_WIN32</span>
<a name="l01411"></a>01411 <span class="preprocessor"></span>      }
<a name="l01412"></a>01412 <span class="preprocessor">#ifndef _WIN32</span>
<a name="l01413"></a>01413 <span class="preprocessor"></span>      <span class="keywordtype">char</span> *error;
<a name="l01414"></a>01414       <span class="keywordflow">if</span> ((error = dlerror()) != 0)
<a name="l01415"></a>01415       {
<a name="l01416"></a>01416         <a class="code" href="dsm_8cpp.html#4af57f29119205f8a40cd631d3a7e032">kLOGERR</a> &lt;&lt; <span class="stringliteral">"dlsym: "</span> &lt;&lt; error &lt;&lt; endl;
<a name="l01417"></a>01417         <span class="keywordflow">return</span> TWRC_FAILURE;
<a name="l01418"></a>01418       }
<a name="l01419"></a>01419 <span class="preprocessor">#endif //_WIN32</span>
<a name="l01420"></a>01420 <span class="preprocessor"></span>
<a name="l01421"></a>01421       <span class="keywordflow">if</span>(0 != _pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].DS_Entry) <span class="comment">// was dlsym successful?</span>
<a name="l01422"></a>01422       {
<a name="l01423"></a>01423         <a class="code" href="dsm_8cpp.html#a72b5d2715fa48220edcbb894df6b463">kLOG</a> &lt;&lt; <span class="stringliteral">"Loaded library: "</span> &lt;&lt; _pPath &lt;&lt; endl;
<a name="l01424"></a>01424         _pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].<a class="code" href="structDS__INFO.html#cd03f5b816161fedab7741c0f917373c">Identity</a>.<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> = _index;
<a name="l01425"></a>01425         <span class="comment">// Get the source to fill in the identity structure</span>
<a name="l01426"></a>01426         <span class="comment">// This operation should never fail on any DS</span>
<a name="l01427"></a>01427         result = _pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].<a class="code" href="structDS__INFO.html#ae706672ae20aeef21240935e94876bd">DS_Entry</a>(_pAppIdentity, DG_CONTROL, DAT_IDENTITY, MSG_GET, (TW_MEMREF) &amp;(_pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].Identity) );
<a name="l01428"></a>01428 
<a name="l01429"></a>01429         <span class="comment">// Check to see if it is a match to the the application</span>
<a name="l01430"></a>01430         <span class="keywordflow">if</span>(TWRC_SUCCESS != result ||
<a name="l01431"></a>01431            <a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> != <a class="code" href="dsm_8cpp.html#25fb28d12b903479535515387adde5d0">SupportedMatch</a>(_pAppIdentity, &amp;(_pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].Identity)) )
<a name="l01432"></a>01432         {
<a name="l01433"></a>01433           <a class="code" href="dsm_8h.html#1c2903f6e95c10bda24df61b562a4160">UNLOADLIBRARY</a>(_pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].pHandle);
<a name="l01434"></a>01434           _pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].<a class="code" href="structDS__INFO.html#ec3891d325f05bf891e6cf9e43125ffe">pHandle</a> = NULL;
<a name="l01435"></a>01435           _pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].<a class="code" href="structDS__INFO.html#ae706672ae20aeef21240935e94876bd">DS_Entry</a> = NULL;
<a name="l01436"></a>01436           <span class="keywordflow">return</span> TWRC_FAILURE;
<a name="l01437"></a>01437         }
<a name="l01438"></a>01438         <span class="keywordflow">else</span>
<a name="l01439"></a>01439         {
<a name="l01440"></a>01440           _pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].<a class="code" href="structDS__INFO.html#f43907e80523836bd08c206d23bbf692">bOpen</a> = <a class="code" href="dsmdefs_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01441"></a>01441           <span class="comment">// The DS should not modify the Id</span>
<a name="l01442"></a>01442           <span class="comment">// eventhough the spec states that the id will not be assigned until DSM </span>
<a name="l01443"></a>01443           <span class="comment">// sends MSG_OPENDS to DS</span>
<a name="l01444"></a>01444           <span class="comment">// assert( _pList-&gt;DSInfo[kIN(_index)].Identity.Id == _index );</span>
<a name="l01445"></a>01445           _pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].<a class="code" href="structDS__INFO.html#cd03f5b816161fedab7741c0f917373c">Identity</a>.<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> = _index;
<a name="l01446"></a>01446           strncpy(_pList-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_index)].szPath, _pPath, MAX_PATH);
<a name="l01447"></a>01447         }
<a name="l01448"></a>01448       }
<a name="l01449"></a>01449       <span class="keywordflow">else</span> <span class="comment">// bad dlsym</span>
<a name="l01450"></a>01450       {
<a name="l01451"></a>01451         result = TWRC_FAILURE;
<a name="l01452"></a>01452       }
<a name="l01453"></a>01453     }
<a name="l01454"></a>01454   }
<a name="l01455"></a>01455   <span class="keywordflow">else</span> <span class="comment">// bad path or too many DS's already open</span>
<a name="l01456"></a>01456   {
<a name="l01457"></a>01457     result = TWRC_FAILURE;
<a name="l01458"></a>01458     <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_OPERATIONERROR);
<a name="l01459"></a>01459   }
<a name="l01460"></a>01460 
<a name="l01461"></a>01461   <span class="keywordflow">return</span> result;
<a name="l01462"></a>01462 }
<a name="l01463"></a>01463 
<a name="l01465"></a><a class="code" href="dsm_8cpp.html#25fb28d12b903479535515387adde5d0">01465</a> TW_BOOL <a class="code" href="dsm_8cpp.html#25fb28d12b903479535515387adde5d0">SupportedMatch</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity)
<a name="l01466"></a>01466 {
<a name="l01467"></a>01467   TW_BOOL bRet = <a class="code" href="dsmdefs_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01468"></a>01468   TW_UINT32 sourceSupports, appSupports;
<a name="l01469"></a>01469 
<a name="l01470"></a>01470   <span class="comment">// Mask out DG_CONTROL -- must ignore it since everything supports it.</span>
<a name="l01471"></a>01471   appSupports    = _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#b491af470216250477e257153dfa4357">SupportedGroups</a>    &amp; 0x00fffffe;
<a name="l01472"></a>01472   sourceSupports = _pSourceIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#b491af470216250477e257153dfa4357">SupportedGroups</a> &amp; 0x00fffffe;
<a name="l01473"></a>01473 
<a name="l01474"></a>01474   <span class="keywordflow">if</span>((appSupports &amp; sourceSupports) != 0)
<a name="l01475"></a>01475   {
<a name="l01476"></a>01476     bRet = <a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01477"></a>01477   }
<a name="l01478"></a>01478 
<a name="l01479"></a>01479   <span class="keywordflow">return</span> bRet;
<a name="l01480"></a>01480 }
<a name="l01481"></a>01481 
<a name="l01482"></a><a class="code" href="dsm_8cpp.html#7c841b1d9a57e77b22a2aaf5a78815f2">01482</a> TW_INT16 <a class="code" href="dsm_8cpp.html#7c841b1d9a57e77b22a2aaf5a78815f2">UnLoadAllDS</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity)
<a name="l01483"></a>01483 {
<a name="l01484"></a>01484   TW_INT16 result = TWRC_SUCCESS;
<a name="l01485"></a>01485   assert(_pAppIdentity &amp;&amp; _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l01486"></a>01486   <a class="code" href="structAPP__INFO.html">pAPP_INFO</a>   pAppInfo        = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l01487"></a>01487   <a class="code" href="structDS__INFO.html">pDS_INFO</a>    pDSInfo         = NULL;
<a name="l01488"></a>01488 
<a name="l01489"></a>01489   <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i =0; i &lt; pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#07dd92469632391cc5ec7a6b428936b9">NumFiles</a>; i++)
<a name="l01490"></a>01490   {
<a name="l01491"></a>01491     pDSInfo = &amp;pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[i];
<a name="l01492"></a>01492     <span class="keywordflow">if</span>(0 != pDSInfo-&gt;<a class="code" href="structDS__INFO.html#ae706672ae20aeef21240935e94876bd">DS_Entry</a>)
<a name="l01493"></a>01493     {
<a name="l01494"></a>01494       <span class="keywordflow">if</span>( <a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> == pDSInfo-&gt;<a class="code" href="structDS__INFO.html#f43907e80523836bd08c206d23bbf692">bOpen</a> )
<a name="l01495"></a>01495       {
<a name="l01496"></a>01496         assert( pDSInfo-&gt;<a class="code" href="structDS__INFO.html#f43907e80523836bd08c206d23bbf692">bOpen</a> );
<a name="l01497"></a>01497         <span class="comment">// No DS should be open because no application has a DS selected</span>
<a name="l01498"></a>01498         <span class="comment">// but will close any that are open in case anything has got out of sync.</span>
<a name="l01499"></a>01499         <span class="comment">// If DS is open, then close the DS</span>
<a name="l01500"></a>01500         result = pDSInfo-&gt;<a class="code" href="structDS__INFO.html#ae706672ae20aeef21240935e94876bd">DS_Entry</a>(_pAppIdentity,
<a name="l01501"></a>01501                 DG_CONTROL,
<a name="l01502"></a>01502                 DAT_IDENTITY,
<a name="l01503"></a>01503                 MSG_CLOSEDS,
<a name="l01504"></a>01504                 (TW_MEMREF) &amp;pDSInfo-&gt;<a class="code" href="structDS__INFO.html#cd03f5b816161fedab7741c0f917373c">Identity</a>);
<a name="l01505"></a>01505         pDSInfo-&gt;<a class="code" href="structDS__INFO.html#f43907e80523836bd08c206d23bbf692">bOpen</a> = <a class="code" href="dsmdefs_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01506"></a>01506       }
<a name="l01507"></a>01507       <span class="keywordflow">if</span>(NULL != pDSInfo-&gt;pHandle)
<a name="l01508"></a>01508       {
<a name="l01509"></a>01509         <a class="code" href="dsm_8h.html#1c2903f6e95c10bda24df61b562a4160">UNLOADLIBRARY</a>(pDSInfo-&gt;pHandle);
<a name="l01510"></a>01510       }
<a name="l01511"></a>01511       pDSInfo-&gt;pHandle = NULL;
<a name="l01512"></a>01512       pDSInfo-&gt;DS_Entry = NULL;
<a name="l01513"></a>01513     }
<a name="l01514"></a>01514   }
<a name="l01515"></a>01515 
<a name="l01516"></a>01516   <span class="keywordflow">return</span>(TWRC_SUCCESS);
<a name="l01517"></a>01517 }
<a name="l01518"></a>01518 
<a name="l01520"></a><a class="code" href="dsm_8cpp.html#ce8cced59081aa02e57e6d3c969f94d5">01520</a> TW_INT16 <a class="code" href="dsm_8cpp.html#ce8cced59081aa02e57e6d3c969f94d5">DSM_GetFirst</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity,
<a name="l01521"></a>01521                       <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity)
<a name="l01522"></a>01522 {
<a name="l01523"></a>01523   TW_INT16 ret = TWRC_SUCCESS;
<a name="l01524"></a>01524   assert(_pAppIdentity &amp;&amp; _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l01525"></a>01525   <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l01526"></a>01526 
<a name="l01527"></a>01527   <span class="comment">// reset which source the app is pointing to</span>
<a name="l01528"></a>01528   pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#dee54707e2685067ec6a66ed1374a261">OpenSource</a> = 0;
<a name="l01529"></a>01529 
<a name="l01530"></a>01530   <span class="comment">// get the apps first supported source</span>
<a name="l01531"></a>01531   <span class="keywordflow">if</span>(pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#07dd92469632391cc5ec7a6b428936b9">NumFiles</a> &gt; 0)
<a name="l01532"></a>01532   {
<a name="l01533"></a>01533     *_pSourceIdentity = pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[0].<a class="code" href="structDS__INFO.html#cd03f5b816161fedab7741c0f917373c">Identity</a>; <span class="comment">// copy the source info</span>
<a name="l01534"></a>01534   }
<a name="l01535"></a>01535   <span class="keywordflow">else</span> <span class="comment">// app doesn't have any supported sources</span>
<a name="l01536"></a>01536   {
<a name="l01537"></a>01537     <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_NODS);
<a name="l01538"></a>01538     ret = TWRC_FAILURE;
<a name="l01539"></a>01539   }
<a name="l01540"></a>01540 
<a name="l01541"></a>01541   <span class="keywordflow">return</span> ret;
<a name="l01542"></a>01542 }
<a name="l01543"></a>01543 
<a name="l01545"></a><a class="code" href="dsm_8cpp.html#aed56229345c051c1500eee8c9f55305">01545</a> TW_INT16 <a class="code" href="dsm_8cpp.html#aed56229345c051c1500eee8c9f55305">DSM_GetNext</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity,
<a name="l01546"></a>01546                      <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity)
<a name="l01547"></a>01547 {
<a name="l01548"></a>01548   TW_INT16 ret = TWRC_SUCCESS;
<a name="l01549"></a>01549   assert(_pAppIdentity &amp;&amp; _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l01550"></a>01550   <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l01551"></a>01551 
<a name="l01552"></a>01552   TW_INT16 srcId = pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#dee54707e2685067ec6a66ed1374a261">OpenSource</a>;
<a name="l01553"></a>01553 
<a name="l01554"></a>01554   <span class="comment">// Application must call MSG_GETFIRST before making this call</span>
<a name="l01555"></a>01555   <span class="keywordflow">if</span>(-1 == srcId)
<a name="l01556"></a>01556   {
<a name="l01557"></a>01557     <span class="keywordflow">return</span> TWRC_ENDOFLIST;
<a name="l01558"></a>01558   }
<a name="l01559"></a>01559 
<a name="l01560"></a>01560   <span class="comment">// have we reached the end of the supported sources?</span>
<a name="l01561"></a>01561   <span class="keywordflow">if</span>((srcId + 1) &lt; pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#07dd92469632391cc5ec7a6b428936b9">NumFiles</a>)
<a name="l01562"></a>01562   {
<a name="l01563"></a>01563     srcId++;
<a name="l01564"></a>01564     pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#dee54707e2685067ec6a66ed1374a261">OpenSource</a> = srcId;
<a name="l01565"></a>01565     *_pSourceIdentity = pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[srcId].<a class="code" href="structDS__INFO.html#cd03f5b816161fedab7741c0f917373c">Identity</a>; <span class="comment">// copy the source info</span>
<a name="l01566"></a>01566   }
<a name="l01567"></a>01567   <span class="keywordflow">else</span>
<a name="l01568"></a>01568   {
<a name="l01569"></a>01569     <span class="keywordflow">return</span> TWRC_ENDOFLIST;
<a name="l01570"></a>01570   }
<a name="l01571"></a>01571 
<a name="l01572"></a>01572   <span class="keywordflow">return</span> ret;
<a name="l01573"></a>01573 }
<a name="l01574"></a>01574 
<a name="l01576"></a><a class="code" href="dsm_8cpp.html#cf4a1fd18d2caafb1a7de88ecba2afab">01576</a> TW_INT16 <a class="code" href="dsm_8cpp.html#cf4a1fd18d2caafb1a7de88ecba2afab">GetMatchingDefault</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pSourceIdentity)
<a name="l01577"></a>01577 {
<a name="l01578"></a>01578   TW_INT16 ret = TWRC_SUCCESS;
<a name="l01579"></a>01579   assert(_pAppIdentity &amp;&amp; _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l01580"></a>01580   <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l01581"></a>01581 
<a name="l01582"></a>01582   <span class="keywordtype">bool</span> bMatchFnd = <span class="keyword">false</span>;
<a name="l01583"></a>01583 
<a name="l01584"></a>01584   <span class="comment">// is there something to match to?</span>
<a name="l01585"></a>01585   <span class="keywordflow">if</span>(pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#07dd92469632391cc5ec7a6b428936b9">NumFiles</a> &lt;= 0)
<a name="l01586"></a>01586   {
<a name="l01587"></a>01587     <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_NODS);
<a name="l01588"></a>01588     <span class="keywordflow">return</span> TWRC_FAILURE;
<a name="l01589"></a>01589   }
<a name="l01590"></a>01590 
<a name="l01591"></a>01591   <span class="keywordflow">if</span>(0 != _pSourceIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)
<a name="l01592"></a>01592   {
<a name="l01593"></a>01593     <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_OPERATIONERROR);
<a name="l01594"></a>01594     <span class="keywordflow">return</span> TWRC_FAILURE;
<a name="l01595"></a>01595   }
<a name="l01596"></a>01596 
<a name="l01597"></a>01597   <span class="comment">// In Windows the default Data Source is stored in the registry</span>
<a name="l01598"></a>01598   <span class="comment">// as the path to that DS.  We will need to compair this to the other DS as a match.</span>
<a name="l01599"></a>01599   <span class="comment">// read default source from Registry</span>
<a name="l01600"></a>01600   memset(<a class="code" href="dsm_8cpp.html#6bc385ca03d3f2a27e1376c1d67a7aaa">_gDefaultDSPath</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="dsm_8cpp.html#6bc385ca03d3f2a27e1376c1d67a7aaa">_gDefaultDSPath</a>));
<a name="l01601"></a>01601   memset(<a class="code" href="dsm_8cpp.html#60f4da5c3d0621d10645495de11c2f1f">_gDefaultDSName</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="dsm_8cpp.html#60f4da5c3d0621d10645495de11c2f1f">_gDefaultDSName</a>));
<a name="l01602"></a>01602 
<a name="l01603"></a>01603 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l01604"></a>01604 <span class="preprocessor"></span>  HKEY hKey;
<a name="l01605"></a>01605   <span class="keywordflow">if</span>( RegOpenKeyEx(HKEY_CURRENT_USER, <span class="stringliteral">"Software\\Microsoft\\Windows NT\\CurrentVersion\\Twain"</span>,
<a name="l01606"></a>01606       0, KEY_READ, &amp;hKey) == ERROR_SUCCESS )
<a name="l01607"></a>01607   {
<a name="l01608"></a>01608     <span class="comment">// Look for the subkey "Default Source".</span>
<a name="l01609"></a>01609     DWORD DWtype = REG_SZ;
<a name="l01610"></a>01610     DWORD DWsize = <span class="keyword">sizeof</span>(_gDefaultDSPath);
<a name="l01611"></a>01611     BOOL bRunAtStartup = ( RegQueryValueEx( hKey, <span class="stringliteral">"Default Source"</span>, NULL, &amp;DWtype, (LPBYTE)_gDefaultDSPath, &amp;DWsize) == ERROR_SUCCESS );
<a name="l01612"></a>01612 
<a name="l01613"></a>01613     <span class="comment">// Close the registry key handle.</span>
<a name="l01614"></a>01614     RegCloseKey(hKey);
<a name="l01615"></a>01615   }
<a name="l01616"></a>01616 <span class="preprocessor">#else</span>
<a name="l01617"></a>01617 <span class="preprocessor"></span>  <span class="comment">// TODO other OS read the default Source from stored location</span>
<a name="l01618"></a>01618   assert(0);
<a name="l01619"></a>01619 <span class="preprocessor">#endif</span>
<a name="l01620"></a>01620 <span class="preprocessor"></span>
<a name="l01621"></a>01621 
<a name="l01622"></a>01622   <span class="comment">// If current default source is not a match find a new default source</span>
<a name="l01623"></a>01623   <span class="comment">// that will match this app</span>
<a name="l01624"></a>01624   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x = 0; x &lt; pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#07dd92469632391cc5ec7a6b428936b9">NumFiles</a>; ++x)
<a name="l01625"></a>01625   {
<a name="l01626"></a>01626     <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> ptmpIdent = &amp;(pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>-&gt;<a class="code" href="structDS__LIST.html#c82989e70ba5e1fec7b1cfd4e16b1582">DSInfo</a>[x].<a class="code" href="structDS__INFO.html#cd03f5b816161fedab7741c0f917373c">Identity</a>);
<a name="l01627"></a>01627 
<a name="l01628"></a>01628     <span class="comment">//if(TRUE == SupportedMatch(_pAppIdentity, ptmpIdent))</span>
<a name="l01629"></a>01629     {
<a name="l01630"></a>01630       <span class="comment">// Mark the first match to use as default </span>
<a name="l01631"></a>01631       <span class="keywordflow">if</span>(!bMatchFnd)
<a name="l01632"></a>01632       {
<a name="l01633"></a>01633         *_pSourceIdentity = *ptmpIdent;
<a name="l01634"></a>01634         bMatchFnd = <span class="keyword">true</span>;
<a name="l01635"></a>01635       }
<a name="l01636"></a>01636       <span class="comment">// If the system default is a match we will use it and stop looking.</span>
<a name="l01637"></a>01637       <span class="keywordflow">if</span>(0 == strnicmp(<a class="code" href="dsm_8cpp.html#6bc385ca03d3f2a27e1376c1d67a7aaa">_gDefaultDSPath</a>, pAppInfo-&gt;pDSList-&gt;DSInfo[x].szPath, <span class="keyword">sizeof</span>(pAppInfo-&gt;pDSList-&gt;DSInfo[x].szPath)))
<a name="l01638"></a>01638       {
<a name="l01639"></a>01639         *_pSourceIdentity = *ptmpIdent;
<a name="l01640"></a>01640         bMatchFnd = <span class="keyword">true</span>;
<a name="l01641"></a>01641         <span class="keywordflow">break</span>;
<a name="l01642"></a>01642       }
<a name="l01643"></a>01643     }
<a name="l01644"></a>01644   }
<a name="l01645"></a>01645 
<a name="l01646"></a>01646   <span class="keywordflow">if</span>(!bMatchFnd)
<a name="l01647"></a>01647   {
<a name="l01648"></a>01648     <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_NODS);
<a name="l01649"></a>01649     <span class="keywordflow">return</span> TWRC_FAILURE;
<a name="l01650"></a>01650   }
<a name="l01651"></a>01651 
<a name="l01652"></a>01652   <span class="keywordflow">return</span> ret;
<a name="l01653"></a>01653 }
<a name="l01654"></a>01654 
<a name="l01656"></a><a class="code" href="dsm_8cpp.html#f803eab9bf60870b52a44127de24ec91">01656</a> TW_INT16 <a class="code" href="dsm_8cpp.html#f803eab9bf60870b52a44127de24ec91">AddApplication</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity)
<a name="l01657"></a>01657 {
<a name="l01658"></a>01658   TW_INT16 ret = TWRC_FAILURE;
<a name="l01659"></a>01659   assert(_pAppIdentity);
<a name="l01660"></a>01660   <span class="keywordtype">int</span> i = 0;
<a name="l01661"></a>01661 
<a name="l01662"></a>01662   <span class="comment">//Go through the list and find an empty location</span>
<a name="l01663"></a>01663   <span class="comment">// Already tested that there is enough room to fit</span>
<a name="l01664"></a>01664   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>; i++)
<a name="l01665"></a>01665   {
<a name="l01666"></a>01666     <span class="keywordflow">if</span>(<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[i].<a class="code" href="structAPP__INFO.html#2ca72dc24f8e4965e473c9f14ea106e4">pOrigin</a> == NULL)
<a name="l01667"></a>01667     {
<a name="l01668"></a>01668       <span class="comment">// The application ID is always +1 greater then the array index it resides in.</span>
<a name="l01669"></a>01669       <span class="comment">// The kOUT and kIN definitions help manage this.</span>
<a name="l01670"></a>01670       <a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#21e47849a385b5bb080e8266e76102c4">NumApps</a>++;
<a name="l01671"></a>01671 
<a name="l01672"></a>01672       _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>         = <a class="code" href="dsmdefs_8h.html#760595fa4202d2be9c3d3d778f812354">kOUT</a>(i);
<a name="l01673"></a>01673       <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo        = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l01674"></a>01674 
<a name="l01675"></a>01675       pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#2ca72dc24f8e4965e473c9f14ea106e4">pOrigin</a>         = _pAppIdentity;
<a name="l01676"></a>01676       pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#dee54707e2685067ec6a66ed1374a261">OpenSource</a>      = -1;
<a name="l01677"></a>01677       pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>         = <span class="keyword">new</span> <a class="code" href="structDS__LIST.html">DS_LIST</a>;
<a name="l01678"></a>01678 
<a name="l01679"></a>01679       memset(pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#4160f689c13c3aac77938952300d70d3">pDSList</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="structDS__LIST.html">DS_LIST</a>));
<a name="l01680"></a>01680       
<a name="l01681"></a>01681       ret = TWRC_SUCCESS;
<a name="l01682"></a>01682       <span class="keywordflow">return</span> ret;
<a name="l01683"></a>01683       <span class="keywordflow">break</span>;
<a name="l01684"></a>01684     }
<a name="l01685"></a>01685   }
<a name="l01686"></a>01686 
<a name="l01687"></a>01687   <span class="comment">// Something went wrong, the array is full</span>
<a name="l01688"></a>01688   assert(i&lt;<a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l01689"></a>01689   <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pAppIdentity, TWCC_MAXCONNECTIONS);
<a name="l01690"></a>01690   <span class="keywordflow">return</span> ret;
<a name="l01691"></a>01691 }
<a name="l01692"></a>01692 
<a name="l01694"></a><a class="code" href="dsm_8cpp.html#536a09bd6c21c5878a1f9b7313a3eca7">01694</a> <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> <a class="code" href="dsm_8cpp.html#536a09bd6c21c5878a1f9b7313a3eca7">findApplicationByName</a>(pTW_STR32 _pName)
<a name="l01695"></a>01695 {
<a name="l01696"></a>01696   <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = NULL;
<a name="l01697"></a>01697 
<a name="l01698"></a>01698   <span class="keywordflow">for</span>(TW_INT16 x = 0; x &lt; <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>; x++)
<a name="l01699"></a>01699   {
<a name="l01700"></a>01700     <span class="keywordflow">if</span>(<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[x].<a class="code" href="structAPP__INFO.html#2ca72dc24f8e4965e473c9f14ea106e4">pOrigin</a>)
<a name="l01701"></a>01701     {
<a name="l01702"></a>01702       <span class="keywordflow">if</span>(0 == strncmp(<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[x].<a class="code" href="structAPP__INFO.html#2ca72dc24f8e4965e473c9f14ea106e4">pOrigin</a>-&gt;<a class="code" href="structTW__IDENTITY.html#4e3c2507fbbdaff9472c8316b38fd8d9">ProductName</a>, _pName, <span class="keyword">sizeof</span>(TW_STR32)))
<a name="l01703"></a>01703       {
<a name="l01704"></a>01704         <span class="comment">// app found!</span>
<a name="l01705"></a>01705         pAppInfo = &amp;(<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[x]);
<a name="l01706"></a>01706         <span class="keywordflow">break</span>;
<a name="l01707"></a>01707       }
<a name="l01708"></a>01708     }
<a name="l01709"></a>01709   }
<a name="l01710"></a>01710 
<a name="l01711"></a>01711   <span class="keywordflow">return</span> pAppInfo;
<a name="l01712"></a>01712 }
<a name="l01713"></a>01713 
<a name="l01715"></a><a class="code" href="dsm_8cpp.html#e77f69cd5a9efa7683e07bb81e424ad0">01715</a> TW_UINT16 <a class="code" href="dsm_8cpp.html#e77f69cd5a9efa7683e07bb81e424ad0">getConditionCode</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity)
<a name="l01716"></a>01716 {
<a name="l01717"></a>01717   TW_UINT16 retCC = TWCC_SUCCESS;
<a name="l01718"></a>01718   assert(_pAppIdentity &amp;&amp; _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l01719"></a>01719   <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l01720"></a>01720 
<a name="l01721"></a>01721   <span class="comment">// If the application has not registered with the DSM yet, then act on the</span>
<a name="l01722"></a>01722   <span class="comment">// global condition code instead of the application specific one.</span>
<a name="l01723"></a>01723   <span class="comment">// This will only happen on very rare occasions where the condition code</span>
<a name="l01724"></a>01724   <span class="comment">// could not be set because the calling application was ambiguous.</span>
<a name="l01725"></a>01725   <span class="keywordflow">if</span>(0 == _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)
<a name="l01726"></a>01726   {
<a name="l01727"></a>01727     retCC = <a class="code" href="dsm_8cpp.html#d7b7de190f95ab3def7bbb0286eb13e5">_gConditionCode</a>;
<a name="l01728"></a>01728     <a class="code" href="dsm_8cpp.html#d7b7de190f95ab3def7bbb0286eb13e5">_gConditionCode</a> = TWCC_SUCCESS; <span class="comment">// reset</span>
<a name="l01729"></a>01729   }
<a name="l01730"></a>01730   <span class="keywordflow">else</span>
<a name="l01731"></a>01731   {
<a name="l01732"></a>01732     retCC = pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#c968dde68b3303808eedef67467e02f0">ConditionCode</a>;
<a name="l01733"></a>01733     pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#c968dde68b3303808eedef67467e02f0">ConditionCode</a> = TWCC_SUCCESS; <span class="comment">// reset</span>
<a name="l01734"></a>01734   }
<a name="l01735"></a>01735 
<a name="l01736"></a>01736   <span class="keywordflow">return</span> retCC;
<a name="l01737"></a>01737 }
<a name="l01738"></a>01738 
<a name="l01740"></a><a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">01740</a> TW_BOOL <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pAppIdentity, TW_UINT16 _ConditionCode)
<a name="l01741"></a>01741 {
<a name="l01742"></a>01742   <span class="keywordflow">if</span>(0 == _pAppIdentity)
<a name="l01743"></a>01743   {
<a name="l01744"></a>01744     <a class="code" href="dsm_8cpp.html#d7b7de190f95ab3def7bbb0286eb13e5">_gConditionCode</a> = _ConditionCode;
<a name="l01745"></a>01745   }
<a name="l01746"></a>01746   <span class="keywordflow">else</span>
<a name="l01747"></a>01747   {
<a name="l01748"></a>01748     <span class="comment">// If the application has not registered with the DSM yet, then act on the</span>
<a name="l01749"></a>01749     <span class="comment">// global condition code instead of the application specific one.</span>
<a name="l01750"></a>01750     <span class="comment">// This will only happen on very rare occasions where the condition code</span>
<a name="l01751"></a>01751     <span class="comment">// could not be set because the calling application was ambiguous.</span>
<a name="l01752"></a>01752     <span class="keywordflow">if</span>(0 == _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)
<a name="l01753"></a>01753     {
<a name="l01754"></a>01754       <a class="code" href="dsm_8cpp.html#d7b7de190f95ab3def7bbb0286eb13e5">_gConditionCode</a> = _ConditionCode;
<a name="l01755"></a>01755     }
<a name="l01756"></a>01756     <span class="keywordflow">else</span>
<a name="l01757"></a>01757     {
<a name="l01758"></a>01758       assert(_pAppIdentity &amp;&amp; _pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a> &lt;= <a class="code" href="dsmdefs_8h.html#1530663b2465b716b6cd49c5493c7afe">MAX_NUM_APPS</a>);
<a name="l01759"></a>01759       <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pAppIdentity-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)];
<a name="l01760"></a>01760       pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#c968dde68b3303808eedef67467e02f0">ConditionCode</a> = _ConditionCode;
<a name="l01761"></a>01761     }
<a name="l01762"></a>01762   }
<a name="l01763"></a>01763 
<a name="l01764"></a>01764   <span class="keywordflow">if</span>(_ConditionCode != TWCC_SUCCESS)
<a name="l01765"></a>01765   {
<a name="l01766"></a>01766     <a class="code" href="dsm_8cpp.html#a72b5d2715fa48220edcbb894df6b463">kLOG</a> &lt;&lt; <span class="stringliteral">" - Condition Code: "</span> &lt;&lt; <a class="code" href="dsm_8cpp.html#893e676872a5110b8ecbff84fa6e99a2">StringFromCC</a>(_ConditionCode).c_str();
<a name="l01767"></a>01767   }
<a name="l01768"></a>01768 
<a name="l01769"></a>01769   <span class="keywordflow">return</span> <a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01770"></a>01770 }
<a name="l01771"></a>01771 
<a name="l01773"></a><a class="code" href="dsm_8cpp.html#863bc61162c172980c5b369a8a64418f">01773</a> <span class="preprocessor">#define TRACECOUNTLIMIT 5</span>
<a name="l01774"></a>01774 <span class="preprocessor"></span>
<a name="l01775"></a><a class="code" href="dsm_8cpp.html#868b0320392455cc6766e14d2c7bab12">01775</a> <span class="keywordtype">bool</span> <a class="code" href="dsm_8cpp.html#868b0320392455cc6766e14d2c7bab12">printTripletsInfo</a>(<span class="keyword">const</span> TW_UINT32    _DG,
<a name="l01776"></a>01776                        <span class="keyword">const</span> TW_UINT16    _DAT,
<a name="l01777"></a>01777                        <span class="keyword">const</span> TW_UINT16    _MSG,
<a name="l01778"></a>01778                        <span class="keyword">const</span> TW_MEMREF    _pData)
<a name="l01779"></a>01779 {
<a name="l01780"></a>01780   <span class="keyword">static</span> TW_UINT32 LastDG = 0;
<a name="l01781"></a>01781   <span class="keyword">static</span> TW_UINT16 LastDat = 0;
<a name="l01782"></a>01782   <span class="keyword">static</span> TW_UINT16 LastMsg = 0;
<a name="l01783"></a>01783   <span class="keyword">static</span> <span class="keywordtype">int</span> nCount = 0;
<a name="l01784"></a>01784   <span class="keywordtype">bool</span> bPrint = <span class="keyword">false</span>;
<a name="l01785"></a>01785 
<a name="l01786"></a>01786   <span class="keywordflow">if</span>(0 == <a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a> || !<a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a>-&gt;is_open()) 
<a name="l01787"></a>01787   {
<a name="l01788"></a>01788     <span class="keywordflow">return</span> bPrint;
<a name="l01789"></a>01789   }
<a name="l01790"></a>01790 
<a name="l01791"></a>01791   <span class="comment">// too many of these messages to log</span>
<a name="l01792"></a>01792   <span class="keywordflow">if</span>( DG_CONTROL == _DG &amp;&amp; DAT_EVENT == _DAT )
<a name="l01793"></a>01793   {
<a name="l01794"></a>01794     <span class="keywordflow">return</span> bPrint;
<a name="l01795"></a>01795   }
<a name="l01796"></a>01796     
<a name="l01797"></a>01797   <span class="keywordflow">if</span>(_DG == LastDG &amp;&amp; _DAT == LastDat &amp;&amp; _MSG == LastMsg)
<a name="l01798"></a>01798   {
<a name="l01799"></a>01799     <span class="keywordflow">if</span>( !(DG_CONTROL == _DG &amp;&amp; DAT_CAPABILITY == _DAT) )
<a name="l01800"></a>01800     {
<a name="l01801"></a>01801       nCount++;
<a name="l01802"></a>01802     }
<a name="l01803"></a>01803   }
<a name="l01804"></a>01804   <span class="keywordflow">else</span>
<a name="l01805"></a>01805   {
<a name="l01806"></a>01806     <span class="keywordflow">if</span>(nCount &gt; <a class="code" href="dsm_8cpp.html#863bc61162c172980c5b369a8a64418f">TRACECOUNTLIMIT</a>)
<a name="l01807"></a>01807     {
<a name="l01808"></a>01808       TW_STR32 sCount;
<a name="l01809"></a>01809       <a class="code" href="dsm_8h.html#770571e12ff9370899184528f4b4626d">SNPRINTF</a>(sCount, 32, <span class="stringliteral">"%d"</span>, nCount - <a class="code" href="dsm_8cpp.html#863bc61162c172980c5b369a8a64418f">TRACECOUNTLIMIT</a>);
<a name="l01810"></a>01810 
<a name="l01811"></a>01811       <a class="code" href="dsm_8cpp.html#a72b5d2715fa48220edcbb894df6b463">kLOG</a> &lt;&lt; <span class="stringliteral">"(last message repeated "</span> &lt;&lt; sCount &lt;&lt; <span class="stringliteral">" more times, but not printed.)"</span> &lt;&lt; endl;
<a name="l01812"></a>01812     }
<a name="l01813"></a>01813     nCount = 1;
<a name="l01814"></a>01814   }
<a name="l01815"></a>01815 
<a name="l01816"></a>01816   <span class="keywordflow">if</span>(nCount &lt;= <a class="code" href="dsm_8cpp.html#863bc61162c172980c5b369a8a64418f">TRACECOUNTLIMIT</a>)
<a name="l01817"></a>01817   {
<a name="l01818"></a>01818     <span class="keywordflow">if</span>(DG_CONTROL == _DG &amp;&amp; DAT_NULL == _DAT)
<a name="l01819"></a>01819     {
<a name="l01820"></a>01820       *<a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a> &lt;&lt; endl &lt;&lt; <span class="stringliteral">"   "</span>;
<a name="l01821"></a>01821     }
<a name="l01822"></a>01822     *<a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a> &lt;&lt; <span class="stringliteral">"DSM ["</span> &lt;&lt; <a class="code" href="dsm_8cpp.html#05d5448e7ae3f9f6ff48b76c39825715">gOurPid</a> &lt;&lt; <span class="stringliteral">"]: "</span> &lt;&lt; <a class="code" href="dsm_8cpp.html#620e15d5ff1c8c596e563ef4d2c7de6a">StringFromDG</a>(_DG).c_str() &lt;&lt; <span class="stringliteral">" / "</span> &lt;&lt; <a class="code" href="dsm_8cpp.html#0f66379c704db754860b72a7a8df5e81">StringFromDat</a>(_DAT).c_str() &lt;&lt; <span class="stringliteral">" / "</span> &lt;&lt; <a class="code" href="dsm_8cpp.html#64a0f7db2839cdeaff166583d31b7996">StringFromMsg</a>(_MSG).c_str() &lt;&lt; <span class="stringliteral">" "</span>;
<a name="l01823"></a>01823     <span class="keywordflow">if</span>(DG_CONTROL == _DG &amp;&amp; DAT_CAPABILITY == _DAT &amp;&amp; NULL != _pData)
<a name="l01824"></a>01824     {
<a name="l01825"></a>01825       <a class="code" href="structTW__CAPABILITY.html">pTW_CAPABILITY</a> _pCap = (<a class="code" href="structTW__CAPABILITY.html">pTW_CAPABILITY</a>)_pData;
<a name="l01826"></a>01826       *<a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a> &lt;&lt; <span class="stringliteral">"/ "</span> &lt;&lt; <a class="code" href="dsm_8cpp.html#9e58b44743cbac1b1fecb7f264eb91d5">StringFromCap</a>(_pCap-&gt;<a class="code" href="structTW__CAPABILITY.html#d96bdbd550df1706d66b3846b05966ec">Cap</a>).c_str() &lt;&lt; <span class="stringliteral">" "</span>;
<a name="l01827"></a>01827       <span class="comment">//&lt;&lt; "/ " &lt;&lt; StringFromContainer(_pCap-&gt;ConType, _pCap-&gt;ConType).c_str() &lt;&lt; " ";</span>
<a name="l01828"></a>01828     }
<a name="l01829"></a>01829     bPrint = <span class="keyword">true</span>;
<a name="l01830"></a>01830   }
<a name="l01831"></a>01831 
<a name="l01832"></a>01832   LastDG = _DG;
<a name="l01833"></a>01833   LastDat = _DAT;
<a name="l01834"></a>01834   LastMsg = _MSG;
<a name="l01835"></a>01835 
<a name="l01836"></a>01836   <span class="keywordflow">return</span> bPrint;
<a name="l01837"></a>01837 }
<a name="l01838"></a>01838 
<a name="l01839"></a><a class="code" href="dsm_8cpp.html#92959e187d12b1470d7899c6498c8fc9">01839</a> <span class="keywordtype">void</span> <a class="code" href="dsm_8cpp.html#92959e187d12b1470d7899c6498c8fc9">printReturnCode</a>( <span class="keyword">const</span> TW_UINT16 rc )
<a name="l01840"></a>01840 {
<a name="l01841"></a>01841   <span class="keywordflow">if</span>(0 == <a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a> || !<a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a>-&gt;is_open()) 
<a name="l01842"></a>01842   {
<a name="l01843"></a>01843     <span class="keywordflow">return</span>;
<a name="l01844"></a>01844   }
<a name="l01845"></a>01845 
<a name="l01846"></a>01846   *<a class="code" href="dsm_8cpp.html#3a3b3b82c0c7bbe0d217661778f5bdaf">gpLogFile</a> &lt;&lt; <span class="stringliteral">"= "</span> &lt;&lt; <a class="code" href="dsm_8cpp.html#84fe3ba26a0fc001597b1ae82769de97">StringFromRC</a>(rc).c_str() &lt;&lt; endl;
<a name="l01847"></a>01847 }
<a name="l01848"></a>01848 
<a name="l01849"></a>01849 
<a name="l01851"></a><a class="code" href="dsm_8cpp.html#bbdef667ceb3cb5424c14fd07efb21dd">01851</a> TW_INT16 <a class="code" href="dsm_8cpp.html#bbdef667ceb3cb5424c14fd07efb21dd">DSM_Null</a>(<a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pOrigin,
<a name="l01852"></a>01852                   <a class="code" href="structTW__IDENTITY.html">pTW_IDENTITY</a> _pDest,
<a name="l01853"></a>01853                   TW_UINT16    _MSG)
<a name="l01854"></a>01854 {
<a name="l01855"></a>01855   TW_INT16 twrc = TWRC_SUCCESS;
<a name="l01856"></a>01856 
<a name="l01857"></a>01857   <span class="keywordflow">if</span>(0 == _pOrigin)
<a name="l01858"></a>01858   {
<a name="l01859"></a>01859     <a class="code" href="dsm_8cpp.html#a72b5d2715fa48220edcbb894df6b463">kLOG</a> &lt;&lt; <span class="stringliteral">"Invalid source pointer"</span> &lt;&lt; endl;
<a name="l01860"></a>01860     <span class="keywordflow">return</span> TWRC_FAILURE;
<a name="l01861"></a>01861   }
<a name="l01862"></a>01862 
<a name="l01863"></a>01863   <span class="keywordflow">if</span>(0 == _pDest)
<a name="l01864"></a>01864   {
<a name="l01865"></a>01865     <a class="code" href="dsm_8cpp.html#a72b5d2715fa48220edcbb894df6b463">kLOG</a> &lt;&lt; <span class="stringliteral">"Invalid destination pointer"</span> &lt;&lt; endl;
<a name="l01866"></a>01866     <span class="keywordflow">return</span> TWRC_FAILURE;
<a name="l01867"></a>01867   }
<a name="l01868"></a>01868 
<a name="l01869"></a>01869   <span class="comment">// Invoke the applications callback to send this message along.</span>
<a name="l01870"></a>01870   <span class="keywordflow">if</span>( MSG_DEVICEEVENT != _MSG &amp;&amp;
<a name="l01871"></a>01871       MSG_CLOSEDSREQ  != _MSG &amp;&amp;
<a name="l01872"></a>01872       MSG_XFERREADY   != _MSG)
<a name="l01873"></a>01873   {
<a name="l01874"></a>01874     <a class="code" href="dsm_8cpp.html#504a3e9d86dba3333f8c32f9f6d10a4b">setConditionCode</a>(_pOrigin, TWCC_BADPROTOCOL);
<a name="l01875"></a>01875     <span class="keywordflow">return</span> TWRC_FAILURE;
<a name="l01876"></a>01876   }
<a name="l01877"></a>01877 
<a name="l01878"></a>01878   <a class="code" href="structAPP__INFO.html">pAPP_INFO</a> pAppInfo = &amp;(<a class="code" href="dsm_8cpp.html#989913391daf6f2242bea3fad4e74cfa">_gApplications</a>.<a class="code" href="structAPP__LIST.html#eadda8c8de7ada2632763411030413f0">AppInfo</a>[<a class="code" href="dsmdefs_8h.html#3ee6d6c2c873e3e399fb7473c994697e">kIN</a>(_pDest-&gt;<a class="code" href="structTW__IDENTITY.html#f7c2a1828ef7dbce91d1ad88cc82467a">Id</a>)]);
<a name="l01879"></a>01879   <a class="code" href="structTW__CALLBACK.html">pTW_CALLBACK</a> pCallback = &amp;(pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#a00cb746097e2d305fa92ee6d231092d">Callback</a>.<a class="code" href="structCallBackInfo.html#58b10afd686c9ff1e32249a2ce235855">callback</a>);
<a name="l01880"></a>01880   <span class="keywordflow">if</span>( 0 != pCallback-&gt;<a class="code" href="structTW__CALLBACK.html#b15caaafceed7c1a0934fba9463855e2">CallBackProc</a>)
<a name="l01881"></a>01881   {
<a name="l01882"></a>01882     ((DSMENTRYPROC)(pCallback-&gt;<a class="code" href="structTW__CALLBACK.html#b15caaafceed7c1a0934fba9463855e2">CallBackProc</a>))(
<a name="l01883"></a>01883         _pOrigin,            <span class="comment">// pTW_IDENTITY pOrigin</span>
<a name="l01884"></a>01884         _pDest,              <span class="comment">// pTW_IDENTITY pDest</span>
<a name="l01885"></a>01885         DG_CONTROL,          <span class="comment">// TW_UINT32    DG</span>
<a name="l01886"></a>01886         DAT_CALLBACK,        <span class="comment">// TW_UINT16    DAT</span>
<a name="l01887"></a>01887         _MSG,                <span class="comment">// TW_UINT16    MSG</span>
<a name="l01888"></a>01888         0);                  <span class="comment">// TW_MEMREF    pData</span>
<a name="l01889"></a>01889   }
<a name="l01890"></a>01890   <span class="keywordflow">else</span>
<a name="l01891"></a>01891   {
<a name="l01892"></a>01892     <span class="comment">// Application has not registered a callback. As a result, the msg will</span>
<a name="l01893"></a>01893     <span class="comment">// be sent to the app the next time it forwards an event.</span>
<a name="l01894"></a>01894     <span class="comment">// @todo I don't like how we only store the last message for the app. If</span>
<a name="l01895"></a>01895     <span class="comment">// multiple DS's make a callback to a single app, we are going to lose MSG's</span>
<a name="l01896"></a>01896     pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#a00cb746097e2d305fa92ee6d231092d">Callback</a>.<a class="code" href="structCallBackInfo.html#ea4c1a10bab38efa22ccfc451f1f6942">bCallbackPending</a> = <a class="code" href="dsmdefs_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01897"></a>01897     pAppInfo-&gt;<a class="code" href="structAPP__INFO.html#a00cb746097e2d305fa92ee6d231092d">Callback</a>.<a class="code" href="structCallBackInfo.html#58b10afd686c9ff1e32249a2ce235855">callback</a>.<a class="code" href="structTW__CALLBACK.html#a14c95fe8038ce849ea5440e9aa01eaa">Message</a> = _MSG;
<a name="l01898"></a>01898   }
<a name="l01899"></a>01899   <span class="keywordflow">return</span> twrc;
<a name="l01900"></a>01900 }
<a name="l01901"></a>01901 
<a name="l01902"></a><a class="code" href="dsm_8cpp.html#620e15d5ff1c8c596e563ef4d2c7de6a">01902</a> string <a class="code" href="dsm_8cpp.html#620e15d5ff1c8c596e563ef4d2c7de6a">StringFromDG</a>(<span class="keyword">const</span> TW_UINT32 _DG)
<a name="l01903"></a>01903 {
<a name="l01904"></a>01904   <span class="keywordflow">switch</span>(_DG)
<a name="l01905"></a>01905   {
<a name="l01906"></a>01906     <span class="keywordflow">case</span> DG_CONTROL:
<a name="l01907"></a>01907       <span class="keywordflow">return</span> <span class="stringliteral">"DG_CONTROL"</span>;
<a name="l01908"></a>01908       <span class="keywordflow">break</span>;
<a name="l01909"></a>01909 
<a name="l01910"></a>01910     <span class="keywordflow">case</span> DG_IMAGE:
<a name="l01911"></a>01911       <span class="keywordflow">return</span> <span class="stringliteral">"DG_IMAGE"</span>;
<a name="l01912"></a>01912       <span class="keywordflow">break</span>;
<a name="l01913"></a>01913 
<a name="l01914"></a>01914     <span class="keywordflow">case</span> DG_AUDIO:
<a name="l01915"></a>01915       <span class="keywordflow">return</span> <span class="stringliteral">"DG_AUDIO"</span>;
<a name="l01916"></a>01916       <span class="keywordflow">break</span>;
<a name="l01917"></a>01917   }
<a name="l01918"></a>01918 
<a name="l01919"></a>01919   TW_STR32 hex;
<a name="l01920"></a>01920   <a class="code" href="dsm_8h.html#770571e12ff9370899184528f4b4626d">SNPRINTF</a>(hex, 32, <span class="stringliteral">"0x%04lx"</span>, _DG);
<a name="l01921"></a>01921 
<a name="l01922"></a>01922   <span class="keywordflow">return</span> hex;
<a name="l01923"></a>01923 }
<a name="l01924"></a>01924 
<a name="l01925"></a><a class="code" href="dsm_8cpp.html#0f66379c704db754860b72a7a8df5e81">01925</a> string <a class="code" href="dsm_8cpp.html#0f66379c704db754860b72a7a8df5e81">StringFromDat</a>(<span class="keyword">const</span> TW_UINT16 _DAT)
<a name="l01926"></a>01926 {
<a name="l01927"></a>01927   <span class="keywordflow">switch</span>(_DAT)
<a name="l01928"></a>01928   {
<a name="l01929"></a>01929     <span class="keywordflow">case</span> DAT_NULL:
<a name="l01930"></a>01930       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_NULL"</span>;
<a name="l01931"></a>01931       <span class="keywordflow">break</span>;
<a name="l01932"></a>01932 
<a name="l01933"></a>01933     <span class="keywordflow">case</span> DAT_CUSTOMBASE:
<a name="l01934"></a>01934       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_CUSTOMBASE"</span>;
<a name="l01935"></a>01935       <span class="keywordflow">break</span>;
<a name="l01936"></a>01936 
<a name="l01937"></a>01937     <span class="keywordflow">case</span> DAT_CAPABILITY:
<a name="l01938"></a>01938       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_CAPABILITY"</span>;
<a name="l01939"></a>01939       <span class="keywordflow">break</span>;
<a name="l01940"></a>01940 
<a name="l01941"></a>01941     <span class="keywordflow">case</span> DAT_EVENT:
<a name="l01942"></a>01942       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_EVENT"</span>;
<a name="l01943"></a>01943       <span class="keywordflow">break</span>;
<a name="l01944"></a>01944 
<a name="l01945"></a>01945     <span class="keywordflow">case</span> DAT_IDENTITY:
<a name="l01946"></a>01946       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_IDENTITY"</span>;
<a name="l01947"></a>01947       <span class="keywordflow">break</span>;
<a name="l01948"></a>01948 
<a name="l01949"></a>01949     <span class="keywordflow">case</span> DAT_PARENT:
<a name="l01950"></a>01950       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_PARENT"</span>;
<a name="l01951"></a>01951       <span class="keywordflow">break</span>;
<a name="l01952"></a>01952 
<a name="l01953"></a>01953     <span class="keywordflow">case</span> DAT_PENDINGXFERS:
<a name="l01954"></a>01954       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_PENDINGXFERS"</span>;
<a name="l01955"></a>01955       <span class="keywordflow">break</span>;
<a name="l01956"></a>01956 
<a name="l01957"></a>01957     <span class="keywordflow">case</span> DAT_SETUPMEMXFER:
<a name="l01958"></a>01958       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_SETUPMEMXFER"</span>;
<a name="l01959"></a>01959       <span class="keywordflow">break</span>;
<a name="l01960"></a>01960 
<a name="l01961"></a>01961     <span class="keywordflow">case</span> DAT_SETUPFILEXFER:
<a name="l01962"></a>01962       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_SETUPFILEXFER"</span>;
<a name="l01963"></a>01963       <span class="keywordflow">break</span>;
<a name="l01964"></a>01964 
<a name="l01965"></a>01965     <span class="keywordflow">case</span> DAT_STATUS:
<a name="l01966"></a>01966       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_STATUS"</span>;
<a name="l01967"></a>01967       <span class="keywordflow">break</span>;
<a name="l01968"></a>01968 
<a name="l01969"></a>01969     <span class="keywordflow">case</span> DAT_USERINTERFACE:
<a name="l01970"></a>01970       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_USERINTERFACE"</span>;
<a name="l01971"></a>01971       <span class="keywordflow">break</span>;
<a name="l01972"></a>01972 
<a name="l01973"></a>01973     <span class="keywordflow">case</span> DAT_XFERGROUP:
<a name="l01974"></a>01974       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_XFERGROUP"</span>;
<a name="l01975"></a>01975       <span class="keywordflow">break</span>;
<a name="l01976"></a>01976 
<a name="l01977"></a>01977     <span class="keywordflow">case</span> DAT_TWUNKIDENTITY:
<a name="l01978"></a>01978       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_TWUNKIDENTITY"</span>;
<a name="l01979"></a>01979       <span class="keywordflow">break</span>;
<a name="l01980"></a>01980 
<a name="l01981"></a>01981     <span class="keywordflow">case</span> DAT_CUSTOMDSDATA:
<a name="l01982"></a>01982       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_CUSTOMDSDATA"</span>;
<a name="l01983"></a>01983       <span class="keywordflow">break</span>;
<a name="l01984"></a>01984 
<a name="l01985"></a>01985     <span class="keywordflow">case</span> DAT_DEVICEEVENT:
<a name="l01986"></a>01986       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_DEVICEEVENT"</span>;
<a name="l01987"></a>01987       <span class="keywordflow">break</span>;
<a name="l01988"></a>01988 
<a name="l01989"></a>01989     <span class="keywordflow">case</span> DAT_FILESYSTEM:
<a name="l01990"></a>01990       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_FILESYSTEM"</span>;
<a name="l01991"></a>01991       <span class="keywordflow">break</span>;
<a name="l01992"></a>01992 
<a name="l01993"></a>01993     <span class="keywordflow">case</span> DAT_PASSTHRU:
<a name="l01994"></a>01994       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_PASSTHRU"</span>;
<a name="l01995"></a>01995       <span class="keywordflow">break</span>;
<a name="l01996"></a>01996 
<a name="l01997"></a>01997     <span class="keywordflow">case</span> DAT_CALLBACK:
<a name="l01998"></a>01998       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_CALLBACK"</span>;
<a name="l01999"></a>01999       <span class="keywordflow">break</span>;
<a name="l02000"></a>02000 
<a name="l02001"></a>02001     <span class="keywordflow">case</span> DAT_IMAGEINFO:
<a name="l02002"></a>02002       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_IMAGEINFO"</span>;
<a name="l02003"></a>02003       <span class="keywordflow">break</span>;
<a name="l02004"></a>02004 
<a name="l02005"></a>02005     <span class="keywordflow">case</span> DAT_IMAGELAYOUT:
<a name="l02006"></a>02006       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_IMAGELAYOUT"</span>;
<a name="l02007"></a>02007       <span class="keywordflow">break</span>;
<a name="l02008"></a>02008 
<a name="l02009"></a>02009     <span class="keywordflow">case</span> DAT_IMAGEMEMXFER:
<a name="l02010"></a>02010       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_IMAGEMEMXFER"</span>;
<a name="l02011"></a>02011       <span class="keywordflow">break</span>;
<a name="l02012"></a>02012 
<a name="l02013"></a>02013     <span class="keywordflow">case</span> DAT_IMAGENATIVEXFER:
<a name="l02014"></a>02014       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_IMAGENATIVEXFER"</span>;
<a name="l02015"></a>02015       <span class="keywordflow">break</span>;
<a name="l02016"></a>02016 
<a name="l02017"></a>02017     <span class="keywordflow">case</span> DAT_IMAGEFILEXFER:
<a name="l02018"></a>02018       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_IMAGEFILEXFER"</span>;
<a name="l02019"></a>02019       <span class="keywordflow">break</span>;
<a name="l02020"></a>02020 
<a name="l02021"></a>02021     <span class="keywordflow">case</span> DAT_CIECOLOR:
<a name="l02022"></a>02022       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_CIECOLOR"</span>;
<a name="l02023"></a>02023       <span class="keywordflow">break</span>;
<a name="l02024"></a>02024 
<a name="l02025"></a>02025     <span class="keywordflow">case</span> DAT_GRAYRESPONSE:
<a name="l02026"></a>02026       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_GRAYRESPONSE"</span>;
<a name="l02027"></a>02027       <span class="keywordflow">break</span>;
<a name="l02028"></a>02028 
<a name="l02029"></a>02029     <span class="keywordflow">case</span> DAT_RGBRESPONSE:
<a name="l02030"></a>02030       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_RGBRESPONSE"</span>;
<a name="l02031"></a>02031       <span class="keywordflow">break</span>;
<a name="l02032"></a>02032 
<a name="l02033"></a>02033     <span class="keywordflow">case</span> DAT_JPEGCOMPRESSION:
<a name="l02034"></a>02034       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_JPEGCOMPRESSION"</span>;
<a name="l02035"></a>02035       <span class="keywordflow">break</span>;
<a name="l02036"></a>02036 
<a name="l02037"></a>02037     <span class="keywordflow">case</span> DAT_PALETTE8:
<a name="l02038"></a>02038       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_PALETTE8"</span>;
<a name="l02039"></a>02039       <span class="keywordflow">break</span>;
<a name="l02040"></a>02040 
<a name="l02041"></a>02041     <span class="keywordflow">case</span> DAT_EXTIMAGEINFO:
<a name="l02042"></a>02042       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_EXTIMAGEINFO"</span>;
<a name="l02043"></a>02043       <span class="keywordflow">break</span>;
<a name="l02044"></a>02044 
<a name="l02045"></a>02045     <span class="keywordflow">case</span> DAT_AUDIOFILEXFER:
<a name="l02046"></a>02046       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_AUDIOFILEXFER"</span>;
<a name="l02047"></a>02047       <span class="keywordflow">break</span>;
<a name="l02048"></a>02048 
<a name="l02049"></a>02049     <span class="keywordflow">case</span> DAT_AUDIOINFO:
<a name="l02050"></a>02050       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_AUDIOINFO"</span>;
<a name="l02051"></a>02051       <span class="keywordflow">break</span>;
<a name="l02052"></a>02052 
<a name="l02053"></a>02053     <span class="keywordflow">case</span> DAT_AUDIONATIVEXFER:
<a name="l02054"></a>02054       <span class="keywordflow">return</span> <span class="stringliteral">"DAT_AUDIONATIVEXFER"</span>;
<a name="l02055"></a>02055       <span class="keywordflow">break</span>;
<a name="l02056"></a>02056   }
<a name="l02057"></a>02057 
<a name="l02058"></a>02058   TW_STR32 hex;
<a name="l02059"></a>02059   <a class="code" href="dsm_8h.html#770571e12ff9370899184528f4b4626d">SNPRINTF</a>(hex, 32, <span class="stringliteral">"0x%04x"</span>, _DAT);
<a name="l02060"></a>02060 
<a name="l02061"></a>02061   <span class="keywordflow">return</span> hex;
<a name="l02062"></a>02062 }
<a name="l02063"></a>02063 
<a name="l02064"></a><a class="code" href="dsm_8cpp.html#64a0f7db2839cdeaff166583d31b7996">02064</a> string <a class="code" href="dsm_8cpp.html#64a0f7db2839cdeaff166583d31b7996">StringFromMsg</a>(<span class="keyword">const</span> TW_UINT16 _MSG)
<a name="l02065"></a>02065 {
<a name="l02066"></a>02066   <span class="keywordflow">switch</span>(_MSG)
<a name="l02067"></a>02067   {
<a name="l02068"></a>02068     <span class="keywordflow">case</span> MSG_NULL:
<a name="l02069"></a>02069       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_NULL"</span>;
<a name="l02070"></a>02070       <span class="keywordflow">break</span>;
<a name="l02071"></a>02071     <span class="keywordflow">case</span> MSG_CUSTOMBASE:
<a name="l02072"></a>02072       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_CUSTOMBASE"</span>;
<a name="l02073"></a>02073       <span class="keywordflow">break</span>;
<a name="l02074"></a>02074     <span class="keywordflow">case</span> MSG_GET:
<a name="l02075"></a>02075       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_GET"</span>;
<a name="l02076"></a>02076       <span class="keywordflow">break</span>;
<a name="l02077"></a>02077     <span class="keywordflow">case</span> MSG_GETCURRENT:
<a name="l02078"></a>02078       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_GETCURRENT"</span>;
<a name="l02079"></a>02079       <span class="keywordflow">break</span>;
<a name="l02080"></a>02080     <span class="keywordflow">case</span> MSG_GETDEFAULT:
<a name="l02081"></a>02081       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_GETDEFAULT"</span>;
<a name="l02082"></a>02082       <span class="keywordflow">break</span>;
<a name="l02083"></a>02083     <span class="keywordflow">case</span> MSG_GETFIRST:
<a name="l02084"></a>02084       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_GETFIRST"</span>;
<a name="l02085"></a>02085       <span class="keywordflow">break</span>;
<a name="l02086"></a>02086     <span class="keywordflow">case</span> MSG_GETNEXT:
<a name="l02087"></a>02087       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_GETNEXT"</span>;
<a name="l02088"></a>02088       <span class="keywordflow">break</span>;
<a name="l02089"></a>02089     <span class="keywordflow">case</span> MSG_SET:
<a name="l02090"></a>02090       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_SET"</span>;
<a name="l02091"></a>02091       <span class="keywordflow">break</span>;
<a name="l02092"></a>02092     <span class="keywordflow">case</span> MSG_RESET:
<a name="l02093"></a>02093       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_RESET"</span>;
<a name="l02094"></a>02094       <span class="keywordflow">break</span>;
<a name="l02095"></a>02095     <span class="keywordflow">case</span> MSG_QUERYSUPPORT:
<a name="l02096"></a>02096       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_QUERYSUPPORT"</span>;
<a name="l02097"></a>02097       <span class="keywordflow">break</span>;
<a name="l02098"></a>02098     <span class="keywordflow">case</span> MSG_XFERREADY:
<a name="l02099"></a>02099       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_XFERREADY"</span>;
<a name="l02100"></a>02100       <span class="keywordflow">break</span>;
<a name="l02101"></a>02101     <span class="keywordflow">case</span> MSG_CLOSEDSREQ:
<a name="l02102"></a>02102       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_CLOSEDSREQ"</span>;
<a name="l02103"></a>02103       <span class="keywordflow">break</span>;
<a name="l02104"></a>02104     <span class="keywordflow">case</span> MSG_CLOSEDSOK:
<a name="l02105"></a>02105       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_CLOSEDSOK"</span>;
<a name="l02106"></a>02106       <span class="keywordflow">break</span>;
<a name="l02107"></a>02107     <span class="keywordflow">case</span> MSG_DEVICEEVENT:
<a name="l02108"></a>02108       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_DEVICEEVENT"</span>;
<a name="l02109"></a>02109       <span class="keywordflow">break</span>;
<a name="l02110"></a>02110     <span class="keywordflow">case</span> MSG_CHECKSTATUS:
<a name="l02111"></a>02111       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_CHECKSTATUS"</span>;
<a name="l02112"></a>02112       <span class="keywordflow">break</span>;
<a name="l02113"></a>02113     <span class="keywordflow">case</span> MSG_OPENDSM:
<a name="l02114"></a>02114       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_OPENDSM"</span>;
<a name="l02115"></a>02115       <span class="keywordflow">break</span>;
<a name="l02116"></a>02116     <span class="keywordflow">case</span> MSG_CLOSEDSM:
<a name="l02117"></a>02117       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_CLOSEDSM"</span>;
<a name="l02118"></a>02118       <span class="keywordflow">break</span>;
<a name="l02119"></a>02119     <span class="keywordflow">case</span> MSG_OPENDS:
<a name="l02120"></a>02120       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_OPENDS"</span>;
<a name="l02121"></a>02121       <span class="keywordflow">break</span>;
<a name="l02122"></a>02122     <span class="keywordflow">case</span> MSG_CLOSEDS:
<a name="l02123"></a>02123       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_CLOSEDS"</span>;
<a name="l02124"></a>02124       <span class="keywordflow">break</span>;
<a name="l02125"></a>02125     <span class="keywordflow">case</span> MSG_USERSELECT:
<a name="l02126"></a>02126       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_USERSELECT"</span>;
<a name="l02127"></a>02127       <span class="keywordflow">break</span>;
<a name="l02128"></a>02128     <span class="keywordflow">case</span> MSG_DISABLEDS:
<a name="l02129"></a>02129       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_DISABLEDS"</span>;
<a name="l02130"></a>02130       <span class="keywordflow">break</span>;
<a name="l02131"></a>02131     <span class="keywordflow">case</span> MSG_ENABLEDS:
<a name="l02132"></a>02132       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_ENABLEDS"</span>;
<a name="l02133"></a>02133       <span class="keywordflow">break</span>;
<a name="l02134"></a>02134     <span class="keywordflow">case</span> MSG_ENABLEDSUIONLY:
<a name="l02135"></a>02135       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_ENABLEDSUIONLY"</span>;
<a name="l02136"></a>02136       <span class="keywordflow">break</span>;
<a name="l02137"></a>02137     <span class="keywordflow">case</span> MSG_PROCESSEVENT:
<a name="l02138"></a>02138       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_PROCESSEVENT"</span>;
<a name="l02139"></a>02139       <span class="keywordflow">break</span>;
<a name="l02140"></a>02140     <span class="keywordflow">case</span> MSG_ENDXFER:
<a name="l02141"></a>02141       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_ENDXFER"</span>;
<a name="l02142"></a>02142       <span class="keywordflow">break</span>;
<a name="l02143"></a>02143     <span class="keywordflow">case</span> MSG_CHANGEDIRECTORY:
<a name="l02144"></a>02144       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_CHANGEDIRECTORY"</span>;
<a name="l02145"></a>02145       <span class="keywordflow">break</span>;
<a name="l02146"></a>02146     <span class="keywordflow">case</span> MSG_CREATEDIRECTORY:
<a name="l02147"></a>02147       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_CREATEDIRECTORY"</span>;
<a name="l02148"></a>02148       <span class="keywordflow">break</span>;
<a name="l02149"></a>02149     <span class="keywordflow">case</span> MSG_DELETE:
<a name="l02150"></a>02150       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_DELETE"</span>;
<a name="l02151"></a>02151       <span class="keywordflow">break</span>;
<a name="l02152"></a>02152     <span class="keywordflow">case</span> MSG_FORMATMEDIA:
<a name="l02153"></a>02153       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_FORMATMEDIA"</span>;
<a name="l02154"></a>02154       <span class="keywordflow">break</span>;
<a name="l02155"></a>02155     <span class="keywordflow">case</span> MSG_GETCLOSE:
<a name="l02156"></a>02156       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_GETCLOSE"</span>;
<a name="l02157"></a>02157       <span class="keywordflow">break</span>;
<a name="l02158"></a>02158     <span class="keywordflow">case</span> MSG_GETFIRSTFILE:
<a name="l02159"></a>02159       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_GETFIRSTFILE"</span>;
<a name="l02160"></a>02160       <span class="keywordflow">break</span>;
<a name="l02161"></a>02161     <span class="keywordflow">case</span> MSG_GETINFO:
<a name="l02162"></a>02162       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_GETINFO"</span>;
<a name="l02163"></a>02163       <span class="keywordflow">break</span>;
<a name="l02164"></a>02164     <span class="keywordflow">case</span> MSG_GETNEXTFILE:
<a name="l02165"></a>02165       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_GETNEXTFILE"</span>;
<a name="l02166"></a>02166       <span class="keywordflow">break</span>;
<a name="l02167"></a>02167     <span class="keywordflow">case</span> MSG_RENAME:
<a name="l02168"></a>02168       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_RENAME"</span>;
<a name="l02169"></a>02169       <span class="keywordflow">break</span>;
<a name="l02170"></a>02170     <span class="keywordflow">case</span> MSG_PASSTHRU:
<a name="l02171"></a>02171       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_PASSTHRU"</span>;
<a name="l02172"></a>02172       <span class="keywordflow">break</span>;
<a name="l02173"></a>02173     <span class="keywordflow">case</span> MSG_REGISTER_CALLBACK:
<a name="l02174"></a>02174       <span class="keywordflow">return</span> <span class="stringliteral">"MSG_REGISTER_CALLBACK"</span>;
<a name="l02175"></a>02175       <span class="keywordflow">break</span>;
<a name="l02176"></a>02176   }
<a name="l02177"></a>02177 
<a name="l02178"></a>02178   TW_STR32 hex;
<a name="l02179"></a>02179   <a class="code" href="dsm_8h.html#770571e12ff9370899184528f4b4626d">SNPRINTF</a>(hex, 32, <span class="stringliteral">"0x%04x"</span>, _MSG);
<a name="l02180"></a>02180 
<a name="l02181"></a>02181   <span class="keywordflow">return</span> hex;
<a name="l02182"></a>02182 }
<a name="l02183"></a>02183 
<a name="l02184"></a>02184 
<a name="l02185"></a><a class="code" href="dsm_8cpp.html#9e58b44743cbac1b1fecb7f264eb91d5">02185</a> string <a class="code" href="dsm_8cpp.html#9e58b44743cbac1b1fecb7f264eb91d5">StringFromCap</a>(<span class="keyword">const</span> TW_UINT16 _Cap)
<a name="l02186"></a>02186 {
<a name="l02187"></a>02187   <span class="keywordflow">switch</span>(_Cap)
<a name="l02188"></a>02188   {
<a name="l02189"></a>02189     <span class="keywordflow">case</span> CAP_CUSTOMBASE:
<a name="l02190"></a>02190       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_CUSTOMBASE"</span>;
<a name="l02191"></a>02191       <span class="keywordflow">break</span>;
<a name="l02192"></a>02192 
<a name="l02193"></a>02193     <span class="keywordflow">case</span> CAP_XFERCOUNT:
<a name="l02194"></a>02194       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_XFERCOUNT"</span>;
<a name="l02195"></a>02195       <span class="keywordflow">break</span>;
<a name="l02196"></a>02196 
<a name="l02197"></a>02197     <span class="keywordflow">case</span> ICAP_COMPRESSION:
<a name="l02198"></a>02198       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_COMPRESSION"</span>;
<a name="l02199"></a>02199       <span class="keywordflow">break</span>;
<a name="l02200"></a>02200 
<a name="l02201"></a>02201     <span class="keywordflow">case</span> ICAP_PIXELTYPE:
<a name="l02202"></a>02202       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_PIXELTYPE"</span>;
<a name="l02203"></a>02203       <span class="keywordflow">break</span>;
<a name="l02204"></a>02204 
<a name="l02205"></a>02205     <span class="keywordflow">case</span> ICAP_UNITS:
<a name="l02206"></a>02206       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_UNITS"</span>;
<a name="l02207"></a>02207       <span class="keywordflow">break</span>;
<a name="l02208"></a>02208 
<a name="l02209"></a>02209     <span class="keywordflow">case</span> ICAP_XFERMECH:
<a name="l02210"></a>02210       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_XFERMECH"</span>;
<a name="l02211"></a>02211       <span class="keywordflow">break</span>;
<a name="l02212"></a>02212 
<a name="l02213"></a>02213     <span class="keywordflow">case</span> CAP_AUTHOR:
<a name="l02214"></a>02214       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_AUTHOR"</span>;
<a name="l02215"></a>02215       <span class="keywordflow">break</span>;
<a name="l02216"></a>02216 
<a name="l02217"></a>02217     <span class="keywordflow">case</span> CAP_CAPTION:
<a name="l02218"></a>02218       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_CAPTION"</span>;
<a name="l02219"></a>02219       <span class="keywordflow">break</span>;
<a name="l02220"></a>02220 
<a name="l02221"></a>02221     <span class="keywordflow">case</span> CAP_FEEDERENABLED:
<a name="l02222"></a>02222       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_FEEDERENABLED"</span>;
<a name="l02223"></a>02223       <span class="keywordflow">break</span>;
<a name="l02224"></a>02224 
<a name="l02225"></a>02225     <span class="keywordflow">case</span> CAP_FEEDERLOADED:
<a name="l02226"></a>02226       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_FEEDERLOADED"</span>;
<a name="l02227"></a>02227       <span class="keywordflow">break</span>;
<a name="l02228"></a>02228 
<a name="l02229"></a>02229     <span class="keywordflow">case</span> CAP_TIMEDATE:
<a name="l02230"></a>02230       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_TIMEDATE"</span>;
<a name="l02231"></a>02231       <span class="keywordflow">break</span>;
<a name="l02232"></a>02232 
<a name="l02233"></a>02233     <span class="keywordflow">case</span> CAP_SUPPORTEDCAPS:
<a name="l02234"></a>02234       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_SUPPORTEDCAPS"</span>;
<a name="l02235"></a>02235       <span class="keywordflow">break</span>;
<a name="l02236"></a>02236 
<a name="l02237"></a>02237     <span class="keywordflow">case</span> CAP_EXTENDEDCAPS:
<a name="l02238"></a>02238       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_EXTENDEDCAPS"</span>;
<a name="l02239"></a>02239       <span class="keywordflow">break</span>;
<a name="l02240"></a>02240 
<a name="l02241"></a>02241     <span class="keywordflow">case</span> CAP_AUTOFEED:
<a name="l02242"></a>02242       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_AUTOFEED"</span>;
<a name="l02243"></a>02243       <span class="keywordflow">break</span>;
<a name="l02244"></a>02244 
<a name="l02245"></a>02245     <span class="keywordflow">case</span> CAP_CLEARPAGE:
<a name="l02246"></a>02246       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_CLEARPAGE"</span>;
<a name="l02247"></a>02247       <span class="keywordflow">break</span>;
<a name="l02248"></a>02248 
<a name="l02249"></a>02249     <span class="keywordflow">case</span> CAP_FEEDPAGE:
<a name="l02250"></a>02250       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_FEEDPAGE"</span>;
<a name="l02251"></a>02251       <span class="keywordflow">break</span>;
<a name="l02252"></a>02252 
<a name="l02253"></a>02253     <span class="keywordflow">case</span> CAP_REWINDPAGE:
<a name="l02254"></a>02254       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_REWINDPAGE"</span>;
<a name="l02255"></a>02255       <span class="keywordflow">break</span>;
<a name="l02256"></a>02256 
<a name="l02257"></a>02257     <span class="keywordflow">case</span> CAP_INDICATORS:
<a name="l02258"></a>02258       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_INDICATORS"</span>;
<a name="l02259"></a>02259       <span class="keywordflow">break</span>;
<a name="l02260"></a>02260 
<a name="l02261"></a>02261     <span class="keywordflow">case</span> CAP_SUPPORTEDCAPSEXT:
<a name="l02262"></a>02262       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_SUPPORTEDCAPSEXT"</span>;
<a name="l02263"></a>02263       <span class="keywordflow">break</span>;
<a name="l02264"></a>02264 
<a name="l02265"></a>02265     <span class="keywordflow">case</span> CAP_PAPERDETECTABLE:
<a name="l02266"></a>02266       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_PAPERDETECTABLE"</span>;
<a name="l02267"></a>02267       <span class="keywordflow">break</span>;
<a name="l02268"></a>02268 
<a name="l02269"></a>02269     <span class="keywordflow">case</span> CAP_UICONTROLLABLE:
<a name="l02270"></a>02270       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_UICONTROLLABLE"</span>;
<a name="l02271"></a>02271       <span class="keywordflow">break</span>;
<a name="l02272"></a>02272 
<a name="l02273"></a>02273     <span class="keywordflow">case</span> CAP_DEVICEONLINE:
<a name="l02274"></a>02274       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_DEVICEONLINE"</span>;
<a name="l02275"></a>02275       <span class="keywordflow">break</span>;
<a name="l02276"></a>02276 
<a name="l02277"></a>02277     <span class="keywordflow">case</span> CAP_AUTOSCAN:
<a name="l02278"></a>02278       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_AUTOSCAN"</span>;
<a name="l02279"></a>02279       <span class="keywordflow">break</span>;
<a name="l02280"></a>02280 
<a name="l02281"></a>02281     <span class="keywordflow">case</span> CAP_THUMBNAILSENABLED:
<a name="l02282"></a>02282       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_THUMBNAILSENABLED"</span>;
<a name="l02283"></a>02283       <span class="keywordflow">break</span>;
<a name="l02284"></a>02284 
<a name="l02285"></a>02285     <span class="keywordflow">case</span> CAP_DUPLEX:
<a name="l02286"></a>02286       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_DUPLEX"</span>;
<a name="l02287"></a>02287       <span class="keywordflow">break</span>;
<a name="l02288"></a>02288 
<a name="l02289"></a>02289     <span class="keywordflow">case</span> CAP_DUPLEXENABLED:
<a name="l02290"></a>02290       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_DUPLEXENABLED"</span>;
<a name="l02291"></a>02291       <span class="keywordflow">break</span>;
<a name="l02292"></a>02292 
<a name="l02293"></a>02293     <span class="keywordflow">case</span> CAP_ENABLEDSUIONLY:
<a name="l02294"></a>02294       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_ENABLEDSUIONLY"</span>;
<a name="l02295"></a>02295       <span class="keywordflow">break</span>;
<a name="l02296"></a>02296 
<a name="l02297"></a>02297     <span class="keywordflow">case</span> CAP_CUSTOMDSDATA:
<a name="l02298"></a>02298       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_CUSTOMDSDATA"</span>;
<a name="l02299"></a>02299       <span class="keywordflow">break</span>;
<a name="l02300"></a>02300 
<a name="l02301"></a>02301     <span class="keywordflow">case</span> CAP_ENDORSER:
<a name="l02302"></a>02302       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_ENDORSER"</span>;
<a name="l02303"></a>02303       <span class="keywordflow">break</span>;
<a name="l02304"></a>02304 
<a name="l02305"></a>02305     <span class="keywordflow">case</span> CAP_JOBCONTROL:
<a name="l02306"></a>02306       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_JOBCONTROL"</span>;
<a name="l02307"></a>02307       <span class="keywordflow">break</span>;
<a name="l02308"></a>02308 
<a name="l02309"></a>02309     <span class="keywordflow">case</span> CAP_ALARMS:
<a name="l02310"></a>02310       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_ALARMS"</span>;
<a name="l02311"></a>02311       <span class="keywordflow">break</span>;
<a name="l02312"></a>02312 
<a name="l02313"></a>02313     <span class="keywordflow">case</span> CAP_ALARMVOLUME:
<a name="l02314"></a>02314       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_ALARMVOLUME"</span>;
<a name="l02315"></a>02315       <span class="keywordflow">break</span>;
<a name="l02316"></a>02316 
<a name="l02317"></a>02317     <span class="keywordflow">case</span> CAP_AUTOMATICCAPTURE:
<a name="l02318"></a>02318       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_AUTOMATICCAPTURE"</span>;
<a name="l02319"></a>02319       <span class="keywordflow">break</span>;
<a name="l02320"></a>02320 
<a name="l02321"></a>02321     <span class="keywordflow">case</span> CAP_TIMEBEFOREFIRSTCAPTURE:
<a name="l02322"></a>02322       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_TIMEBEFOREFIRSTCAPTURE"</span>;
<a name="l02323"></a>02323       <span class="keywordflow">break</span>;
<a name="l02324"></a>02324 
<a name="l02325"></a>02325     <span class="keywordflow">case</span> CAP_TIMEBETWEENCAPTURES:
<a name="l02326"></a>02326       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_TIMEBETWEENCAPTURES"</span>;
<a name="l02327"></a>02327       <span class="keywordflow">break</span>;
<a name="l02328"></a>02328 
<a name="l02329"></a>02329     <span class="keywordflow">case</span> CAP_CLEARBUFFERS:
<a name="l02330"></a>02330       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_CLEARBUFFERS"</span>;
<a name="l02331"></a>02331       <span class="keywordflow">break</span>;
<a name="l02332"></a>02332 
<a name="l02333"></a>02333     <span class="keywordflow">case</span> CAP_MAXBATCHBUFFERS:
<a name="l02334"></a>02334       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_MAXBATCHBUFFERS"</span>;
<a name="l02335"></a>02335       <span class="keywordflow">break</span>;
<a name="l02336"></a>02336 
<a name="l02337"></a>02337     <span class="keywordflow">case</span> CAP_DEVICETIMEDATE:
<a name="l02338"></a>02338       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_DEVICETIMEDATE"</span>;
<a name="l02339"></a>02339       <span class="keywordflow">break</span>;
<a name="l02340"></a>02340 
<a name="l02341"></a>02341     <span class="keywordflow">case</span> CAP_POWERSUPPLY:
<a name="l02342"></a>02342       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_POWERSUPPLY"</span>;
<a name="l02343"></a>02343       <span class="keywordflow">break</span>;
<a name="l02344"></a>02344 
<a name="l02345"></a>02345     <span class="keywordflow">case</span> CAP_CAMERAPREVIEWUI:
<a name="l02346"></a>02346       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_CAMERAPREVIEWUI"</span>;
<a name="l02347"></a>02347       <span class="keywordflow">break</span>;
<a name="l02348"></a>02348 
<a name="l02349"></a>02349     <span class="keywordflow">case</span> CAP_DEVICEEVENT:
<a name="l02350"></a>02350       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_DEVICEEVENT"</span>;
<a name="l02351"></a>02351       <span class="keywordflow">break</span>;
<a name="l02352"></a>02352 
<a name="l02353"></a>02353     <span class="keywordflow">case</span> CAP_SERIALNUMBER:
<a name="l02354"></a>02354       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_SERIALNUMBER"</span>;
<a name="l02355"></a>02355       <span class="keywordflow">break</span>;
<a name="l02356"></a>02356 
<a name="l02357"></a>02357     <span class="keywordflow">case</span> CAP_PRINTER:
<a name="l02358"></a>02358       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_PRINTER"</span>;
<a name="l02359"></a>02359       <span class="keywordflow">break</span>;
<a name="l02360"></a>02360 
<a name="l02361"></a>02361     <span class="keywordflow">case</span> CAP_PRINTERENABLED:
<a name="l02362"></a>02362       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_PRINTERENABLED"</span>;
<a name="l02363"></a>02363       <span class="keywordflow">break</span>;
<a name="l02364"></a>02364 
<a name="l02365"></a>02365     <span class="keywordflow">case</span> CAP_PRINTERINDEX:
<a name="l02366"></a>02366       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_PRINTERINDEX"</span>;
<a name="l02367"></a>02367       <span class="keywordflow">break</span>;
<a name="l02368"></a>02368 
<a name="l02369"></a>02369     <span class="keywordflow">case</span> CAP_PRINTERMODE:
<a name="l02370"></a>02370       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_PRINTERMODE"</span>;
<a name="l02371"></a>02371       <span class="keywordflow">break</span>;
<a name="l02372"></a>02372 
<a name="l02373"></a>02373     <span class="keywordflow">case</span> CAP_PRINTERSTRING:
<a name="l02374"></a>02374       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_PRINTERSTRING"</span>;
<a name="l02375"></a>02375       <span class="keywordflow">break</span>;
<a name="l02376"></a>02376 
<a name="l02377"></a>02377     <span class="keywordflow">case</span> CAP_PRINTERSUFFIX:
<a name="l02378"></a>02378       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_PRINTERSUFFIX"</span>;
<a name="l02379"></a>02379       <span class="keywordflow">break</span>;
<a name="l02380"></a>02380 
<a name="l02381"></a>02381     <span class="keywordflow">case</span> CAP_LANGUAGE:
<a name="l02382"></a>02382       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_LANGUAGE"</span>;
<a name="l02383"></a>02383       <span class="keywordflow">break</span>;
<a name="l02384"></a>02384 
<a name="l02385"></a>02385     <span class="keywordflow">case</span> CAP_FEEDERALIGNMENT:
<a name="l02386"></a>02386       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_FEEDERALIGNMENT"</span>;
<a name="l02387"></a>02387       <span class="keywordflow">break</span>;
<a name="l02388"></a>02388 
<a name="l02389"></a>02389     <span class="keywordflow">case</span> CAP_FEEDERORDER:
<a name="l02390"></a>02390       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_FEEDERORDER"</span>;
<a name="l02391"></a>02391       <span class="keywordflow">break</span>;
<a name="l02392"></a>02392 
<a name="l02393"></a>02393     <span class="keywordflow">case</span> CAP_REACQUIREALLOWED:
<a name="l02394"></a>02394       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_REACQUIREALLOWED"</span>;
<a name="l02395"></a>02395       <span class="keywordflow">break</span>;
<a name="l02396"></a>02396 
<a name="l02397"></a>02397     <span class="keywordflow">case</span> CAP_BATTERYMINUTES:
<a name="l02398"></a>02398       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_BATTERYMINUTES"</span>;
<a name="l02399"></a>02399       <span class="keywordflow">break</span>;
<a name="l02400"></a>02400 
<a name="l02401"></a>02401     <span class="keywordflow">case</span> CAP_BATTERYPERCENTAGE:
<a name="l02402"></a>02402       <span class="keywordflow">return</span> <span class="stringliteral">"CAP_BATTERYPERCENTAGE"</span>;
<a name="l02403"></a>02403       <span class="keywordflow">break</span>;
<a name="l02404"></a>02404 
<a name="l02405"></a>02405     <span class="keywordflow">case</span> ICAP_AUTOBRIGHT:
<a name="l02406"></a>02406       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_AUTOBRIGHT"</span>;
<a name="l02407"></a>02407       <span class="keywordflow">break</span>;
<a name="l02408"></a>02408 
<a name="l02409"></a>02409     <span class="keywordflow">case</span> ICAP_BRIGHTNESS:
<a name="l02410"></a>02410       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_BRIGHTNESS"</span>;
<a name="l02411"></a>02411       <span class="keywordflow">break</span>;
<a name="l02412"></a>02412 
<a name="l02413"></a>02413     <span class="keywordflow">case</span> ICAP_CONTRAST:
<a name="l02414"></a>02414       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_CONTRAST"</span>;
<a name="l02415"></a>02415       <span class="keywordflow">break</span>;
<a name="l02416"></a>02416 
<a name="l02417"></a>02417     <span class="keywordflow">case</span> ICAP_CUSTHALFTONE:
<a name="l02418"></a>02418       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_CUSTHALFTONE"</span>;
<a name="l02419"></a>02419       <span class="keywordflow">break</span>;
<a name="l02420"></a>02420 
<a name="l02421"></a>02421     <span class="keywordflow">case</span> ICAP_EXPOSURETIME:
<a name="l02422"></a>02422       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_EXPOSURETIME"</span>;
<a name="l02423"></a>02423       <span class="keywordflow">break</span>;
<a name="l02424"></a>02424 
<a name="l02425"></a>02425     <span class="keywordflow">case</span> ICAP_FILTER:
<a name="l02426"></a>02426       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_FILTER"</span>;
<a name="l02427"></a>02427       <span class="keywordflow">break</span>;
<a name="l02428"></a>02428 
<a name="l02429"></a>02429     <span class="keywordflow">case</span> ICAP_FLASHUSED:
<a name="l02430"></a>02430       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_FLASHUSED"</span>;
<a name="l02431"></a>02431       <span class="keywordflow">break</span>;
<a name="l02432"></a>02432 
<a name="l02433"></a>02433     <span class="keywordflow">case</span> ICAP_GAMMA:
<a name="l02434"></a>02434       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_GAMMA"</span>;
<a name="l02435"></a>02435       <span class="keywordflow">break</span>;
<a name="l02436"></a>02436 
<a name="l02437"></a>02437     <span class="keywordflow">case</span> ICAP_HALFTONES:
<a name="l02438"></a>02438       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_HALFTONES"</span>;
<a name="l02439"></a>02439       <span class="keywordflow">break</span>;
<a name="l02440"></a>02440 
<a name="l02441"></a>02441     <span class="keywordflow">case</span> ICAP_HIGHLIGHT:
<a name="l02442"></a>02442       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_HIGHLIGHT"</span>;
<a name="l02443"></a>02443       <span class="keywordflow">break</span>;
<a name="l02444"></a>02444 
<a name="l02445"></a>02445     <span class="keywordflow">case</span> ICAP_IMAGEFILEFORMAT:
<a name="l02446"></a>02446       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_IMAGEFILEFORMAT"</span>;
<a name="l02447"></a>02447       <span class="keywordflow">break</span>;
<a name="l02448"></a>02448 
<a name="l02449"></a>02449     <span class="keywordflow">case</span> ICAP_LAMPSTATE:
<a name="l02450"></a>02450       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_LAMPSTATE"</span>;
<a name="l02451"></a>02451       <span class="keywordflow">break</span>;
<a name="l02452"></a>02452 
<a name="l02453"></a>02453     <span class="keywordflow">case</span> ICAP_LIGHTSOURCE:
<a name="l02454"></a>02454       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_LIGHTSOURCE"</span>;
<a name="l02455"></a>02455       <span class="keywordflow">break</span>;
<a name="l02456"></a>02456 
<a name="l02457"></a>02457     <span class="keywordflow">case</span> ICAP_ORIENTATION:
<a name="l02458"></a>02458       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_ORIENTATION"</span>;
<a name="l02459"></a>02459       <span class="keywordflow">break</span>;
<a name="l02460"></a>02460 
<a name="l02461"></a>02461     <span class="keywordflow">case</span> ICAP_PHYSICALWIDTH:
<a name="l02462"></a>02462       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_PHYSICALWIDTH"</span>;
<a name="l02463"></a>02463       <span class="keywordflow">break</span>;
<a name="l02464"></a>02464 
<a name="l02465"></a>02465     <span class="keywordflow">case</span> ICAP_PHYSICALHEIGHT:
<a name="l02466"></a>02466       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_PHYSICALHEIGHT"</span>;
<a name="l02467"></a>02467       <span class="keywordflow">break</span>;
<a name="l02468"></a>02468 
<a name="l02469"></a>02469     <span class="keywordflow">case</span> ICAP_SHADOW:
<a name="l02470"></a>02470       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_SHADOW"</span>;
<a name="l02471"></a>02471       <span class="keywordflow">break</span>;
<a name="l02472"></a>02472 
<a name="l02473"></a>02473     <span class="keywordflow">case</span> ICAP_FRAMES:
<a name="l02474"></a>02474       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_FRAMES"</span>;
<a name="l02475"></a>02475       <span class="keywordflow">break</span>;
<a name="l02476"></a>02476 
<a name="l02477"></a>02477     <span class="keywordflow">case</span> ICAP_XNATIVERESOLUTION:
<a name="l02478"></a>02478       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_XNATIVERESOLUTION"</span>;
<a name="l02479"></a>02479       <span class="keywordflow">break</span>;
<a name="l02480"></a>02480 
<a name="l02481"></a>02481     <span class="keywordflow">case</span> ICAP_YNATIVERESOLUTION:
<a name="l02482"></a>02482       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_YNATIVERESOLUTION"</span>;
<a name="l02483"></a>02483       <span class="keywordflow">break</span>;
<a name="l02484"></a>02484 
<a name="l02485"></a>02485     <span class="keywordflow">case</span> ICAP_XRESOLUTION:
<a name="l02486"></a>02486       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_XRESOLUTION"</span>;
<a name="l02487"></a>02487       <span class="keywordflow">break</span>;
<a name="l02488"></a>02488 
<a name="l02489"></a>02489     <span class="keywordflow">case</span> ICAP_YRESOLUTION:
<a name="l02490"></a>02490       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_YRESOLUTION"</span>;
<a name="l02491"></a>02491       <span class="keywordflow">break</span>;
<a name="l02492"></a>02492 
<a name="l02493"></a>02493     <span class="keywordflow">case</span> ICAP_MAXFRAMES:
<a name="l02494"></a>02494       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_MAXFRAMES"</span>;
<a name="l02495"></a>02495       <span class="keywordflow">break</span>;
<a name="l02496"></a>02496 
<a name="l02497"></a>02497     <span class="keywordflow">case</span> ICAP_TILES:
<a name="l02498"></a>02498       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_TILES"</span>;
<a name="l02499"></a>02499       <span class="keywordflow">break</span>;
<a name="l02500"></a>02500 
<a name="l02501"></a>02501     <span class="keywordflow">case</span> ICAP_BITORDER:
<a name="l02502"></a>02502       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_BITORDER"</span>;
<a name="l02503"></a>02503       <span class="keywordflow">break</span>;
<a name="l02504"></a>02504 
<a name="l02505"></a>02505     <span class="keywordflow">case</span> ICAP_CCITTKFACTOR:
<a name="l02506"></a>02506       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_CCITTKFACTOR"</span>;
<a name="l02507"></a>02507       <span class="keywordflow">break</span>;
<a name="l02508"></a>02508 
<a name="l02509"></a>02509     <span class="keywordflow">case</span> ICAP_LIGHTPATH:
<a name="l02510"></a>02510       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_LIGHTPATH"</span>;
<a name="l02511"></a>02511       <span class="keywordflow">break</span>;
<a name="l02512"></a>02512 
<a name="l02513"></a>02513     <span class="keywordflow">case</span> ICAP_PIXELFLAVOR:
<a name="l02514"></a>02514       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_PIXELFLAVOR"</span>;
<a name="l02515"></a>02515       <span class="keywordflow">break</span>;
<a name="l02516"></a>02516 
<a name="l02517"></a>02517     <span class="keywordflow">case</span> ICAP_PLANARCHUNKY:
<a name="l02518"></a>02518       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_PLANARCHUNKY"</span>;
<a name="l02519"></a>02519       <span class="keywordflow">break</span>;
<a name="l02520"></a>02520 
<a name="l02521"></a>02521     <span class="keywordflow">case</span> ICAP_ROTATION:
<a name="l02522"></a>02522       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_ROTATION"</span>;
<a name="l02523"></a>02523       <span class="keywordflow">break</span>;
<a name="l02524"></a>02524 
<a name="l02525"></a>02525     <span class="keywordflow">case</span> ICAP_SUPPORTEDSIZES:
<a name="l02526"></a>02526       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_SUPPORTEDSIZES"</span>;
<a name="l02527"></a>02527       <span class="keywordflow">break</span>;
<a name="l02528"></a>02528 
<a name="l02529"></a>02529     <span class="keywordflow">case</span> ICAP_THRESHOLD:
<a name="l02530"></a>02530       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_THRESHOLD"</span>;
<a name="l02531"></a>02531       <span class="keywordflow">break</span>;
<a name="l02532"></a>02532 
<a name="l02533"></a>02533     <span class="keywordflow">case</span> ICAP_XSCALING:
<a name="l02534"></a>02534       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_XSCALING"</span>;
<a name="l02535"></a>02535       <span class="keywordflow">break</span>;
<a name="l02536"></a>02536 
<a name="l02537"></a>02537     <span class="keywordflow">case</span> ICAP_YSCALING:
<a name="l02538"></a>02538       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_YSCALING"</span>;
<a name="l02539"></a>02539       <span class="keywordflow">break</span>;
<a name="l02540"></a>02540 
<a name="l02541"></a>02541     <span class="keywordflow">case</span> ICAP_BITORDERCODES:
<a name="l02542"></a>02542       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_BITORDERCODES"</span>;
<a name="l02543"></a>02543       <span class="keywordflow">break</span>;
<a name="l02544"></a>02544 
<a name="l02545"></a>02545     <span class="keywordflow">case</span> ICAP_PIXELFLAVORCODES:
<a name="l02546"></a>02546       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_PIXELFLAVORCODES"</span>;
<a name="l02547"></a>02547       <span class="keywordflow">break</span>;
<a name="l02548"></a>02548 
<a name="l02549"></a>02549     <span class="keywordflow">case</span> ICAP_JPEGPIXELTYPE:
<a name="l02550"></a>02550       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_JPEGPIXELTYPE"</span>;
<a name="l02551"></a>02551       <span class="keywordflow">break</span>;
<a name="l02552"></a>02552 
<a name="l02553"></a>02553     <span class="keywordflow">case</span> ICAP_TIMEFILL:
<a name="l02554"></a>02554       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_TIMEFILL"</span>;
<a name="l02555"></a>02555       <span class="keywordflow">break</span>;
<a name="l02556"></a>02556 
<a name="l02557"></a>02557     <span class="keywordflow">case</span> ICAP_BITDEPTH:
<a name="l02558"></a>02558       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_BITDEPTH"</span>;
<a name="l02559"></a>02559       <span class="keywordflow">break</span>;
<a name="l02560"></a>02560 
<a name="l02561"></a>02561     <span class="keywordflow">case</span> ICAP_BITDEPTHREDUCTION:
<a name="l02562"></a>02562       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_BITDEPTHREDUCTION"</span>;
<a name="l02563"></a>02563       <span class="keywordflow">break</span>;
<a name="l02564"></a>02564 
<a name="l02565"></a>02565     <span class="keywordflow">case</span> ICAP_UNDEFINEDIMAGESIZE:
<a name="l02566"></a>02566       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_UNDEFINEDIMAGESIZE"</span>;
<a name="l02567"></a>02567       <span class="keywordflow">break</span>;
<a name="l02568"></a>02568 
<a name="l02569"></a>02569     <span class="keywordflow">case</span> ICAP_IMAGEDATASET:
<a name="l02570"></a>02570       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_IMAGEDATASET"</span>;
<a name="l02571"></a>02571       <span class="keywordflow">break</span>;
<a name="l02572"></a>02572 
<a name="l02573"></a>02573     <span class="keywordflow">case</span> ICAP_EXTIMAGEINFO:
<a name="l02574"></a>02574       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_EXTIMAGEINFO"</span>;
<a name="l02575"></a>02575       <span class="keywordflow">break</span>;
<a name="l02576"></a>02576 
<a name="l02577"></a>02577     <span class="keywordflow">case</span> ICAP_MINIMUMHEIGHT:
<a name="l02578"></a>02578       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_MINIMUMHEIGHT"</span>;
<a name="l02579"></a>02579       <span class="keywordflow">break</span>;
<a name="l02580"></a>02580 
<a name="l02581"></a>02581     <span class="keywordflow">case</span> ICAP_MINIMUMWIDTH:
<a name="l02582"></a>02582       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_MINIMUMWIDTH"</span>;
<a name="l02583"></a>02583       <span class="keywordflow">break</span>;
<a name="l02584"></a>02584 
<a name="l02585"></a>02585     <span class="keywordflow">case</span> ICAP_FLIPROTATION:
<a name="l02586"></a>02586       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_FLIPROTATION"</span>;
<a name="l02587"></a>02587       <span class="keywordflow">break</span>;
<a name="l02588"></a>02588 
<a name="l02589"></a>02589     <span class="keywordflow">case</span> ICAP_BARCODEDETECTIONENABLED:
<a name="l02590"></a>02590       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_BARCODEDETECTIONENABLED"</span>;
<a name="l02591"></a>02591       <span class="keywordflow">break</span>;
<a name="l02592"></a>02592 
<a name="l02593"></a>02593     <span class="keywordflow">case</span> ICAP_SUPPORTEDBARCODETYPES:
<a name="l02594"></a>02594       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_SUPPORTEDBARCODETYPES"</span>;
<a name="l02595"></a>02595       <span class="keywordflow">break</span>;
<a name="l02596"></a>02596 
<a name="l02597"></a>02597     <span class="keywordflow">case</span> ICAP_BARCODEMAXSEARCHPRIORITIES:
<a name="l02598"></a>02598       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_BARCODEMAXSEARCHPRIORITIES"</span>;
<a name="l02599"></a>02599       <span class="keywordflow">break</span>;
<a name="l02600"></a>02600 
<a name="l02601"></a>02601     <span class="keywordflow">case</span> ICAP_BARCODESEARCHPRIORITIES:
<a name="l02602"></a>02602       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_BARCODESEARCHPRIORITIES"</span>;
<a name="l02603"></a>02603       <span class="keywordflow">break</span>;
<a name="l02604"></a>02604 
<a name="l02605"></a>02605     <span class="keywordflow">case</span> ICAP_BARCODESEARCHMODE:
<a name="l02606"></a>02606       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_BARCODESEARCHMODE"</span>;
<a name="l02607"></a>02607       <span class="keywordflow">break</span>;
<a name="l02608"></a>02608 
<a name="l02609"></a>02609     <span class="keywordflow">case</span> ICAP_BARCODEMAXRETRIES:
<a name="l02610"></a>02610       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_BARCODEMAXRETRIES"</span>;
<a name="l02611"></a>02611       <span class="keywordflow">break</span>;
<a name="l02612"></a>02612 
<a name="l02613"></a>02613     <span class="keywordflow">case</span> ICAP_BARCODETIMEOUT:
<a name="l02614"></a>02614       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_BARCODETIMEOUT"</span>;
<a name="l02615"></a>02615       <span class="keywordflow">break</span>;
<a name="l02616"></a>02616 
<a name="l02617"></a>02617     <span class="keywordflow">case</span> ICAP_ZOOMFACTOR:
<a name="l02618"></a>02618       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_ZOOMFACTOR"</span>;
<a name="l02619"></a>02619       <span class="keywordflow">break</span>;
<a name="l02620"></a>02620 
<a name="l02621"></a>02621     <span class="keywordflow">case</span> ICAP_PATCHCODEDETECTIONENABLED:
<a name="l02622"></a>02622       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_PATCHCODEDETECTIONENABLED"</span>;
<a name="l02623"></a>02623       <span class="keywordflow">break</span>;
<a name="l02624"></a>02624 
<a name="l02625"></a>02625     <span class="keywordflow">case</span> ICAP_SUPPORTEDPATCHCODETYPES:
<a name="l02626"></a>02626       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_SUPPORTEDPATCHCODETYPES"</span>;
<a name="l02627"></a>02627       <span class="keywordflow">break</span>;
<a name="l02628"></a>02628 
<a name="l02629"></a>02629     <span class="keywordflow">case</span> ICAP_PATCHCODEMAXSEARCHPRIORITIES:
<a name="l02630"></a>02630       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_PATCHCODEMAXSEARCHPRIORITIES"</span>;
<a name="l02631"></a>02631       <span class="keywordflow">break</span>;
<a name="l02632"></a>02632 
<a name="l02633"></a>02633     <span class="keywordflow">case</span> ICAP_PATCHCODESEARCHPRIORITIES:
<a name="l02634"></a>02634       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_PATCHCODESEARCHPRIORITIES"</span>;
<a name="l02635"></a>02635       <span class="keywordflow">break</span>;
<a name="l02636"></a>02636 
<a name="l02637"></a>02637     <span class="keywordflow">case</span> ICAP_PATCHCODESEARCHMODE:
<a name="l02638"></a>02638       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_PATCHCODESEARCHMODE"</span>;
<a name="l02639"></a>02639       <span class="keywordflow">break</span>;
<a name="l02640"></a>02640 
<a name="l02641"></a>02641     <span class="keywordflow">case</span> ICAP_PATCHCODEMAXRETRIES:
<a name="l02642"></a>02642       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_PATCHCODEMAXRETRIES"</span>;
<a name="l02643"></a>02643       <span class="keywordflow">break</span>;
<a name="l02644"></a>02644 
<a name="l02645"></a>02645     <span class="keywordflow">case</span> ICAP_PATCHCODETIMEOUT:
<a name="l02646"></a>02646       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_PATCHCODETIMEOUT"</span>;
<a name="l02647"></a>02647       <span class="keywordflow">break</span>;
<a name="l02648"></a>02648 
<a name="l02649"></a>02649     <span class="keywordflow">case</span> ICAP_FLASHUSED2:
<a name="l02650"></a>02650       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_FLASHUSED2"</span>;
<a name="l02651"></a>02651       <span class="keywordflow">break</span>;
<a name="l02652"></a>02652 
<a name="l02653"></a>02653     <span class="keywordflow">case</span> ICAP_IMAGEFILTER:
<a name="l02654"></a>02654       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_IMAGEFILTER"</span>;
<a name="l02655"></a>02655       <span class="keywordflow">break</span>;
<a name="l02656"></a>02656 
<a name="l02657"></a>02657     <span class="keywordflow">case</span> ICAP_NOISEFILTER:
<a name="l02658"></a>02658       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_NOISEFILTER"</span>;
<a name="l02659"></a>02659       <span class="keywordflow">break</span>;
<a name="l02660"></a>02660 
<a name="l02661"></a>02661     <span class="keywordflow">case</span> ICAP_OVERSCAN:
<a name="l02662"></a>02662       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_OVERSCAN"</span>;
<a name="l02663"></a>02663       <span class="keywordflow">break</span>;
<a name="l02664"></a>02664 
<a name="l02665"></a>02665     <span class="keywordflow">case</span> ICAP_AUTOMATICBORDERDETECTION:
<a name="l02666"></a>02666       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_AUTOMATICBORDERDETECTION"</span>;
<a name="l02667"></a>02667       <span class="keywordflow">break</span>;
<a name="l02668"></a>02668 
<a name="l02669"></a>02669     <span class="keywordflow">case</span> ICAP_AUTOMATICDESKEW:
<a name="l02670"></a>02670       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_AUTOMATICDESKEW"</span>;
<a name="l02671"></a>02671       <span class="keywordflow">break</span>;
<a name="l02672"></a>02672 
<a name="l02673"></a>02673     <span class="keywordflow">case</span> ICAP_AUTOMATICROTATE:
<a name="l02674"></a>02674       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_AUTOMATICROTATE"</span>;
<a name="l02675"></a>02675       <span class="keywordflow">break</span>;
<a name="l02676"></a>02676 
<a name="l02677"></a>02677     <span class="keywordflow">case</span> ICAP_JPEGQUALITY:
<a name="l02678"></a>02678       <span class="keywordflow">return</span> <span class="stringliteral">"ICAP_JPEGQUALITY"</span>;
<a name="l02679"></a>02679       <span class="keywordflow">break</span>;
<a name="l02680"></a>02680 
<a name="l02681"></a>02681     <span class="keywordflow">case</span> ACAP_AUDIOFILEFORMAT:
<a name="l02682"></a>02682       <span class="keywordflow">return</span> <span class="stringliteral">"ACAP_AUDIOFILEFORMAT"</span>;
<a name="l02683"></a>02683       <span class="keywordflow">break</span>;
<a name="l02684"></a>02684 
<a name="l02685"></a>02685     <span class="keywordflow">case</span> ACAP_XFERMECH:
<a name="l02686"></a>02686       <span class="keywordflow">return</span> <span class="stringliteral">"ACAP_XFERMECH"</span>;
<a name="l02687"></a>02687       <span class="keywordflow">break</span>;
<a name="l02688"></a>02688   }
<a name="l02689"></a>02689 
<a name="l02690"></a>02690   TW_STR32 hex;
<a name="l02691"></a>02691   <a class="code" href="dsm_8h.html#770571e12ff9370899184528f4b4626d">SNPRINTF</a>(hex, 32, <span class="stringliteral">"CAP 0x%04x"</span>, _Cap);
<a name="l02692"></a>02692 
<a name="l02693"></a>02693   <span class="keywordflow">return</span> hex;
<a name="l02694"></a>02694 }
<a name="l02695"></a>02695 
<a name="l02696"></a><a class="code" href="dsm_8cpp.html#84fe3ba26a0fc001597b1ae82769de97">02696</a> string <a class="code" href="dsm_8cpp.html#84fe3ba26a0fc001597b1ae82769de97">StringFromRC</a>(<span class="keyword">const</span> TW_UINT16 rc)
<a name="l02697"></a>02697 {
<a name="l02698"></a>02698   <span class="keywordflow">switch</span>(rc)
<a name="l02699"></a>02699   {
<a name="l02700"></a>02700     <span class="keywordflow">case</span> TWRC_SUCCESS:
<a name="l02701"></a>02701       <span class="keywordflow">return</span> <span class="stringliteral">"TWRC_SUCCESS"</span>;
<a name="l02702"></a>02702       <span class="keywordflow">break</span>;
<a name="l02703"></a>02703 
<a name="l02704"></a>02704     <span class="keywordflow">case</span> TWRC_FAILURE:
<a name="l02705"></a>02705       <span class="keywordflow">return</span> <span class="stringliteral">"TWRC_FAILURE"</span>;
<a name="l02706"></a>02706       <span class="keywordflow">break</span>;
<a name="l02707"></a>02707 
<a name="l02708"></a>02708     <span class="keywordflow">case</span> TWRC_CHECKSTATUS:
<a name="l02709"></a>02709       <span class="keywordflow">return</span> <span class="stringliteral">"TWRC_CHECKSTATUS"</span>;
<a name="l02710"></a>02710       <span class="keywordflow">break</span>;
<a name="l02711"></a>02711 
<a name="l02712"></a>02712     <span class="keywordflow">case</span> TWRC_CANCEL:
<a name="l02713"></a>02713       <span class="keywordflow">return</span> <span class="stringliteral">"TWRC_CANCEL"</span>;
<a name="l02714"></a>02714       <span class="keywordflow">break</span>;
<a name="l02715"></a>02715 
<a name="l02716"></a>02716     <span class="keywordflow">case</span> TWRC_DSEVENT:
<a name="l02717"></a>02717       <span class="keywordflow">return</span> <span class="stringliteral">"TWRC_DSEVENT"</span>;
<a name="l02718"></a>02718       <span class="keywordflow">break</span>;
<a name="l02719"></a>02719 
<a name="l02720"></a>02720     <span class="keywordflow">case</span> TWRC_NOTDSEVENT:
<a name="l02721"></a>02721       <span class="keywordflow">return</span> <span class="stringliteral">"TWRC_NOTDSEVENT"</span>;
<a name="l02722"></a>02722       <span class="keywordflow">break</span>;
<a name="l02723"></a>02723 
<a name="l02724"></a>02724     <span class="keywordflow">case</span> TWRC_XFERDONE:
<a name="l02725"></a>02725       <span class="keywordflow">return</span> <span class="stringliteral">"TWRC_XFERDONE"</span>;
<a name="l02726"></a>02726       <span class="keywordflow">break</span>;
<a name="l02727"></a>02727 
<a name="l02728"></a>02728     <span class="keywordflow">case</span> TWRC_ENDOFLIST:
<a name="l02729"></a>02729       <span class="keywordflow">return</span> <span class="stringliteral">"TWRC_ENDOFLIST"</span>;
<a name="l02730"></a>02730       <span class="keywordflow">break</span>;
<a name="l02731"></a>02731 
<a name="l02732"></a>02732     <span class="keywordflow">case</span> TWRC_INFONOTSUPPORTED:
<a name="l02733"></a>02733       <span class="keywordflow">return</span> <span class="stringliteral">"TWRC_INFONOTSUPPORTED"</span>;
<a name="l02734"></a>02734       <span class="keywordflow">break</span>;
<a name="l02735"></a>02735 
<a name="l02736"></a>02736     <span class="keywordflow">case</span> TWRC_DATANOTAVAILABLE:
<a name="l02737"></a>02737       <span class="keywordflow">return</span> <span class="stringliteral">"TWRC_DATANOTAVAILABLE"</span>;
<a name="l02738"></a>02738       <span class="keywordflow">break</span>;
<a name="l02739"></a>02739   }
<a name="l02740"></a>02740 
<a name="l02741"></a>02741   TW_STR32 hex;
<a name="l02742"></a>02742   <a class="code" href="dsm_8h.html#770571e12ff9370899184528f4b4626d">SNPRINTF</a>(hex, 32, <span class="stringliteral">"TWRC 0x%04x"</span>, rc);
<a name="l02743"></a>02743 
<a name="l02744"></a>02744   <span class="keywordflow">return</span> hex;
<a name="l02745"></a>02745 }
<a name="l02746"></a>02746 
<a name="l02747"></a><a class="code" href="dsm_8cpp.html#893e676872a5110b8ecbff84fa6e99a2">02747</a> string <a class="code" href="dsm_8cpp.html#893e676872a5110b8ecbff84fa6e99a2">StringFromCC</a>(<span class="keyword">const</span> TW_UINT16 cc)
<a name="l02748"></a>02748 {
<a name="l02749"></a>02749   <span class="keywordflow">switch</span>(cc)
<a name="l02750"></a>02750   {
<a name="l02751"></a>02751     <span class="keywordflow">case</span> TWCC_SUCCESS:
<a name="l02752"></a>02752       <span class="keywordflow">return</span> <span class="stringliteral">"TWRC_SUCCESS"</span>;
<a name="l02753"></a>02753       <span class="keywordflow">break</span>;
<a name="l02754"></a>02754 
<a name="l02755"></a>02755     <span class="keywordflow">case</span> TWCC_BUMMER:
<a name="l02756"></a>02756       <span class="keywordflow">return</span> <span class="stringliteral">"Failure due to unknown causes"</span>;
<a name="l02757"></a>02757       <span class="keywordflow">break</span>;
<a name="l02758"></a>02758 
<a name="l02759"></a>02759     <span class="keywordflow">case</span> TWCC_LOWMEMORY:
<a name="l02760"></a>02760       <span class="keywordflow">return</span> <span class="stringliteral">"Not enough memory to perform operation"</span>;
<a name="l02761"></a>02761       <span class="keywordflow">break</span>;
<a name="l02762"></a>02762 
<a name="l02763"></a>02763     <span class="keywordflow">case</span> TWCC_NODS:
<a name="l02764"></a>02764       <span class="keywordflow">return</span> <span class="stringliteral">"No Data Source"</span>;
<a name="l02765"></a>02765       <span class="keywordflow">break</span>;
<a name="l02766"></a>02766 
<a name="l02767"></a>02767     <span class="keywordflow">case</span> TWCC_MAXCONNECTIONS:
<a name="l02768"></a>02768       <span class="keywordflow">return</span> <span class="stringliteral">"DS is connected to max possible applications"</span>;
<a name="l02769"></a>02769       <span class="keywordflow">break</span>;
<a name="l02770"></a>02770 
<a name="l02771"></a>02771     <span class="keywordflow">case</span> TWCC_OPERATIONERROR:
<a name="l02772"></a>02772       <span class="keywordflow">return</span> <span class="stringliteral">"DS or DSM reported error, application shouldn't"</span>;
<a name="l02773"></a>02773       <span class="keywordflow">break</span>;
<a name="l02774"></a>02774 
<a name="l02775"></a>02775     <span class="keywordflow">case</span> TWCC_BADCAP:
<a name="l02776"></a>02776       <span class="keywordflow">return</span> <span class="stringliteral">"Unknown capability"</span>;
<a name="l02777"></a>02777       <span class="keywordflow">break</span>;
<a name="l02778"></a>02778 
<a name="l02779"></a>02779     <span class="keywordflow">case</span> TWCC_BADPROTOCOL:
<a name="l02780"></a>02780       <span class="keywordflow">return</span> <span class="stringliteral">"Unrecognized MSG DG DAT combination"</span>;
<a name="l02781"></a>02781       <span class="keywordflow">break</span>;
<a name="l02782"></a>02782 
<a name="l02783"></a>02783     <span class="keywordflow">case</span> TWCC_BADVALUE:
<a name="l02784"></a>02784       <span class="keywordflow">return</span> <span class="stringliteral">"Data parameter out of range"</span>;
<a name="l02785"></a>02785       <span class="keywordflow">break</span>;
<a name="l02786"></a>02786 
<a name="l02787"></a>02787     <span class="keywordflow">case</span> TWCC_SEQERROR:
<a name="l02788"></a>02788       <span class="keywordflow">return</span> <span class="stringliteral">"DG DAT MSG out of expected sequence"</span>;
<a name="l02789"></a>02789       <span class="keywordflow">break</span>;
<a name="l02790"></a>02790 
<a name="l02791"></a>02791     <span class="keywordflow">case</span> TWCC_BADDEST:
<a name="l02792"></a>02792       <span class="keywordflow">return</span> <span class="stringliteral">"Unknown destination Application/Source in DSM_Entry"</span>;
<a name="l02793"></a>02793       <span class="keywordflow">break</span>;
<a name="l02794"></a>02794 
<a name="l02795"></a>02795     <span class="keywordflow">case</span> TWCC_CAPUNSUPPORTED:
<a name="l02796"></a>02796       <span class="keywordflow">return</span> <span class="stringliteral">"Capability not supported by source"</span>;
<a name="l02797"></a>02797       <span class="keywordflow">break</span>;
<a name="l02798"></a>02798 
<a name="l02799"></a>02799     <span class="keywordflow">case</span> TWCC_CAPBADOPERATION:
<a name="l02800"></a>02800       <span class="keywordflow">return</span> <span class="stringliteral">"Operation not supported by capability"</span>;
<a name="l02801"></a>02801       <span class="keywordflow">break</span>;
<a name="l02802"></a>02802 
<a name="l02803"></a>02803     <span class="keywordflow">case</span> TWCC_CAPSEQERROR:
<a name="l02804"></a>02804       <span class="keywordflow">return</span> <span class="stringliteral">"Capability has dependancy on other capability"</span>;
<a name="l02805"></a>02805       <span class="keywordflow">break</span>;
<a name="l02806"></a>02806 
<a name="l02807"></a>02807     <span class="keywordflow">case</span> TWCC_DENIED:
<a name="l02808"></a>02808       <span class="keywordflow">return</span> <span class="stringliteral">"File System operation is denied (file is protected)"</span>;
<a name="l02809"></a>02809       <span class="keywordflow">break</span>;
<a name="l02810"></a>02810 
<a name="l02811"></a>02811     <span class="keywordflow">case</span> TWCC_FILEEXISTS:
<a name="l02812"></a>02812       <span class="keywordflow">return</span> <span class="stringliteral">"Operation failed because file already exists."</span>;
<a name="l02813"></a>02813       <span class="keywordflow">break</span>;
<a name="l02814"></a>02814 
<a name="l02815"></a>02815     <span class="keywordflow">case</span> TWCC_FILENOTFOUND:
<a name="l02816"></a>02816       <span class="keywordflow">return</span> <span class="stringliteral">"File not found"</span>;
<a name="l02817"></a>02817       <span class="keywordflow">break</span>;
<a name="l02818"></a>02818 
<a name="l02819"></a>02819     <span class="keywordflow">case</span> TWCC_NOTEMPTY:
<a name="l02820"></a>02820       <span class="keywordflow">return</span> <span class="stringliteral">"Operation failed because directory is not empty"</span>;
<a name="l02821"></a>02821       <span class="keywordflow">break</span>;
<a name="l02822"></a>02822 
<a name="l02823"></a>02823     <span class="keywordflow">case</span> TWCC_PAPERJAM:
<a name="l02824"></a>02824       <span class="keywordflow">return</span> <span class="stringliteral">"The feeder is jammed"</span>;
<a name="l02825"></a>02825       <span class="keywordflow">break</span>;
<a name="l02826"></a>02826 
<a name="l02827"></a>02827     <span class="keywordflow">case</span> TWCC_PAPERDOUBLEFEED:
<a name="l02828"></a>02828       <span class="keywordflow">return</span> <span class="stringliteral">"The feeder detected multiple pages"</span>;
<a name="l02829"></a>02829       <span class="keywordflow">break</span>;
<a name="l02830"></a>02830 
<a name="l02831"></a>02831     <span class="keywordflow">case</span> TWCC_FILEWRITEERROR:
<a name="l02832"></a>02832       <span class="keywordflow">return</span> <span class="stringliteral">"Error writing the file (meant for things like disk full conditions)"</span>;
<a name="l02833"></a>02833       <span class="keywordflow">break</span>;
<a name="l02834"></a>02834 
<a name="l02835"></a>02835     <span class="keywordflow">case</span> TWCC_CHECKDEVICEONLINE:
<a name="l02836"></a>02836       <span class="keywordflow">return</span> <span class="stringliteral">"The device went offline prior to or during this operation"</span>;
<a name="l02837"></a>02837       <span class="keywordflow">break</span>;
<a name="l02838"></a>02838   }
<a name="l02839"></a>02839 
<a name="l02840"></a>02840   TW_STR32 hex;
<a name="l02841"></a>02841   <a class="code" href="dsm_8h.html#770571e12ff9370899184528f4b4626d">SNPRINTF</a>(hex, 32, <span class="stringliteral">"TWCC 0x%04x"</span>, cc);
<a name="l02842"></a>02842 
<a name="l02843"></a>02843   <span class="keywordflow">return</span> hex;
<a name="l02844"></a>02844 }
<a name="l02845"></a>02845 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Oct 26 11:40:58 2006 for Twain_DSM by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6-NO </small></address>
</body>
</html>
